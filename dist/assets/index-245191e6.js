import{u as N,A as te,P as ne,T as w,I as x,d as J}from"./vuedraggable.umd-c5d5d6f0.js";import{d as k,r as b,s as D,o as v,c as f,b as o,e as d,t as C,l as $,v as S,F as V,g as P,i as q,u as O,z as oe,A as se,f as M,p as H,j as K,q as le,y as ae,B as ie,x as ue,C as re,a as de}from"./main-e887d93b.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import{I as L,D as W,b as ce}from"./Dropdown-4f36592d.js";import{m as pe}from"./importMidi-9c9a4e60.js";import{s as me,c as Y}from"./inputListener-23ff99cc.js";import"./_commonjsHelpers-3093e818.js";const ve={class:"song printable"},_e={class:"wrap"},ge={class:"void"},fe=k({__name:"Song",props:{song:{required:!0,type:Object}},setup(i,{expose:_}){const g=i,e=N(),m=b(),y=b(),u=b(),t=b([[...g.song.sections,...g.song.midi??[]]]),n=b(0);D(()=>{var R,z;if(!u.value)return;const h=[],U=(R=y.value)==null?void 0:R.getSections();if(!U)return;const Q=[...g.song.sections,...g.song.midi??[]];for(let T=0;T<U.length;T++){const X=U[T],A=Q[T],Z=X.getBoundingClientRect().bottom,ee=((z=u.value)==null?void 0:z.getBoundingClientRect().bottom)??0,j=Math.ceil(Z/ee)-1;if(!h[j]){h[j]=[A];continue}h[j].push(A)}t.value=h,t.value.length||t.value.push([null])});const c=()=>{n.value+1>=t.value.length||n.value++},s=()=>{n.value-1<0||n.value--},l=()=>n.value+1,a=()=>t.value.length,r=async()=>{var h;return await((h=m.value)==null?void 0:h.render())};return _({nextPage:c,prevPage:s,getCurrentPage:l,getTotalPages:a,download:async()=>{await e.prepareRender();const h=await r();h&&h.save(`${g.song.title}.pdf`)},print:async()=>{await e.prepareRender();const h=await r();h&&(h.autoPrint(),window.open(h.output("bloburl"),"_blank"))}}),(h,U)=>(v(),f("div",{class:"parent",ref_key:"element",ref:u},[o("div",ve,[o("div",_e,[d(te,{ref_key:"allPages",ref:m,song:i.song},null,8,["song"])])]),o("div",ge,[d(ne,{ref_key:"mainPage",ref:y,song:i.song,pages:t.value,currentPage:n.value},null,8,["song","pages","currentPage"])])],512))}});const he=B(fe,[["__scopeId","data-v-423a3f7b"]]),ye={class:"input"},be={key:0},Ve=["value","max","min"],ke=k({__name:"NumberInput",props:{modelValue:{required:!0,type:Number},max:{required:!1,type:Number},min:{required:!1,type:Number},label:{required:!1,type:String}},emits:["update:modelValue"],setup(i,{emit:_}){const g=e=>{const m=e.target.value;_("update:modelValue",m)};return(e,m)=>(v(),f("div",ye,[i.label?(v(),f("h2",be,C(i.label),1)):$("",!0),o("input",{value:i.modelValue,onInput:g,class:"textinput",type:"number",max:i.max,min:i.min},null,40,Ve)]))}});const E=B(ke,[["__scopeId","data-v-b43258cc"]]),we={class:"material-symbols-rounded"},xe={key:0},$e=k({__name:"Checkbox",props:{modelValue:{required:!0,type:Boolean},label:{required:!1,type:String}},emits:["update:modelValue"],setup(i,{emit:_}){const g=e=>{_("update:modelValue",e)};return(e,m)=>(v(),f("div",{class:"input",onClick:m[0]||(m[0]=y=>g(!i.modelValue))},[o("span",we,C(i.modelValue?"check_box":"check_box_outline_blank"),1),i.label?(v(),f("h2",xe,C(i.label),1)):$("",!0)]))}});const Ce=B($e,[["__scopeId","data-v-96cc0e53"]]),Se={class:"group"},Ie=o("h2",null,"Options",-1),Ue={class:"content"},Pe={class:"group"},Ee=o("div",{class:"flex space-between"},[o("h2",null,"Instruments")],-1),Ne={class:"content"},Be={class:"group"},Me={class:"flex end"},Te=["onClick"],Oe={class:"content"},qe={class:"flex"},je=k({__name:"Instrument",props:{song:{required:!0,type:Object}},setup(i){const _=i,g=N();S(()=>_.song,u=>{u&&(e.value=u)});const e=b(_.song),m=u=>{if(["l","r1","r2"].includes(u)&&!e.value.instruments[u]){e.value.instruments[u]={type:L[0],name:L[0],volume:100,page:1};return}};S(()=>e.value,u=>{u&&g.updateSong(u)});const y=b({});return window.addEventListener("click",u=>{let t=u.target;for(let s=0;s<5;s++){if(!t)return;if(t.classList.contains("group")||!t.parentElement)break;t=t.parentElement}if(!t)return;const[n,c]=t.id.split(".");for(let s=0;s<e.value.sections.length;s++){const l=e.value.sections[s];for(let a=0;a<l.progression.length;a++){if(s===Number(n)&&a===Number(c)){console.log("found");continue}const r=l.progression[a];delete r.selected}}}),window.addEventListener("chord-click",u=>{const{sectionIndex:t,chordIndex:n}=u.detail,c=`${t}.${n}`,s=()=>{var l;(l=document.getElementById(c))==null||l.scrollIntoView({behavior:"smooth",block:"center"})};if(!y.value.sections){y.value.sections=!0,setTimeout(s,10);return}s()}),(u,t)=>(v(),f(V,null,[o("div",Se,[Ie,o("div",Ue,[(v(!0),f(V,null,P(e.value.options,(n,c)=>(v(),q(Ce,{modelValue:e.value.options[c],"onUpdate:modelValue":s=>e.value.options[c]=s,label:c},null,8,["modelValue","onUpdate:modelValue","label"]))),256))])]),o("div",Pe,[Ee,o("div",Ne,[(v(!0),f(V,null,P(Object.keys(e.value.instruments),n=>(v(),f("div",Be,[o("h2",null,C(n),1),o("div",Me,[o("span",{onClick:c=>delete e.value.instruments[n],class:"material-symbols-rounded"}," - ",8,Te)]),o("div",Oe,[d(w,{modelValue:e.value.instruments[n].name,"onUpdate:modelValue":c=>e.value.instruments[n].name=c,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),d(E,{modelValue:e.value.instruments[n].volume,"onUpdate:modelValue":c=>e.value.instruments[n].volume=c,min:0,max:127,label:"volume"},null,8,["modelValue","onUpdate:modelValue"]),d(E,{modelValue:e.value.instruments[n].page,"onUpdate:modelValue":c=>e.value.instruments[n].page=c,label:"page"},null,8,["modelValue","onUpdate:modelValue"]),d(W,{modelValue:e.value.instruments[n].type,"onUpdate:modelValue":c=>e.value.instruments[n].type=c,options:O(L),label:"type"},null,8,["modelValue","onUpdate:modelValue","options"])])]))),256))]),o("div",qe,[(v(),f(V,null,P(["l","r1","r2"],n=>oe(d(x,{onClick:c=>m(n),icon:"add",label:"Add "+n},null,8,["onClick","label"]),[[se,!e.value.instruments[n]]])),64))])])],64))}}),Le=k({__name:"Metadata",props:{song:{required:!0,type:Object}},setup(i){const _=i,g=N();S(()=>_.song,u=>{u&&(e.value=u)});const e=b(_.song);S(()=>e.value,u=>{u&&g.updateSong(u)});const m=async()=>{var s;if(!e.value.artist||!e.value.title)return;const u=`artist:${e.value.artist} track:${e.value.title}`,c=(s=(await(await fetch("http://localhost:1234/api/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:u,scope:["spotify"]})})).json()).spotifyTracks)==null?void 0:s[0];c&&(e.value.spotify=c.url,e.value.cover=c.cover,y())},y=async()=>{if(console.log("getMetadata"),!e.value.spotify)return;e.value.spotify.includes("?")&&(e.value.spotify=e.value.spotify.split("?")[0]);const t=await(await fetch("http://localhost:1234/api/spotify/meta",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({forceFetch:!0,spotifyId:e.value.spotify.split("/").pop()})})).json();e.value.bpm=Math.round(t.spotify.features.tempo),e.value.key=t.spotify.features.key+(t.spotify.features.mode==="Minor"?"m":"")};return(u,t)=>(v(),f(V,null,[d(w,{modelValue:e.value.title,"onUpdate:modelValue":t[0]||(t[0]=n=>e.value.title=n),label:"title",onChange:m},null,8,["modelValue"]),d(w,{modelValue:e.value.artist,"onUpdate:modelValue":t[1]||(t[1]=n=>e.value.artist=n),label:"artist",onChange:m},null,8,["modelValue"]),d(w,{modelValue:e.value.spotify,"onUpdate:modelValue":t[2]||(t[2]=n=>e.value.spotify=n),label:"Spotify Link",onChange:y,buttonIcon:"search",onButtonClick:m},null,8,["modelValue"]),d(w,{modelValue:e.value.key,"onUpdate:modelValue":t[3]||(t[3]=n=>e.value.key=n),label:"key"},null,8,["modelValue"]),d(E,{modelValue:e.value.bpm,"onUpdate:modelValue":t[4]||(t[4]=n=>e.value.bpm=n),min:0,label:"bpm"},null,8,["modelValue"]),d(E,{modelValue:e.value.transpose,"onUpdate:modelValue":t[5]||(t[5]=n=>e.value.transpose=n),min:-12,max:12,label:"transpose"},null,8,["modelValue"]),d(E,{modelValue:e.value.octave,"onUpdate:modelValue":t[6]||(t[6]=n=>e.value.octave=n),min:-1,max:1,label:"octave"},null,8,["modelValue"])],64))}}),F=i=>(H("data-v-8112b9e5"),i=i(),K(),i),We={class:"group"},De=F(()=>o("h2",null,"Structure",-1)),Fe={class:"content"},Re={class:"group"},ze={class:"flex space-between"},Ae=F(()=>o("h2",null,"Sections",-1)),Je={class:"group section"},Ye={class:"flex space-between"},Ge={class:"flex"},He=["onClick"],Ke={class:"content"},Qe=["onClick","id"],Xe={class:"flex end"},Ze=["onClick"],et={class:"content flex-row"},tt={class:"group"},nt=F(()=>o("h2",null,"Melodies",-1)),ot={class:"content"},st={class:"group"},lt={class:"flex"},at=k({__name:"Structure",props:{song:{required:!0,type:Object}},setup(i){const _=i,g=N();S(()=>_.song,s=>{s&&(e.value=s)});const e=b(_.song);S(()=>e.value,s=>{s&&g.updateSong(s)});const m=b({});window.addEventListener("click",s=>{let l=s.target;for(let p=0;p<5;p++){if(!l)return;if(l.classList.contains("group")||!l.parentElement)break;l=l.parentElement}if(!l)return;const[a,r]=l.id.split(".");for(let p=0;p<e.value.sections.length;p++){const I=e.value.sections[p];for(let h=0;h<I.progression.length;h++){if(p===Number(a)&&h===Number(r)){console.log("found");continue}const U=I.progression[h];delete U.selected}}}),window.addEventListener("chord-click",s=>{const{sectionIndex:l,chordIndex:a}=s.detail,r=`${l}.${a}`,p=()=>{var I;(I=document.getElementById(r))==null||I.scrollIntoView({behavior:"smooth",block:"center"})};if(!m.value.sections){m.value.sections=!0,setTimeout(p,10);return}p()});const y=s=>{e.value.midi&&e.value.midi.splice(s,1)},u=async()=>new Promise((s,l)=>{const a=document.createElement("input");a.type="file",a.accept=".mid",a.onchange=async()=>{if(!a.files){l();return}const r=a.files[0],p=await pe(r);if(!p){l();return}s(p)},a.click()}),t=async s=>{const l=await u();l&&e.value.midi&&(e.value.midi[s]=l)},n=async()=>{e.value.midi||(e.value.midi=[]);const s=await u();s&&e.value.midi.push(s)},c=s=>{const l=Y.value.includes("detected")?e.value.key:Y.value;s.progression.push({chord:l,duration:4})};return D(()=>{me()}),(s,l)=>(v(),f(V,null,[o("div",We,[De,o("div",Fe,[(v(!0),f(V,null,P(e.value.structure,(a,r)=>(v(),q(W,{modelValue:e.value.structure[r],"onUpdate:modelValue":[p=>e.value.structure[r]=p,p=>{p==="(none)"&&e.value.structure.splice(r,1)}],options:[...e.value.sections.map(p=>String(p.type)),"(none)"],label:"section"},null,8,["modelValue","onUpdate:modelValue","options"]))),256))]),d(x,{onClick:l[0]||(l[0]=a=>e.value.structure.push("")),icon:"add",label:"add section"})]),o("div",Re,[o("div",ze,[Ae,o("span",{class:"material-symbols-rounded",onClick:l[1]||(l[1]=a=>m.value.sections=!m.value.sections)},C(m.value.sections?"expand_less":"expand_more"),1)]),m.value.sections?(v(),f(V,{key:0},[d(O(J),{modelValue:e.value.sections,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.sections=a),class:"content"},{item:M(({element:a})=>[o("div",Je,[o("div",Ye,[o("div",Ge,[d(W,{modelValue:a.type,"onUpdate:modelValue":r=>a.type=r,options:O(ce),label:"type"},null,8,["modelValue","onUpdate:modelValue","options"]),d(w,{modelValue:a.name,"onUpdate:modelValue":r=>a.name=r,label:"name"},null,8,["modelValue","onUpdate:modelValue"])]),o("span",{onClick:r=>e.value.sections.splice(e.value.sections.indexOf(a),1),class:"material-symbols-rounded"}," delete ",8,He)]),o("div",Ke,[d(O(J),{modelValue:a.progression,"onUpdate:modelValue":r=>a.progression=r,class:"content"},{item:M(({element:r})=>[o("div",{class:"group chord",onClick:p=>r.selected=!0,id:e.value.sections.indexOf(a)+"."+a.progression.indexOf(r)},[o("div",Xe,[o("span",{onClick:p=>a.progression.splice(a.progression.indexOf(r),1),class:"material-symbols-rounded"},"-",8,Ze)]),o("div",et,[d(w,{modelValue:r.chord,"onUpdate:modelValue":p=>r.chord=p,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),d(E,{modelValue:r.duration,"onUpdate:modelValue":p=>r.duration=p,min:1,label:"duration"},null,8,["modelValue","onUpdate:modelValue"])])],8,Qe)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),d(x,{onClick:r=>c(a),icon:"add",label:"add chord"},null,8,["onClick"])])]),_:1},8,["modelValue"]),d(x,{onClick:l[3]||(l[3]=a=>e.value.sections.push({type:"chorus",progression:[]})),icon:"add",label:"add section"})],64)):$("",!0)]),o("div",tt,[nt,o("div",ot,[(v(!0),f(V,null,P(i.song.midi,(a,r)=>(v(),f("div",st,[d(w,{modelValue:a.name,"onUpdate:modelValue":p=>a.name=p,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),o("div",lt,[d(x,{onClick:p=>y(r),icon:"delete",label:"delete"},null,8,["onClick"]),d(x,{onClick:p=>t(r),icon:"sync",label:"replace"},null,8,["onClick"])])]))),256))]),d(x,{onClick:n,icon:"add",label:"add"})])],64))}});const it=B(at,[["__scopeId","data-v-8112b9e5"]]),ut={class:"settings"},rt={key:0,class:"spotify"},dt=["src"],ct={class:"tabs flex space-between"},pt=["onClick"],mt={class:"configuration"},vt=k({__name:"Editor",props:{song:{required:!0,type:Object}},setup(i){const _=i;N(),S(()=>_.song,y=>{y&&(g.value=y)});const g=b(_.song),e=[{name:"metadata",component:Le},{name:"instrument",component:je},{name:"sections",component:it}],m=b(e[0]);return(y,u)=>(v(),f("div",ut,[g.value.spotify?(v(),f("div",rt,[o("iframe",{src:`https://open.spotify.com/embed/track/${g.value.spotify.split("/").pop()}`,width:"100%",height:"80",frameborder:"0",allow:"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture",loading:"lazy"},null,8,dt)])):$("",!0),o("div",ct,[(v(),f(V,null,P(e,t=>o("label",{key:t.name,class:le({selected:m.value.name===t.name}),onClick:n=>m.value=t},C(t.name),11,pt)),64))]),o("div",mt,[(v(),q(ae(m.value.component),{song:i.song},null,8,["song"]))])]))}});const _t={key:0,class:"min-width"},gt=k({__name:"MinWidth",props:{minWidth:{required:!0,type:Number},error:{required:!1,type:String,default:"Mobile devices are currently not supported."}},setup(i){const _=b(0);return D(()=>{_.value=window.innerWidth}),window.addEventListener("resize",()=>{_.value=window.innerWidth}),(g,e)=>_.value<i.minWidth?(v(),f("div",_t,[o("p",null,C(i.error),1)])):ie(g.$slots,"default",{key:1},void 0,!0)}});const G=B(gt,[["__scopeId","data-v-40782251"]]),ft=i=>(H("data-v-0f137ad4"),i=i(),K(),i),ht={key:0,class:"editor"},yt=ft(()=>o("span",{class:"material-symbols-rounded"},"arrow_back",-1)),bt={class:"preview"},Vt={key:0,class:"pages"},kt={class:""},wt={class:"config"},xt=k({__name:"index",setup(i){const _=N(),g=ue(),e=re();let m=g.params.id;if(!m){const n=_.addEmptySong();e.push({path:`/editor/${n}`,replace:!0}),m=String(n)}const y=_.song(m);y||e.push("/");const u=b(y),t=b();return(n,c)=>{const s=de("router-link");return v(),q(G,{minWidth:300},{default:M(()=>[u.value?(v(),f("div",ht,[d(s,{to:"/",class:"back-button"},{default:M(()=>[yt]),_:1}),o("div",bt,[t.value?(v(),f("div",Vt,[$("",!0),o("span",{class:"material-symbols-rounded",onClick:c[2]||(c[2]=(...l)=>t.value.print&&t.value.print(...l))}," print "),o("span",{class:"material-symbols-rounded",onClick:c[3]||(c[3]=(...l)=>t.value.download&&t.value.download(...l))}," file_download ")])):$("",!0),o("div",kt,[d(he,{song:u.value,ref_key:"preview",ref:t},null,8,["song"])])]),d(G,{minWidth:1100,error:""},{default:M(()=>[o("div",wt,[d(vt,{song:u.value},null,8,["song"])])]),_:1})])):$("",!0)]),_:1})}}});const Nt=B(xt,[["__scopeId","data-v-0f137ad4"]]);export{Nt as default};
