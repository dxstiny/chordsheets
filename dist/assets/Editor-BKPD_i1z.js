import{d as F,r as B,B as K,c as ne,x as ee,s as le,b as m,J as te,D as ae,L as de,n as U,M as Q,v as R,o as r,C as q,_ as oe,h as j,w as f,a as ie,y as re,F as D,f as I,e as d,g as k,t as p,k as C,j as S,i as W,O as Y,p as ue,q as ce}from"./main-CFTRWoaP.js";import{d as Z}from"./vuedraggable.umd-DJQKlQjA.js";/* empty css                                                               */import{d as me,E as pe}from"./dom-to-image-13VFuKJy.js";const ge=["placeholder"],fe=F({__name:"EditableText",props:{modelValue:{type:String,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(o,{emit:N}){const $=o,a=B($.modelValue);K(()=>$.modelValue,E=>a.value=E);const h=B(!1),M=N,s=B(null),y=()=>{$.locked||(h.value=!0,q(()=>{s.value&&s.value.focus()}))},x=ne(()=>$.locked?!0:h.value?!1:a.value||a.value=="0"),L=E=>{a.value=E,M("change",E),M("update:modelValue",E)},O=()=>{s.value&&(s.value.style.height="auto",s.value.style.height=s.value.scrollHeight+"px")};return ee(()=>O()),le(()=>{h.value&&O()}),(E,g)=>(r(),m("div",{class:R(["editable-text",{outlined:!o.noOutline&&h.value}]),onDblclick:U(y,["stop"])},[x.value?te(E.$slots,"default",{key:0},void 0,!0):ae((r(),m("input",{key:1,ref_key:"area",ref:s,type:"text",class:"textarea","onUpdate:modelValue":g[0]||(g[0]=V=>a.value=V),onChange:g[1]||(g[1]=V=>L(V.target.value)),onInput:g[2]||(g[2]=V=>O()),onClick:g[3]||(g[3]=U(V=>h.value=!0,["stop"])),onKeydown:[g[4]||(g[4]=Q(V=>h.value=!1,["enter"])),g[5]||(g[5]=Q(V=>h.value=!1,["esc"]))],onBlur:g[6]||(g[6]=V=>h.value=!1),placeholder:o.placeholder},null,40,ge)),[[de,a.value]])],34))}}),w=oe(fe,[["__scopeId","data-v-793c6cbc"]]),A=F({__name:"EditableNumber",props:{modelValue:{type:Number,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(o,{emit:N}){const $=o,a=B(String($.modelValue));K(()=>$.modelValue,s=>a.value=String(s));const h=N,M=s=>{const y=Number(s);a.value=s,h("change",y),h("update:modelValue",y)};return(s,y)=>(r(),j(w,{modelValue:a.value,"onUpdate:modelValue":y[0]||(y[0]=x=>a.value=x),onChange:M,"no-outline":o.noOutline,locked:o.locked,placeholder:o.placeholder},{default:f(()=>[te(s.$slots,"default")]),_:3},8,["modelValue","no-outline","locked","placeholder"]))}}),J=()=>window.innerWidth<=800,_=o=>(ue("data-v-e7081723"),o=o(),ce(),o),ve={class:"editor__header"},he={class:"wrap-to-line"},ke={class:"info"},ye=_(()=>d("span",{class:"material-symbols-rounded"},"music_note",-1)),Ve={class:"info"},be=_(()=>d("span",{class:"material-symbols-rounded"},"piano",-1)),Ce={class:"info"},we={class:"material-symbols-rounded"},Ue={class:"info"},$e=_(()=>d("span",{class:"material-symbols-rounded"}," check ",-1)),Ee={class:"capitalise"},Se=["onClick"],Me=_(()=>d("span",{class:"material-symbols-rounded"}," add ",-1)),Pe={key:0},Be={class:"instruments"},_e={class:"instrument"},De=["onClick"],Ne={class:"flex space-between"},xe={class:"flex gap-2"},Oe=_(()=>d("span",{class:"material-symbols-rounded"}," volume_up ",-1)),He={class:"settings"},Ie={class:"muted"},Ke=_(()=>d("span",{class:"material-symbols-rounded"}," add ",-1)),Le=_(()=>d("hr",null,null,-1)),Te=["id"],We={class:"name"},qe={key:0,class:"buttons"},ze=["onClick"],Ae=["onClick"],Je={key:1,class:"progression"},Re=["onClick"],je=_(()=>d("span",{class:"material-symbols-rounded"}," add ",-1)),Fe=["id","onMousedown","onMouseup"],Ge=["onClick"],Xe=["id"],Qe={class:"name"},Ye={class:"progression"},Ze=["id"],et={key:3,class:"pageNumber"},tt={key:4,class:"sectionName"},ot=F({__name:"Editor",props:{song:{type:Object,required:!0},printing:{type:Boolean,default:!1},pageOffset:{type:Number,default:0},sectionName:{type:String,required:!1},disableHotkeys:{type:Boolean,default:!1}},emits:["onPageCount"],setup(o,{expose:N,emit:$}){const a=o,h=ie(),M=B(!1),s=B(a.printing),y=B(),x=(n,t)=>{const u=a.song.sections[n].progression[t],e={chord:u.chord,duration:u.duration};a.song.sections[n].progression.splice(t+1,0,e)},L=n=>{if(!a.disableHotkeys){if(n.key==="Delete")for(const t of a.song.sections)t.progression=t.progression.filter(i=>!i.selected);if(n.ctrlKey&&(n.key==="d"||n.key==="b")){n.preventDefault();for(const t of a.song.sections){const i=t.progression.filter(u=>u.selected);t.progression.splice(t.progression.indexOf(i[i.length-1])+1,0,...i.map(u=>({chord:u.chord,duration:u.duration,selected:!0}))),i.forEach(u=>u.selected=!1)}}n.ctrlKey&&n.key==="p"&&(n.preventDefault(),se())}},O=(n,t)=>{if(t.button===2||J())return;const i=t.target;if(t.offsetX>i.clientWidth-10){t.preventDefault(),t.stopImmediatePropagation(),M.value=!0;const u=i.getBoundingClientRect().width/n.duration;let e=0;const c=v=>{const b=v.clientX-i.getBoundingClientRect().left;e=Math.round(b/u),n.duration=Math.max(1,Math.min(16,e))},l=v=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",l),M.value=!1,v.stopImmediatePropagation()};window.addEventListener("mousemove",c),window.addEventListener("mouseup",l)}},E=(n,t)=>{let i=n.selected;if(!t.shiftKey)for(const u of a.song.sections)for(const e of u.progression)e.selected=!1;n.selected=!i},g=n=>{a.song.sections.splice(n,1)},V=n=>{const t=a.song.sections[n],i={type:t.type,progression:t.progression.map(u=>({chord:u.chord,duration:u.duration})),page:0};a.song.sections.splice(n+1,0,i)},G=async n=>{const t=y.value.querySelectorAll(".editor");let i=t[0];const u=i.clientHeight/i.clientWidth;for(let l=0;l<t.length;l++){if(i=t[l],!i)continue;var e=n.internal.pageSize.getWidth(),c=n.internal.pageSize.getHeight();const v=2,b=await me.toJpeg(i,{height:i.clientHeight*v,width:i.clientWidth*v,style:{transform:`scale(${v}) translate(${i.clientWidth/2/v}px, ${i.clientHeight/2/v}px)`}});c=u*e,n.addImage(b,"JPG",0,0,e,c),l+1<t.length&&n.addPage()}return n};let T;const X=async()=>{s.value=!0,a.song.sections.length&&!a.printing&&await new Promise(i=>{T=i});const n=new pe({orientation:"portrait",unit:"px",format:"a4"});return await G(n),s.value=a.printing,n},se=async()=>{await h.prepareRender();const n=await X();n&&(n.autoPrint(),window.open(n.output("bloburl"),"_blank"))};ee(()=>{window.addEventListener("keydown",L),H()}),re(()=>{window.removeEventListener("keydown",L)});const P=B([]),H=()=>{if(a.song.sections.length==0){P.value=[{start:0,end:0}],z("onPageCount",1);return}if(!s.value||P.value.length==0){P.value=[{start:0,end:a.song.sections.length}],s.value&&a.song.sections.length>0&&q(H),z("onPageCount",1);return}const n=y.value.querySelectorAll(".section");if(n.length==0)return;const t=n[0].parentElement,i=getComputedStyle(t),u=t.clientHeight-parseFloat(i.paddingBottom);for(let e=0;e<n.length;e++){const c=n[e];if(c.offsetTop+c.offsetHeight>u){P.value[P.value.length-1].end=e,P.value.push({start:e,end:a.song.sections.length}),q(H);return}}z("onPageCount",P.value.length),T==null||T()};K(()=>a.song,H,{deep:!0}),K(s,()=>q(H)),K(()=>a.printing,()=>{s.value=a.printing}),N({renderTo:G,render:X,name:()=>a.song.title});const z=$;return(n,t)=>(r(),m("div",{ref_key:"parent",ref:y,class:"pageWrapper"},[(r(!0),m(D,null,I(P.value,(i,u)=>(r(),m("div",{class:R(["editor",{resizing:M.value,print:s.value}]),onDragover:t[13]||(t[13]=U(()=>{},["prevent"]))},[u==0?(r(),m(D,{key:0},[d("div",ve,[k(w,{locked:s.value,modelValue:o.song.artist,"onUpdate:modelValue":t[0]||(t[0]=e=>o.song.artist=e),class:"left",placeholder:"Click to edit artist name","no-outline":""},{default:f(()=>[d("h3",null,p(o.song.artist),1)]),_:1},8,["locked","modelValue"]),k(w,{locked:s.value,modelValue:o.song.title,"onUpdate:modelValue":t[1]||(t[1]=e=>o.song.title=e),class:"left h1",placeholder:"Click to edit song title","no-outline":""},{default:f(()=>[d("h1",null,p(o.song.title),1)]),_:1},8,["locked","modelValue"])]),d("div",he,[d("div",ke,[ye,k(A,{locked:s.value,modelValue:o.song.bpm,"onUpdate:modelValue":t[2]||(t[2]=e=>o.song.bpm=e),class:"left short",placeholder:"120"},{default:f(()=>[C(p(o.song.bpm),1)]),_:1},8,["locked","modelValue"]),C(" BPM ")]),d("div",Ve,[be,k(w,{locked:s.value,modelValue:o.song.key,"onUpdate:modelValue":t[3]||(t[3]=e=>o.song.key=e),class:"left short",placeholder:"C"},{default:f(()=>[C(p(o.song.key),1)]),_:1},8,["locked","modelValue"])]),d("div",Ce,[d("span",we,p(o.song.transpose>0?"arrow_upward":o.song.transpose<0?"arrow_downward":"drag_handle"),1),k(A,{locked:s.value,modelValue:o.song.transpose,"onUpdate:modelValue":t[4]||(t[4]=e=>o.song.transpose=e),class:"left short",placeholder:"0"},{default:f(()=>[C(p(o.song.transpose),1)]),_:1},8,["locked","modelValue"])]),o.song.options?(r(!0),m(D,{key:0},I(o.song.options,(e,c)=>(r(),m("div",Ue,[$e,k(w,{locked:s.value,modelValue:o.song.options[c],"onUpdate:modelValue":l=>o.song.options[c]=l,class:"left",placeholder:"Option"},{default:f(()=>[d("span",Ee,p(e),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?S("",!0):(r(),m("span",{key:0,onClick:l=>o.song.options.splice(c,1),class:"delete material-symbols-rounded"}," delete ",8,Se))]))),256)):S("",!0),d("div",{class:"info add-option",onClick:t[5]||(t[5]=e=>o.song.options?o.song.options.push("Sustain"):o.song.options=["Sustain"])},[Me,C(" Add Option ")])]),o.song.instruments.length?(r(),m("hr",Pe)):S("",!0),d("div",Be,[(r(!0),m(D,null,I(o.song.instruments,(e,c)=>(r(),m("div",_e,[s.value?S("",!0):(r(),m("span",{key:0,onClick:l=>o.song.instruments.splice(c,1),class:"delete material-symbols-rounded"}," delete ",8,De)),d("div",Ne,[k(w,{locked:s.value,modelValue:e.for,"onUpdate:modelValue":l=>e.for=l,class:"left short",placeholder:"Click to edit instrument","no-outline":""},{default:f(()=>[d("span",null,p(e.for),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),d("span",xe,[Oe,k(A,{locked:s.value,modelValue:e.volume,"onUpdate:modelValue":l=>e.volume=l,class:"left short",placeholder:"100"},{default:f(()=>[C(p(e==null?void 0:e.volume),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"])])]),d("div",He,[k(w,{locked:s.value,modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,class:"left h3",placeholder:"Click to edit instrument name","no-outline":""},{default:f(()=>[d("h3",null,p(e.name),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),d("span",Ie,[k(w,{locked:s.value,modelValue:e.type,"onUpdate:modelValue":l=>e.type=l,class:"left",placeholder:"Click to edit instrument type","no-outline":""},{default:f(()=>[C(p(e==null?void 0:e.type),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"])])])]))),256)),d("div",{class:"instrument add-option",onClick:t[6]||(t[6]=e=>o.song.instruments.push({name:"ConcertGrand",for:"R1",type:"Piano",volume:100}))},[Ke,C(" Add Instrument ")])]),Le],64)):S("",!0),s.value?(r(!0),m(D,{key:2},I(a.song.sections.slice(i.start,i.end),(e,c)=>(r(),m("div",{class:"section printable",id:`section-${c}`},[d("span",Qe,p(e.type),1),d("div",Ye,[(r(!0),m(D,null,I(e.progression,(l,v)=>(r(),m("div",{class:"chord",ref_for:!0,ref:"chordElements",id:`chord-${c}-${v}`,style:Y({"--cols":l.duration})},p(l.chord),13,Ze))),256))])],8,Xe))),256)):(r(),j(W(Z),{key:1,modelValue:o.song.sections,"onUpdate:modelValue":t[11]||(t[11]=e=>o.song.sections=e),class:"editor__content",onDragover:t[12]||(t[12]=U(()=>{},["stop"])),itemKey:"id",disabled:W(J)()},{item:f(({element:e,index:c})=>[d("div",{class:"section",id:`section-${c}`},[k(w,{locked:s.value,modelValue:e.type,"onUpdate:modelValue":l=>e.type=l,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:f(()=>[d("span",We,p(e.type),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?S("",!0):(r(),m("div",qe,[d("span",{class:"button material-symbols-rounded",onClick:l=>V(c)}," content_copy ",8,ze),d("span",{class:"button material-symbols-rounded",onClick:l=>g(c)}," delete ",8,Ae)])),e.progression.length===0?(r(),m("div",Je,[d("div",{class:"chord create",style:{"--cols":4},onClick:U(l=>e.progression.push({chord:"C",duration:4}),["stop"])},[je,C(" Add Chord ")],8,Re)])):(r(),j(W(Z),{key:2,modelValue:e.progression,"onUpdate:modelValue":l=>e.progression=l,class:"progression",onDragover:t[10]||(t[10]=U(()=>{},["stop"])),itemKey:"id",disabled:W(J)()},{item:f(({element:l,index:v})=>[d("div",{class:R(["chord",l.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${c}-${v}`,onMousedown:b=>O(l,b),onMouseup:b=>E(l,b),onClick:t[9]||(t[9]=U(()=>{},["stop"])),style:Y({"--cols":l.duration})},[k(w,{locked:s.value,modelValue:l.chord,"onUpdate:modelValue":b=>l.chord=b,"no-outline":"",placeholder:"C"},{default:f(()=>[C(p(l.chord),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?S("",!0):(r(),m("span",{key:0,class:"insert_chord_here",onMousedown:t[7]||(t[7]=U(()=>{},["stop"])),onMouseup:t[8]||(t[8]=U(()=>{},["stop"])),onClick:U(b=>x(c,v),["stop"])},null,40,Ge))],46,Fe)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]))],8,Te)]),_:2},1032,["modelValue","disabled"])),s.value?(r(),m("span",et,p(u+o.pageOffset+1),1)):S("",!0),s.value&&o.sectionName?(r(),m("span",tt,p(o.sectionName),1)):S("",!0)],34))),256))],512))}}),dt=oe(ot,[["__scopeId","data-v-e7081723"]]);export{dt as E,w as a,J as i};
