import{d as S,u as C,i as x,j as I,r as _,f as E,k as R,l as $,e as D,w as v,o as A,b as s,m as w,p as L,h as K,_ as M}from"./main-5840bc37.js";import{M as N}from"./MinWidth-3993b960.js";import{E as P}from"./Editor-df2f4f61.js";import"./dom-to-image-adbcd5c5.js";import"./_commonjsHelpers-042e6b4d.js";const T="https://europe-west6-elated-effect-396715.cloudfunctions.net/spotify/token",h="https://api.spotify.com/v1";let l=null;const U=async()=>{if(l)return l;const t=await fetch(T);if(!t.ok)throw new Error("Could not fetch token");return l=await t.text(),l},k=async()=>({Authorization:`Bearer ${await U()}`}),j=async t=>(await fetch(`${h}/tracks/${t}`,{headers:await k()})).json(),B=async t=>(await fetch(`${h}/audio-features/${t}`,{headers:await k()})).json(),F=t=>{const o={0:"C",1:"C♯",2:"D",3:"D♯",4:"E",5:"F",6:"F♯",7:"G",8:"G♯",9:"A",10:"A♯",11:"B"},r={0:"",1:"m"};return`${o[t.key]}${r[t.mode]}`},O=async t=>{var c,i;const[o,r]=await Promise.all([j(t),B(t)]);return{cover:(i=(c=o.album.images)==null?void 0:c[0])==null?void 0:i.url,name:o.name,artist:o.artists[0].name,album:o.album.name,href:o.external_urls.spotify,key:F(r),tempo:Math.round(r.tempo)}},G=t=>{const o=t.match(/track\/(\w+)/);if(!o)throw new Error("Invalid URL");return o[1]},J=t=>(L("data-v-8af6fe3c"),t=t(),K(),t),V={class:"editor_container"},W=J(()=>s("span",{class:"material-symbols-rounded"},"arrow_back",-1)),z=S({__name:"index",setup(t){const o=C(),r=x(),c=I();let i=r.params.id;const d=_();if(!i){const e=o.addEmptySong();c.push({path:`/editor/${e}`,replace:!0}),i=String(e)}const u=o.song(i);u||c.push("/");const n=_(u),p=async()=>{await o.prepareRender();const e=await d.value.render();e&&(e.autoPrint(),window.open(e.output("bloburl"),"_blank"))},f=async()=>{await o.prepareRender();const e=await d.value.render();e&&e.save(`${n.value.title}.pdf`)},m=()=>{if(!n.value)return;const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n.value)),a=document.createElement("a");a.setAttribute("href",e),a.setAttribute("download",`${n.value.title}.chordsheets.json`),document.body.appendChild(a),a.click(),a.remove()},y=e=>{e.ctrlKey&&e.key==="s"?(e.preventDefault(),m()):e.ctrlKey&&e.shiftKey&&e.key==="S"?(e.preventDefault(),f()):e.ctrlKey&&e.key==="p"&&(e.preventDefault(),p())},b=async()=>{const e=prompt("Enter Spotify URI",n.value.spotify);if(n.value.spotify=e||n.value.spotify,console.log(e),e){const a=await O(G(n.value.spotify));console.log(a),n.value.artist=a.artist,n.value.title=a.name,n.value.bpm=a.tempo,n.value.key=a.key,n.value.cover=a.cover??""}};return E(()=>{window.addEventListener("keydown",y)}),R(()=>{window.removeEventListener("keydown",y)}),(e,a)=>{const g=$("router-link");return A(),D(N,{minWidth:300},{default:v(()=>[s("div",V,[w(g,{to:"/",class:"back-button"},{default:v(()=>[W]),_:1}),s("div",{class:"toolbar"},[s("span",{class:"material-symbols-rounded",onClick:p,title:"Print (Ctrl+P)"}," print "),s("span",{class:"material-symbols-rounded",onClick:f,title:"Download as PDF (CTRL+SHIFT+S)"}," picture_as_pdf "),s("span",{class:"material-symbols-rounded",onClick:m,title:"Download as JSON (CTRL+S)"}," file_download "),s("span",{class:"material-symbols-rounded",onClick:b,title:"Link Spotify"}," link ")]),w(P,{ref_key:"editor",ref:d,song:n.value},null,8,["song"])])]),_:1})}}});const Z=M(z,[["__scopeId","data-v-8af6fe3c"]]);export{Z as default};
