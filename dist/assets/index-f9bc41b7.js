import{a as L,D as W,I as $,S as ee,m as te}from"./Dropdown-9b537f69.js";import{u as P,P as ne,_ as oe,T as x,d as A}from"./vuedraggable.umd-1cb92482.js";import{d as k,r as h,q as Y,o as v,c as f,b as o,e as c,t as V,l as U,s as w,F as b,g as S,i as B,u as O,v as se,x as le,f as E,p as G,j as H,y as ae,z as ie,A as ue,B as re,C as de,a as ce,k as pe}from"./main-58191479.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import{m as me}from"./importMidi-76d154a5.js";import"./_commonjsHelpers-db48cef0.js";const ve={class:"song printable"},_e={class:"wrap"},fe={class:"void"},ge=k({__name:"Song",props:{song:{required:!0,type:Object}},setup(i,{expose:m}){const _=i,e=P(),p=h(),g=h(),u=h(),t=h([[..._.song.sections,..._.song.midi??[]]]),s=h(0);Y(()=>{var D,F;if(!u.value)return;const y=[],M=(D=g.value)==null?void 0:D.getSections();if(!M)return;const K=[..._.song.sections,..._.song.midi??[]];for(let T=0;T<M.length;T++){const Q=M[T],z=K[T],X=Q.getBoundingClientRect().bottom,Z=((F=u.value)==null?void 0:F.getBoundingClientRect().bottom)??0,j=Math.ceil(X/Z)-1;if(!y[j]){y[j]=[z];continue}y[j].push(z)}t.value=y});const n=()=>{s.value+1>=t.value.length||s.value++},a=()=>{s.value-1<0||s.value--},l=()=>s.value+1,r=()=>t.value.length,d=async()=>{var y;return await((y=p.value)==null?void 0:y.render())};return m({nextPage:n,prevPage:a,getCurrentPage:l,getTotalPages:r,download:async()=>{await e.prepareRender();const y=await d();y&&y.save(`${_.song.title}.pdf`)},print:async()=>{await e.prepareRender();const y=await d();y&&(y.autoPrint(),window.open(y.output("bloburl"),"_blank"))}}),(y,M)=>(v(),f("div",{class:"parent",ref_key:"element",ref:u},[o("div",ve,[o("div",_e,[c(ne,{ref_key:"mainPage",ref:g,song:i.song,pages:t.value,currentPage:s.value},null,8,["song","pages","currentPage"])])]),o("div",fe,[c(oe,{ref_key:"allPages",ref:p,song:i.song},null,8,["song"])])],512))}}),ye={class:"input"},he={key:0},be=["value","max","min"],Ve=k({__name:"NumberInput",props:{modelValue:{required:!0,type:Number},max:{required:!1,type:Number},min:{required:!1,type:Number},label:{required:!1,type:String}},emits:["update:modelValue"],setup(i,{emit:m}){const _=e=>{const p=e.target.value;m("update:modelValue",p)};return(e,p)=>(v(),f("div",ye,[i.label?(v(),f("h2",he,V(i.label),1)):U("",!0),o("input",{value:i.modelValue,onInput:_,class:"textinput",type:"number",max:i.max,min:i.min},null,40,be)]))}});const I=q(Ve,[["__scopeId","data-v-b43258cc"]]),ke={class:"material-symbols-rounded"},xe={key:0},$e=k({__name:"Checkbox",props:{modelValue:{required:!0,type:Boolean},label:{required:!1,type:String}},emits:["update:modelValue"],setup(i,{emit:m}){const _=e=>{m("update:modelValue",e)};return(e,p)=>(v(),f("div",{class:"input",onClick:p[0]||(p[0]=g=>_(!i.modelValue))},[o("span",ke,V(i.modelValue?"check_box":"check_box_outline_blank"),1),i.label?(v(),f("h2",xe,V(i.label),1)):U("",!0)]))}});const we=q($e,[["__scopeId","data-v-96cc0e53"]]),Ce={class:"group"},Se=o("h2",null,"Options",-1),Ie={class:"content"},Ue={class:"group"},Pe=o("div",{class:"flex space-between"},[o("h2",null,"Instruments")],-1),Ne={class:"content"},Ee={class:"group"},qe={class:"flex end"},Me=["onClick"],Te={class:"content"},Oe={class:"flex"},Be=k({__name:"Instrument",props:{song:{required:!0,type:Object}},setup(i){const m=i,_=P();w(()=>m.song,u=>{u&&(e.value=u)});const e=h(m.song),p=u=>{if(["l","r1","r2"].includes(u)&&!e.value.instruments[u]){e.value.instruments[u]={type:L[0],name:L[0],volume:100,page:1};return}};w(()=>e.value,u=>{u&&_.updateSong(u)});const g=h({});return window.addEventListener("click",u=>{let t=u.target;for(let a=0;a<5;a++){if(!t)return;if(t.classList.contains("group")||!t.parentElement)break;t=t.parentElement}if(!t)return;const[s,n]=t.id.split(".");for(let a=0;a<e.value.sections.length;a++){const l=e.value.sections[a];for(let r=0;r<l.progression.length;r++){if(a===Number(s)&&r===Number(n)){console.log("found");continue}const d=l.progression[r];delete d.selected}}}),window.addEventListener("chord-click",u=>{const{sectionIndex:t,chordIndex:s}=u.detail,n=`${t}.${s}`,a=()=>{var l;(l=document.getElementById(n))==null||l.scrollIntoView({behavior:"smooth",block:"center"})};if(!g.value.sections){g.value.sections=!0,setTimeout(a,10);return}a()}),(u,t)=>(v(),f(b,null,[o("div",Ce,[Se,o("div",Ie,[(v(!0),f(b,null,S(e.value.options,(s,n)=>(v(),B(we,{modelValue:e.value.options[n],"onUpdate:modelValue":a=>e.value.options[n]=a,label:n},null,8,["modelValue","onUpdate:modelValue","label"]))),256))])]),o("div",Ue,[Pe,o("div",Ne,[(v(!0),f(b,null,S(Object.keys(e.value.instruments),s=>(v(),f("div",Ee,[o("h2",null,V(s),1),o("div",qe,[o("span",{onClick:n=>delete e.value.instruments[s],class:"material-symbols-rounded"}," - ",8,Me)]),o("div",Te,[c(x,{modelValue:e.value.instruments[s].name,"onUpdate:modelValue":n=>e.value.instruments[s].name=n,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),c(I,{modelValue:e.value.instruments[s].volume,"onUpdate:modelValue":n=>e.value.instruments[s].volume=n,min:0,max:127,label:"volume"},null,8,["modelValue","onUpdate:modelValue"]),c(I,{modelValue:e.value.instruments[s].page,"onUpdate:modelValue":n=>e.value.instruments[s].page=n,label:"page"},null,8,["modelValue","onUpdate:modelValue"]),c(W,{modelValue:e.value.instruments[s].type,"onUpdate:modelValue":n=>e.value.instruments[s].type=n,options:O(L),label:"type"},null,8,["modelValue","onUpdate:modelValue","options"])])]))),256))]),o("div",Oe,[(v(),f(b,null,S(["l","r1","r2"],s=>se(c($,{onClick:n=>p(s),icon:"add",label:"Add "+s},null,8,["onClick","label"]),[[le,!e.value.instruments[s]]])),64))])])],64))}}),je=k({__name:"Metadata",props:{song:{required:!0,type:Object}},setup(i){const m=i,_=P();w(()=>m.song,u=>{u&&(e.value=u)});const e=h(m.song);w(()=>e.value,u=>{u&&_.updateSong(u)});const p=async()=>{var a;if(!e.value.artist||!e.value.title)return;const u=`artist:${e.value.artist} track:${e.value.title}`,n=(a=(await(await fetch("http://localhost:1234/api/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:u,scope:["spotify"]})})).json()).spotifyTracks)==null?void 0:a[0];n&&(e.value.spotify=n.url,e.value.cover=n.cover,g())},g=async()=>{if(console.log("getMetadata"),!e.value.spotify)return;e.value.spotify.includes("?")&&(e.value.spotify=e.value.spotify.split("?")[0]);const t=await(await fetch("http://localhost:1234/api/spotify/meta",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({forceFetch:!0,spotifyId:e.value.spotify.split("/").pop()})})).json();e.value.bpm=Math.round(t.spotify.features.tempo),e.value.key=t.spotify.features.key+(t.spotify.features.mode==="Minor"?"m":"")};return(u,t)=>(v(),f(b,null,[c(x,{modelValue:e.value.title,"onUpdate:modelValue":t[0]||(t[0]=s=>e.value.title=s),label:"title",onChange:p},null,8,["modelValue"]),c(x,{modelValue:e.value.artist,"onUpdate:modelValue":t[1]||(t[1]=s=>e.value.artist=s),label:"artist",onChange:p},null,8,["modelValue"]),c(x,{modelValue:e.value.spotify,"onUpdate:modelValue":t[2]||(t[2]=s=>e.value.spotify=s),label:"Spotify Link",onChange:g,buttonIcon:"search",onButtonClick:p},null,8,["modelValue"]),c(x,{modelValue:e.value.key,"onUpdate:modelValue":t[3]||(t[3]=s=>e.value.key=s),label:"key"},null,8,["modelValue"]),c(I,{modelValue:e.value.bpm,"onUpdate:modelValue":t[4]||(t[4]=s=>e.value.bpm=s),min:0,label:"bpm"},null,8,["modelValue"]),c(I,{modelValue:e.value.transpose,"onUpdate:modelValue":t[5]||(t[5]=s=>e.value.transpose=s),min:-12,max:12,label:"transpose"},null,8,["modelValue"]),c(I,{modelValue:e.value.octave,"onUpdate:modelValue":t[6]||(t[6]=s=>e.value.octave=s),min:-1,max:1,label:"octave"},null,8,["modelValue"])],64))}}),R=i=>(G("data-v-4c36f5fe"),i=i(),H(),i),Le={class:"group"},We=R(()=>o("h2",null,"Structure",-1)),Re={class:"content"},De={class:"group"},Fe={class:"flex space-between"},ze=R(()=>o("h2",null,"Sections",-1)),Ae={class:"group section"},Je={class:"flex space-between"},Ye={class:"flex"},Ge=["onClick"],He={class:"content"},Ke=["onClick","id"],Qe={class:"flex end"},Xe=["onClick"],Ze={class:"content flex-row"},et={class:"group"},tt=R(()=>o("h2",null,"Melodies",-1)),nt={class:"content"},ot={class:"group"},st={class:"flex"},lt=k({__name:"Structure",props:{song:{required:!0,type:Object}},setup(i){const m=i,_=P();w(()=>m.song,n=>{n&&(e.value=n)});const e=h(m.song);w(()=>e.value,n=>{n&&_.updateSong(n)});const p=h({});window.addEventListener("click",n=>{let a=n.target;for(let d=0;d<5;d++){if(!a)return;if(a.classList.contains("group")||!a.parentElement)break;a=a.parentElement}if(!a)return;const[l,r]=a.id.split(".");for(let d=0;d<e.value.sections.length;d++){const C=e.value.sections[d];for(let N=0;N<C.progression.length;N++){if(d===Number(l)&&N===Number(r)){console.log("found");continue}const y=C.progression[N];delete y.selected}}}),window.addEventListener("chord-click",n=>{const{sectionIndex:a,chordIndex:l}=n.detail,r=`${a}.${l}`,d=()=>{var C;(C=document.getElementById(r))==null||C.scrollIntoView({behavior:"smooth",block:"center"})};if(!p.value.sections){p.value.sections=!0,setTimeout(d,10);return}d()});const g=n=>{e.value.midi&&e.value.midi.splice(n,1)},u=async()=>new Promise((n,a)=>{const l=document.createElement("input");l.type="file",l.accept=".mid",l.onchange=async()=>{if(!l.files){a();return}const r=l.files[0],d=await me(r);if(!d){a();return}n(d)},l.click()}),t=async n=>{const a=await u();a&&e.value.midi&&(e.value.midi[n]=a)},s=async()=>{e.value.midi||(e.value.midi=[]);const n=await u();n&&e.value.midi.push(n)};return(n,a)=>(v(),f(b,null,[o("div",Le,[We,o("div",Re,[(v(!0),f(b,null,S(e.value.structure,(l,r)=>(v(),B(W,{modelValue:e.value.structure[r],"onUpdate:modelValue":[d=>e.value.structure[r]=d,d=>{d==="(none)"&&e.value.structure.splice(r,1)}],options:[...e.value.sections.map(d=>String(d.type)),"(none)"],label:"section"},null,8,["modelValue","onUpdate:modelValue","options"]))),256))]),c($,{onClick:a[0]||(a[0]=l=>e.value.structure.push("")),icon:"add",label:"add section"})]),o("div",De,[o("div",Fe,[ze,o("span",{class:"material-symbols-rounded",onClick:a[1]||(a[1]=l=>p.value.sections=!p.value.sections)},V(p.value.sections?"expand_less":"expand_more"),1)]),p.value.sections?(v(),f(b,{key:0},[c(O(A),{modelValue:e.value.sections,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.sections=l),class:"content"},{item:E(({element:l})=>[o("div",Ae,[o("div",Je,[o("div",Ye,[c(W,{modelValue:l.type,"onUpdate:modelValue":r=>l.type=r,options:O(ee),label:"type"},null,8,["modelValue","onUpdate:modelValue","options"]),c(x,{modelValue:l.name,"onUpdate:modelValue":r=>l.name=r,label:"name"},null,8,["modelValue","onUpdate:modelValue"])]),o("span",{onClick:r=>e.value.sections.splice(e.value.sections.indexOf(l),1),class:"material-symbols-rounded"}," delete ",8,Ge)]),o("div",He,[c(O(A),{modelValue:l.progression,"onUpdate:modelValue":r=>l.progression=r,class:"content"},{item:E(({element:r})=>[o("div",{class:"group chord",onClick:d=>r.selected=!0,id:e.value.sections.indexOf(l)+"."+l.progression.indexOf(r)},[o("div",Qe,[o("span",{onClick:d=>l.progression.splice(l.progression.indexOf(r),1),class:"material-symbols-rounded"},"-",8,Xe)]),o("div",Ze,[c(x,{modelValue:r.chord,"onUpdate:modelValue":d=>r.chord=d,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),c(I,{modelValue:r.duration,"onUpdate:modelValue":d=>r.duration=d,min:1,label:"duration"},null,8,["modelValue","onUpdate:modelValue"])])],8,Ke)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),c($,{onClick:r=>l.progression.push({chord:e.value.key,duration:4}),icon:"add",label:"add chord"},null,8,["onClick"])])]),_:1},8,["modelValue"]),c($,{onClick:a[3]||(a[3]=l=>e.value.sections.push({type:"chorus",progression:[]})),icon:"add",label:"add section"})],64)):U("",!0)]),o("div",et,[tt,o("div",nt,[(v(!0),f(b,null,S(i.song.midi,(l,r)=>(v(),f("div",ot,[c(x,{modelValue:l.name,"onUpdate:modelValue":d=>l.name=d,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),o("div",st,[c($,{onClick:d=>g(r),icon:"delete",label:"delete"},null,8,["onClick"]),c($,{onClick:d=>t(r),icon:"sync",label:"replace"},null,8,["onClick"])])]))),256))]),c($,{onClick:s,icon:"add",label:"add"})])],64))}});const at=q(lt,[["__scopeId","data-v-4c36f5fe"]]),it={class:"settings"},ut={key:0,class:"spotify"},rt=["src"],dt={class:"tabs flex space-between"},ct=["onClick"],pt={class:"configuration"},mt=k({__name:"Editor",props:{song:{required:!0,type:Object}},setup(i){const m=i;P(),w(()=>m.song,g=>{g&&(_.value=g)});const _=h(m.song),e=[{name:"metadata",component:je},{name:"instrument",component:Be},{name:"sections",component:at}],p=h(e[0]);return(g,u)=>(v(),f("div",it,[_.value.spotify?(v(),f("div",ut,[o("iframe",{src:`https://open.spotify.com/embed/track/${_.value.spotify.split("/").pop()}`,width:"100%",height:"80",frameborder:"0",allowfullscreen:"",allow:"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture",loading:"lazy"},null,8,rt)])):U("",!0),o("div",dt,[(v(),f(b,null,S(e,t=>o("label",{key:t.name,class:ae({selected:p.value.name===t.name}),onClick:s=>p.value=t},V(t.name),11,ct)),64))]),o("div",pt,[(v(),B(ie(p.value.component),{song:i.song},null,8,["song"]))])]))}});const vt={key:0,class:"min-width"},_t=k({__name:"MinWidth",props:{minWidth:{required:!0,type:Number},error:{required:!1,type:String,default:"Mobile devices are currently not supported."}},setup(i){const m=h(0);return Y(()=>{m.value=window.innerWidth}),window.addEventListener("resize",()=>{m.value=window.innerWidth}),(_,e)=>m.value<i.minWidth?(v(),f("div",vt,[o("p",null,V(i.error),1)])):ue(_.$slots,"default",{key:1},void 0,!0)}});const J=q(_t,[["__scopeId","data-v-40782251"]]),ft=i=>(G("data-v-23bc623c"),i=i(),H(),i),gt={key:0,class:"editor"},yt=ft(()=>o("span",{class:"material-symbols-rounded"},"arrow_back",-1)),ht={class:"preview"},bt={key:0,class:"pages"},Vt={class:"print a4"},kt={class:"config"},xt=k({__name:"index",setup(i){const m=P();m.songs.length||m.addSong(te);const _=re(),e=de();let p=_.query.s;if(!p){const s=m.addEmptySong();e.push({query:{s},replace:!0}),p=String(s)}const g=Number(p);isNaN(g)&&e.push("/"),m.songs[g]||e.push("/");const u=h(m.songs[g]),t=h();return(s,n)=>{const a=ce("router-link");return v(),B(J,{minWidth:300},{default:E(()=>[u.value?(v(),f("div",gt,[c(a,{to:"/",class:"back-button"},{default:E(()=>[yt]),_:1}),o("div",ht,[t.value?(v(),f("div",bt,[o("span",{onClick:n[0]||(n[0]=(...l)=>t.value.prevPage&&t.value.prevPage(...l)),class:"material-symbols-rounded"}," chevron_left "),pe(" "+V(t.value.getCurrentPage())+" / "+V(t.value.getTotalPages())+" ",1),o("span",{onClick:n[1]||(n[1]=(...l)=>t.value.nextPage&&t.value.nextPage(...l)),class:"material-symbols-rounded"}," chevron_right "),o("span",{class:"material-symbols-rounded",onClick:n[2]||(n[2]=(...l)=>t.value.print&&t.value.print(...l))}," print "),o("span",{class:"material-symbols-rounded",onClick:n[3]||(n[3]=(...l)=>t.value.download&&t.value.download(...l))}," file_download ")])):U("",!0),o("div",Vt,[c(ge,{song:u.value,ref_key:"preview",ref:t},null,8,["song"])])]),c(J,{minWidth:1100,error:""},{default:E(()=>[o("div",kt,[c(mt,{song:u.value},null,8,["song"])])]),_:1})])):U("",!0)]),_:1})}}});const Pt=q(xt,[["__scopeId","data-v-23bc623c"]]);export{Pt as default};
