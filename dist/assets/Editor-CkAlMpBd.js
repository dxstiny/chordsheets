import{d as J,r as B,C as I,c as ne,y as te,v as ae,e as m,K as oe,E as de,M as ie,p as w,N as Y,x as F,o as r,D as L,_ as se,i as G,w as v,a as re,z as ue,F as D,g as z,f as d,h as k,t as g,l as b,k as E,j as q,P as Z,q as ce,s as me}from"./main-CcMCtTv5.js";import{d as ee}from"./vuedraggable.umd-CRy-87Ec.js";/* empty css                                                               */import{d as pe,E as ge}from"./dom-to-image-B_qfc2oV.js";const fe=["placeholder"],ve=J({__name:"EditableText",props:{modelValue:{type:String,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(o,{emit:x}){const U=o,a=B(U.modelValue);I(()=>U.modelValue,$=>a.value=$);const h=B(!1),S=x,s=B(null),y=()=>{U.locked||(h.value=!0,L(()=>{s.value&&s.value.focus()}))},O=ne(()=>U.locked?!0:h.value?!1:a.value||a.value=="0"),T=$=>{a.value=$,S("change",$),S("update:modelValue",$)},H=()=>{s.value&&(s.value.style.height="auto",s.value.style.height=s.value.scrollHeight+"px")};return te(()=>H()),ae(()=>{h.value&&H()}),($,f)=>(r(),m("div",{class:F(["editable-text",{outlined:!o.noOutline&&h.value}]),onDblclick:w(y,["stop"])},[O.value?oe($.$slots,"default",{key:0},void 0,!0):de((r(),m("input",{key:1,ref_key:"area",ref:s,type:"text",class:"textarea","onUpdate:modelValue":f[0]||(f[0]=V=>a.value=V),onChange:f[1]||(f[1]=V=>T(V.target.value)),onInput:f[2]||(f[2]=V=>H()),onClick:f[3]||(f[3]=w(V=>h.value=!0,["stop"])),onKeydown:[f[4]||(f[4]=Y(V=>h.value=!1,["enter"])),f[5]||(f[5]=Y(V=>h.value=!1,["esc"]))],onBlur:f[6]||(f[6]=V=>h.value=!1),placeholder:o.placeholder},null,40,fe)),[[ie,a.value]])],34))}}),C=se(ve,[["__scopeId","data-v-793c6cbc"]]),R=J({__name:"EditableNumber",props:{modelValue:{type:Number,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(o,{emit:x}){const U=o,a=B(String(U.modelValue));I(()=>U.modelValue,s=>a.value=String(s));const h=x,S=s=>{const y=Number(s);a.value=s,h("change",y),h("update:modelValue",y)};return(s,y)=>(r(),G(C,{modelValue:a.value,"onUpdate:modelValue":y[0]||(y[0]=O=>a.value=O),onChange:S,"no-outline":o.noOutline,locked:o.locked,placeholder:o.placeholder},{default:v(()=>[oe(s.$slots,"default")]),_:3},8,["modelValue","no-outline","locked","placeholder"]))}}),j=()=>window.innerWidth<=800,_=o=>(ce("data-v-eed478d3"),o=o(),me(),o),he={class:"editor__header"},ke={class:"wrap-to-line"},ye={class:"info"},Ve=_(()=>d("span",{class:"material-symbols-rounded"},"music_note",-1)),be={class:"info"},Ce=_(()=>d("span",{class:"material-symbols-rounded"},"piano",-1)),we={class:"info"},Ue={class:"material-symbols-rounded"},$e={class:"info"},Ee=_(()=>d("span",{class:"material-symbols-rounded"}," check ",-1)),Se={class:"capitalise"},Me=["onClick"],Pe=_(()=>d("span",{class:"material-symbols-rounded"}," add ",-1)),Be={key:0},_e={class:"instruments"},Ne={class:"instrument"},De=["onClick"],xe={class:"flex space-between"},Oe={class:"flex gap-2"},He=_(()=>d("span",{class:"material-symbols-rounded"}," volume_up ",-1)),Ke={class:"settings"},ze={class:"muted"},Ie=_(()=>d("span",{class:"material-symbols-rounded"}," add ",-1)),Te=_(()=>d("hr",null,null,-1)),We=["id"],qe={class:"name"},Le={key:0,class:"buttons"},Ae=["onClick"],Re=["onClick"],je={key:1,class:"progression"},Fe=["onClick"],Ge=_(()=>d("span",{class:"material-symbols-rounded"}," add ",-1)),Je=["id","onMousedown","onMouseup"],Xe=["onClick"],Qe=["id"],Ye={class:"name"},Ze={class:"progression"},et=["id"],tt={key:3,class:"pageNumber"},ot={key:4,class:"sectionName"},st=J({__name:"Editor",props:{song:{type:Object,required:!0},printing:{type:Boolean,default:!1},pageOffset:{type:Number,default:0},sectionName:{type:String,required:!1},disableHotkeys:{type:Boolean,default:!1}},emits:["onPageCount"],setup(o,{expose:x,emit:U}){const a=o,h=re(),S=B(!1),s=B(a.printing),y=B(),O=(l,e)=>{const u=a.song.sections[l].progression[e],p={chord:u.chord,duration:u.duration};a.song.sections[l].progression.splice(e+1,0,p)},T=l=>{if(!a.disableHotkeys){if(l.key==="Delete")for(const e of a.song.sections)e.progression=e.progression.filter(i=>!i.selected);if(l.ctrlKey&&(l.key==="d"||l.key==="b")){l.preventDefault();for(const e of a.song.sections){const i=e.progression.filter(u=>u.selected);e.progression.splice(e.progression.indexOf(i[i.length-1])+1,0,...i.map(u=>({chord:u.chord,duration:u.duration,selected:!0}))),i.forEach(u=>u.selected=!1)}}l.ctrlKey&&l.key==="p"&&(l.preventDefault(),le())}},H=(l,e)=>{if(e.button===2||j())return;const i=e.target;if(e.offsetX>i.clientWidth-10){e.preventDefault(),e.stopImmediatePropagation(),S.value=!0;const u=i.getBoundingClientRect().width/l.duration;let p=0;const t=n=>{const P=n.clientX-i.getBoundingClientRect().left;p=Math.round(P/u),l.duration=Math.max(1,Math.min(16,p))},c=n=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",c),S.value=!1,n.stopImmediatePropagation()};window.addEventListener("mousemove",t),window.addEventListener("mouseup",c)}},$=(l,e)=>{let i=l.selected;if(!e.shiftKey)for(const u of a.song.sections)for(const p of u.progression)p.selected=!1;l.selected=!i},f=l=>{a.song.sections.splice(l,1)},V=l=>{const e=a.song.sections[l],i={type:e.type,progression:e.progression.map(u=>({chord:u.chord,duration:u.duration})),page:0};a.song.sections.splice(l+1,0,i)},X=async l=>{const e=y.value.querySelectorAll(".editor");let i=e[0];const u=i.clientHeight/i.clientWidth;for(let c=0;c<e.length;c++){if(i=e[c],!i)continue;var p=l.internal.pageSize.getWidth(),t=l.internal.pageSize.getHeight();const n=2,P=await pe.toJpeg(i,{height:i.clientHeight*n,width:i.clientWidth*n,style:{transform:`scale(${n}) translate(${i.clientWidth/2/n}px, ${i.clientHeight/2/n}px)`}});t=u*p,l.addImage(P,"JPG",0,0,p,t),c+1<e.length&&l.addPage()}return l};let W;const Q=async()=>{s.value=!0,a.song.sections.length&&!a.printing&&await new Promise(i=>{W=i});const l=new ge({orientation:"portrait",unit:"px",format:"a4"});return await X(l),s.value=a.printing,l},le=async()=>{await h.prepareRender();const l=await Q();l&&(l.autoPrint(),window.open(l.output("bloburl"),"_blank"))};te(()=>{window.addEventListener("keydown",T),K()}),ue(()=>{window.removeEventListener("keydown",T)});const M=B([]),K=()=>{if(a.song.sections.length==0){M.value=[{start:0,end:0}],A("onPageCount",1);return}if(!s.value||M.value.length==0){M.value=[{start:0,end:a.song.sections.length}],s.value&&a.song.sections.length>0&&L(K),A("onPageCount",1);return}const l=y.value.querySelectorAll(".section");if(l.length==0)return;const e=l[0].parentElement,i=getComputedStyle(e),u=e.clientHeight-parseFloat(i.paddingBottom);for(let p=0;p<l.length;p++){const t=l[p];if(t.offsetTop+t.offsetHeight>u){M.value[M.value.length-1].end=p,M.value.push({start:p,end:a.song.sections.length}),L(K);return}}A("onPageCount",M.value.length),W==null||W()};I(()=>a.song,K,{deep:!0}),I(s,()=>L(K)),I(()=>a.printing,()=>{s.value=a.printing}),x({renderTo:X,render:Q,name:()=>a.song.title});const A=U;return(l,e)=>(r(),m("div",{ref_key:"parent",ref:y,class:"pageWrapper"},[(r(!0),m(D,null,z(M.value,(i,u)=>{var p;return r(),m("div",{class:F(["editor",{resizing:S.value,print:s.value}]),onDragover:e[13]||(e[13]=w(()=>{},["prevent"]))},[u==0?(r(),m(D,{key:0},[d("div",he,[k(C,{locked:s.value,modelValue:o.song.artist,"onUpdate:modelValue":e[0]||(e[0]=t=>o.song.artist=t),class:"left",placeholder:"Click to edit artist name","no-outline":""},{default:v(()=>[d("h3",null,g(o.song.artist),1)]),_:1},8,["locked","modelValue"]),k(C,{locked:s.value,modelValue:o.song.title,"onUpdate:modelValue":e[1]||(e[1]=t=>o.song.title=t),class:"left h1",placeholder:"Click to edit song title","no-outline":""},{default:v(()=>[d("h1",null,g(o.song.title),1)]),_:1},8,["locked","modelValue"])]),d("div",ke,[d("div",ye,[Ve,k(R,{locked:s.value,modelValue:o.song.bpm,"onUpdate:modelValue":e[2]||(e[2]=t=>o.song.bpm=t),class:"left short",placeholder:"120"},{default:v(()=>[b(g(o.song.bpm),1)]),_:1},8,["locked","modelValue"]),b(" BPM ")]),d("div",be,[Ce,k(C,{locked:s.value,modelValue:o.song.key,"onUpdate:modelValue":e[3]||(e[3]=t=>o.song.key=t),class:"left short",placeholder:"C"},{default:v(()=>[b(g(o.song.key),1)]),_:1},8,["locked","modelValue"])]),d("div",we,[d("span",Ue,g(o.song.transpose>0?"arrow_upward":o.song.transpose<0?"arrow_downward":"drag_handle"),1),k(R,{locked:s.value,modelValue:o.song.transpose,"onUpdate:modelValue":e[4]||(e[4]=t=>o.song.transpose=t),class:"left short",placeholder:"0"},{default:v(()=>[b(g(o.song.transpose),1)]),_:1},8,["locked","modelValue"])]),o.song.options?(r(!0),m(D,{key:0},z(o.song.options,(t,c)=>(r(),m("div",$e,[Ee,k(C,{locked:s.value,modelValue:o.song.options[c],"onUpdate:modelValue":n=>o.song.options[c]=n,class:"left",placeholder:"Option"},{default:v(()=>[d("span",Se,g(t),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?E("",!0):(r(),m("span",{key:0,onClick:n=>o.song.options.splice(c,1),class:"delete material-symbols-rounded"}," delete ",8,Me))]))),256)):E("",!0),d("div",{class:"info add-option",onClick:e[5]||(e[5]=t=>o.song.options?o.song.options.push("Sustain"):o.song.options=["Sustain"])},[Pe,b(" Add Option ")])]),(p=o.song.instruments)!=null&&p.length?(r(),m("hr",Be)):E("",!0),d("div",_e,[(r(!0),m(D,null,z(o.song.instruments,(t,c)=>(r(),m("div",Ne,[s.value?E("",!0):(r(),m("span",{key:0,onClick:n=>o.song.instruments.splice(c,1),class:"delete material-symbols-rounded"}," delete ",8,De)),d("div",xe,[k(C,{locked:s.value,modelValue:t.for,"onUpdate:modelValue":n=>t.for=n,class:"left short",placeholder:"Click to edit instrument","no-outline":""},{default:v(()=>[d("span",null,g(t.for),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),d("span",Oe,[He,k(R,{locked:s.value,modelValue:t.volume,"onUpdate:modelValue":n=>t.volume=n,class:"left short",placeholder:"100"},{default:v(()=>[b(g(t==null?void 0:t.volume),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"])])]),d("div",Ke,[k(C,{locked:s.value,modelValue:t.name,"onUpdate:modelValue":n=>t.name=n,class:"left h3",placeholder:"Click to edit instrument name","no-outline":""},{default:v(()=>[d("h3",null,g(t.name),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),d("span",ze,[k(C,{locked:s.value,modelValue:t.type,"onUpdate:modelValue":n=>t.type=n,class:"left",placeholder:"Click to edit instrument type","no-outline":""},{default:v(()=>[b(g(t==null?void 0:t.type),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"])])])]))),256)),d("div",{class:"instrument add-option",onClick:e[6]||(e[6]=t=>o.song.instruments.push({name:"ConcertGrand",for:"R1",type:"Piano",volume:100}))},[Ie,b(" Add Instrument ")])]),Te],64)):E("",!0),s.value?(r(!0),m(D,{key:2},z(a.song.sections.slice(i.start,i.end),(t,c)=>(r(),m("div",{class:"section printable",id:`section-${c}`},[d("span",Ye,g(t.type),1),d("div",Ze,[(r(!0),m(D,null,z(t.progression,(n,P)=>(r(),m("div",{class:"chord",ref_for:!0,ref:"chordElements",id:`chord-${c}-${P}`,style:Z({"--cols":n.duration})},g(n.chord),13,et))),256))])],8,Qe))),256)):(r(),G(q(ee),{key:1,modelValue:o.song.sections,"onUpdate:modelValue":e[11]||(e[11]=t=>o.song.sections=t),class:"editor__content",onDragover:e[12]||(e[12]=w(()=>{},["stop"])),itemKey:"id",disabled:q(j)()},{item:v(({element:t,index:c})=>[d("div",{class:"section",id:`section-${c}`},[k(C,{locked:s.value,modelValue:t.type,"onUpdate:modelValue":n=>t.type=n,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:v(()=>[d("span",qe,g(t.type),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?E("",!0):(r(),m("div",Le,[d("span",{class:"button material-symbols-rounded",onClick:n=>V(c)}," content_copy ",8,Ae),d("span",{class:"button material-symbols-rounded",onClick:n=>f(c)}," delete ",8,Re)])),t.progression.length===0?(r(),m("div",je,[d("div",{class:"chord create",style:{"--cols":4},onClick:w(n=>t.progression.push({chord:"C",duration:4}),["stop"])},[Ge,b(" Add Chord ")],8,Fe)])):(r(),G(q(ee),{key:2,modelValue:t.progression,"onUpdate:modelValue":n=>t.progression=n,class:"progression",onDragover:e[10]||(e[10]=w(()=>{},["stop"])),itemKey:"id",disabled:q(j)()},{item:v(({element:n,index:P})=>[d("div",{class:F(["chord",n.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${c}-${P}`,onMousedown:N=>H(n,N),onMouseup:N=>$(n,N),onClick:e[9]||(e[9]=w(()=>{},["stop"])),style:Z({"--cols":n.duration})},[k(C,{locked:s.value,modelValue:n.chord,"onUpdate:modelValue":N=>n.chord=N,"no-outline":"",placeholder:"C"},{default:v(()=>[b(g(n.chord),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?E("",!0):(r(),m("span",{key:0,class:"insert_chord_here",onMousedown:e[7]||(e[7]=w(()=>{},["stop"])),onMouseup:e[8]||(e[8]=w(()=>{},["stop"])),onClick:w(N=>O(c,P),["stop"])},null,40,Xe))],46,Je)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]))],8,We)]),_:2},1032,["modelValue","disabled"])),s.value?(r(),m("span",tt,g(u+o.pageOffset+1),1)):E("",!0),s.value&&o.sectionName?(r(),m("span",ot,g(o.sectionName),1)):E("",!0)],34)}),256))],512))}}),it=se(st,[["__scopeId","data-v-eed478d3"]]);export{it as E,C as a,j as i};
