import{d as X,r as E,D as z,c as Q,s as Y,B as oe,o as m,b as k,E as te,x as se,y as ne,n as g,z as G,A as N,G as T,_ as Z,a as le,v as ae,F as I,f as L,e as s,g as y,w as p,t as h,k as w,j as R,h as K,i as W,H as j,p as de,q as ie,I as re}from"./main-46LVdHYM.js";import{d as q}from"./vuedraggable.umd-DTWMXNQX.js";import{d as ue,E as ce}from"./dom-to-image-CTDCgk0n.js";const pe=["placeholder"],me=X({__name:"EditableText",props:{modelValue:{type:String,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(n,{emit:$}){const d=n,M=E(d.modelValue);z(()=>d.modelValue,_=>M.value=_);const f=E(!1),b=$,C=E(null),x=()=>{d.locked||(f.value=!0,T(()=>{C.value&&C.value.focus()}))},O=Q(()=>d.locked?!0:f.value?!1:M.value||M.value=="0"),A=_=>{M.value=_,b("change",_),b("update:modelValue",_)},B=()=>{C.value&&(C.value.style.height="auto",C.value.style.height=C.value.scrollHeight+"px")};return Y(()=>B()),oe(()=>{f.value&&B()}),(_,u)=>(m(),k("div",{class:N(["editable-text",{outlined:!n.noOutline&&f.value}]),onDblclick:g(x,["stop"])},[O.value?te(_.$slots,"default",{key:0},void 0,!0):se((m(),k("input",{key:1,ref_key:"area",ref:C,type:"text",class:"textarea","onUpdate:modelValue":u[0]||(u[0]=U=>M.value=U),onChange:u[1]||(u[1]=U=>A(U.target.value)),onInput:u[2]||(u[2]=U=>B()),onClick:u[3]||(u[3]=g(U=>f.value=!0,["stop"])),onKeydown:[u[4]||(u[4]=G(U=>f.value=!1,["enter"])),u[5]||(u[5]=G(U=>f.value=!1,["esc"]))],onBlur:u[6]||(u[6]=U=>f.value=!1),placeholder:n.placeholder},null,40,pe)),[[ne,M.value]])],34))}}),V=Z(me,[["__scopeId","data-v-793c6cbc"]]),S=n=>(de("data-v-66e20847"),n=n(),ie(),n),ge={class:"editor__header"},fe={class:"wrap-to-line"},ve={class:"info"},he=S(()=>s("span",{class:"material-symbols-rounded"},"music_note",-1)),ye={class:"info"},Ve=S(()=>s("span",{class:"material-symbols-rounded"},"piano",-1)),ke={class:"info"},Ce={class:"material-symbols-rounded"},we={class:"info"},be=S(()=>s("span",{class:"material-symbols-rounded"}," check ",-1)),Ue={class:"capitalise"},Se=["onClick"],_e=S(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),$e=S(()=>s("hr",null,null,-1)),Me={class:"instruments"},Ee={class:"instrument"},Pe=["onClick"],Be={class:"flex space-between"},De={class:"flex gap-2"},Ie=S(()=>s("span",{class:"material-symbols-rounded"}," volume_up ",-1)),xe={class:"settings"},Oe={class:"muted"},Ae=S(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),He=S(()=>s("hr",null,null,-1)),Le=["id"],Ne={class:"name"},Te={class:"buttons"},ze=["onClick"],Ke=["onClick"],We={key:0,class:"progression"},qe=["onClick"],Je=S(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Ge=["id","onMousedown","onMouseup"],Re=["onClick"],je=["id"],Fe={class:"name"},Xe={class:"buttons"},Qe=["onClick"],Ye=["onClick"],Ze={key:0,class:"progression"},eo=["onClick"],oo=S(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),to=["id","onMousedown","onMouseup"],so=["onClick"],no=S(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),lo=X({__name:"Editor",props:{song:{type:Object,required:!0},printing:{type:Boolean,default:!1}},setup(n,{expose:$}){const d=n,M=le(),f=E(!1),b=E(d.printing),C=E(),x=(l,e)=>{const r=d.song.sections[l].progression[e],o={chord:r.chord,duration:r.duration};d.song.sections[l].progression.splice(e+1,0,o)},O=l=>{if(l.key==="Delete")for(const e of d.song.sections)e.progression=e.progression.filter(a=>!a.selected);if(l.ctrlKey&&(l.key==="d"||l.key==="b")){l.preventDefault();for(const e of d.song.sections){const a=e.progression.filter(r=>r.selected);e.progression.splice(e.progression.indexOf(a[a.length-1])+1,0,...a.map(r=>({chord:r.chord,duration:r.duration,selected:!0}))),a.forEach(r=>r.selected=!1)}}l.ctrlKey&&l.key==="p"&&(l.preventDefault(),ee())},A=(l,e)=>{if(e.button===2)return;const a=e.target;if(e.offsetX>a.clientWidth-10){e.preventDefault(),e.stopImmediatePropagation(),f.value=!0;const r=a.getBoundingClientRect().width/l.duration;let o=0;const i=v=>{const c=v.clientX-a.getBoundingClientRect().left;o=Math.round(c/r),l.duration=Math.max(1,Math.min(16,o))},t=v=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",t),f.value=!1,v.stopImmediatePropagation()};window.addEventListener("mousemove",i),window.addEventListener("mouseup",t)}},B=(l,e)=>{let a=l.selected;if(!e.shiftKey)for(const r of d.song.sections)for(const o of r.progression)o.selected=!1;l.selected=!a},_=l=>{d.song.sections.splice(l,1)},u=l=>{const e=d.song.sections[l],a={type:e.type,progression:e.progression.map(r=>({chord:r.chord,duration:r.duration})),page:0};d.song.sections.splice(l+1,0,a)},U=async l=>{const e=C.value.querySelectorAll(".editor");let a=e[0];const r=a.clientHeight/a.clientWidth;for(let t=0;t<e.length;t++){if(a=e[t],!a)continue;var o=l.internal.pageSize.getWidth(),i=l.internal.pageSize.getHeight();const v=2,c=await ue.toJpeg(a,{height:a.clientHeight*v,width:a.clientWidth*v,style:{transform:`scale(${v}) translate(${a.clientWidth/2/v}px, ${a.clientHeight/2/v}px)`}});i=r*o,l.addImage(c,"JPG",0,0,o,i),t+1<e.length&&l.addPage()}return l};let H;const J=async()=>{b.value=!0,d.song.sections.length&&!d.printing&&await new Promise(a=>{H=a});const l=new ce({orientation:"portrait",unit:"px",format:"a4"});return await U(l),b.value=d.printing,l},ee=async()=>{await M.prepareRender();const l=await J();l&&(l.autoPrint(),window.open(l.output("bloburl"),"_blank"))};Y(()=>{window.addEventListener("keydown",O),D()}),ae(()=>{window.removeEventListener("keydown",O)});const P=E([]),D=()=>{if(d.song.sections.length==0){P.value=[{start:0,end:0}];return}if(!b.value||P.value.length==0){P.value=[{start:0,end:d.song.sections.length}],b.value&&d.song.sections.length>0&&T(D);return}const l=C.value.querySelectorAll(".section");if(l.length==0)return;const e=l[0].parentElement,a=getComputedStyle(e),r=e.clientHeight-parseFloat(a.paddingBottom);for(let o=0;o<l.length;o++){const i=l[o];if(i.offsetTop+i.offsetHeight>r){P.value[P.value.length-1].end=o,P.value.push({start:o,end:d.song.sections.length}),T(D);return}}H==null||H()};return z(()=>d.song,D,{deep:!0}),z(b,()=>T(D)),$({renderTo:U,render:J,name:()=>d.song.title}),(l,e)=>(m(),k("div",{ref_key:"parent",ref:C},[(m(!0),k(I,null,L(P.value,(a,r)=>(m(),k("div",{class:N(["editor",{resizing:f.value,print:b.value}]),onDragover:e[18]||(e[18]=g(()=>{},["prevent"]))},[r==0?(m(),k(I,{key:0},[s("div",ge,[y(V,{modelValue:n.song.artist,"onUpdate:modelValue":e[0]||(e[0]=o=>n.song.artist=o),class:"left",placeholder:"Click to edit artist name","no-outline":""},{default:p(()=>[s("h3",null,h(n.song.artist),1)]),_:1},8,["modelValue"]),y(V,{modelValue:n.song.title,"onUpdate:modelValue":e[1]||(e[1]=o=>n.song.title=o),class:"left h1",placeholder:"Click to edit song title","no-outline":""},{default:p(()=>[s("h1",null,h(n.song.title),1)]),_:1},8,["modelValue"])]),s("div",fe,[s("div",ve,[he,y(V,{modelValue:n.song.bpm,"onUpdate:modelValue":e[2]||(e[2]=o=>n.song.bpm=o),class:"left short",placeholder:"120"},{default:p(()=>[w(h(n.song.bpm),1)]),_:1},8,["modelValue"]),w(" BPM ")]),s("div",ye,[Ve,y(V,{modelValue:n.song.key,"onUpdate:modelValue":e[3]||(e[3]=o=>n.song.key=o),class:"left short",placeholder:"C"},{default:p(()=>[w(h(n.song.key),1)]),_:1},8,["modelValue"])]),s("div",ke,[s("span",Ce,h(n.song.transpose>0?"arrow_upward":n.song.transpose<0?"arrow_downward":"drag_handle"),1),y(V,{modelValue:n.song.transpose,"onUpdate:modelValue":e[4]||(e[4]=o=>n.song.transpose=o),class:"left short",placeholder:"0"},{default:p(()=>[w(h(n.song.transpose),1)]),_:1},8,["modelValue"])]),n.song.options?(m(!0),k(I,{key:0},L(n.song.options,(o,i)=>(m(),k("div",we,[be,y(V,{modelValue:n.song.options[i],"onUpdate:modelValue":t=>n.song.options[i]=t,class:"left",placeholder:"Option"},{default:p(()=>[s("span",Ue,h(o),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{onClick:t=>n.song.options.splice(i,1),class:"delete material-symbols-rounded"}," delete ",8,Se)]))),256)):R("",!0),s("div",{class:"info add-option",onClick:e[5]||(e[5]=o=>n.song.options?n.song.options.push("Sustain"):n.song.options=["Sustain"])},[_e,w(" Add Option ")])]),$e,s("div",Me,[(m(!0),k(I,null,L(n.song.instruments,(o,i)=>(m(),k("div",Ee,[s("span",{onClick:t=>n.song.instruments.splice(i,1),class:"delete material-symbols-rounded"}," delete ",8,Pe),s("div",Be,[y(V,{modelValue:o.for,"onUpdate:modelValue":t=>o.for=t,class:"left short",placeholder:"Click to edit instrument","no-outline":""},{default:p(()=>[s("span",null,h(o.for),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",De,[Ie,y(V,{modelValue:o.volume,"onUpdate:modelValue":t=>o.volume=t,class:"left short",placeholder:"100"},{default:p(()=>[w(h(o==null?void 0:o.volume),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),s("div",xe,[y(V,{modelValue:o.name,"onUpdate:modelValue":t=>o.name=t,class:"left h3",placeholder:"Click to edit instrument name","no-outline":""},{default:p(()=>[s("h3",null,h(o.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",Oe,[y(V,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit instrument type","no-outline":""},{default:p(()=>[w(h(o==null?void 0:o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]))),256)),s("div",{class:"instrument add-option",onClick:e[6]||(e[6]=o=>n.song.instruments.push({name:"ConcertGrand",for:"R1",type:"Piano",volume:100}))},[Ae,w(" Add Instrument ")])]),He],64)):R("",!0),b.value?(m(!0),k(I,{key:2},L(d.song.sections.slice(a.start,a.end),(o,i)=>(m(),k("div",{class:"section",id:`section-${i}`},[y(V,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:p(()=>[s("span",Fe,h(o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("div",Xe,[s("span",{class:"button material-symbols-rounded",onClick:t=>u(i)}," content_copy ",8,Qe),s("span",{class:"button material-symbols-rounded",onClick:t=>_(i)}," delete ",8,Ye)]),o.progression.length===0?(m(),k("div",Ze,[s("div",{class:"chord create",style:{"--cols":4},onClick:g(t=>o.progression.push({chord:"C",duration:4}),["stop"])},[oo,w(" Add Chord ")],8,eo)])):(m(),K(W(q),{key:1,modelValue:o.progression,"onUpdate:modelValue":t=>o.progression=t,class:"progression",onDragover:e[16]||(e[16]=g(()=>{},["stop"]))},{item:p(({element:t,index:v})=>[s("div",{class:N(["chord",t.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${i}-${v}`,onMousedown:c=>A(t,c),onMouseup:c=>B(t,c),onClick:e[15]||(e[15]=g(()=>{},["stop"])),style:j({"--cols":t.duration})},[y(V,{modelValue:t.chord,"onUpdate:modelValue":c=>t.chord=c,"no-outline":"",placeholder:"C"},{default:p(()=>[w(h(t.chord),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{class:"insert_chord_here",onMousedown:e[13]||(e[13]=g(()=>{},["stop"])),onMouseup:e[14]||(e[14]=g(()=>{},["stop"])),onClick:g(c=>x(i,v),["stop"])},null,40,so)],46,to)]),_:2},1032,["modelValue","onUpdate:modelValue"]))],8,je))),256)):(m(),K(W(q),{key:1,modelValue:n.song.sections,"onUpdate:modelValue":e[11]||(e[11]=o=>n.song.sections=o),class:"editor__content",onDragover:e[12]||(e[12]=g(()=>{},["stop"]))},{item:p(({element:o,index:i})=>[s("div",{class:"section",id:`section-${i}`},[y(V,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:p(()=>[s("span",Ne,h(o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("div",Te,[s("span",{class:"button material-symbols-rounded",onClick:t=>u(i)}," content_copy ",8,ze),s("span",{class:"button material-symbols-rounded",onClick:t=>_(i)}," delete ",8,Ke)]),o.progression.length===0?(m(),k("div",We,[s("div",{class:"chord create",style:{"--cols":4},onClick:g(t=>o.progression.push({chord:"C",duration:4}),["stop"])},[Je,w(" Add Chord ")],8,qe)])):(m(),K(W(q),{key:1,modelValue:o.progression,"onUpdate:modelValue":t=>o.progression=t,class:"progression",onDragover:e[10]||(e[10]=g(()=>{},["stop"]))},{item:p(({element:t,index:v})=>[s("div",{class:N(["chord",t.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${i}-${v}`,onMousedown:c=>A(t,c),onMouseup:c=>B(t,c),onClick:e[9]||(e[9]=g(()=>{},["stop"])),style:j({"--cols":t.duration})},[y(V,{modelValue:t.chord,"onUpdate:modelValue":c=>t.chord=c,"no-outline":"",placeholder:"C"},{default:p(()=>[w(h(t.chord),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{class:"insert_chord_here",onMousedown:e[7]||(e[7]=g(()=>{},["stop"])),onMouseup:e[8]||(e[8]=g(()=>{},["stop"])),onClick:g(c=>x(i,v),["stop"])},null,40,Re)],46,Ge)]),_:2},1032,["modelValue","onUpdate:modelValue"]))],8,Le)]),_:2},1032,["modelValue"])),s("div",{class:"add-section",id:"add-section",onClick:e[17]||(e[17]=o=>n.song.sections.push({type:"New Section",progression:[]}))},[no,w(" Add Section ")])],34))),256))],512))}}),uo=Z(lo,[["__scopeId","data-v-66e20847"]]),F="chordsheets.history",co=re("history",()=>{const $=E(JSON.parse(localStorage.getItem(F)||"[]")),d=Q(()=>JSON.stringify($.value));return z($,()=>{localStorage.setItem(F,d.value)},{deep:!0}),{history:$,songEdited:f=>{const b=new Date().toISOString();$.value=[{songId:f,date:b},...$.value.filter(C=>C.songId!==f).slice(0,9)]}}});export{uo as E,co as u};
