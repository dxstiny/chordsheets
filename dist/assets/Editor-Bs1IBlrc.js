import{d as le,r as f,a as ae,L as me,c as F,y as ie,z as de,o as l,e as i,E as ge,M as he,f as e,j as C,F as b,g as I,N as _e,p as D,x as B,t as r,k,_ as re,b as fe,O as ye,h as R,w as L,l as y,i as E,A as ke,m as we,n as Se,q as be,s as De}from"./main-CcMCtTv5.js";import{E as Ce}from"./dom-to-image-B_qfc2oV.js";import{d as W}from"./vuedraggable.umd-CRy-87Ec.js";import{a as ne,E as oe,i as G}from"./Editor-CkAlMpBd.js";import{S as Q}from"./Song-zNCzVP0D.js";/* empty css                                                               */const $e={class:"search-results"},Ve=["onClick","onKeydown"],Ee={class:"cover"},Ae=["src"],xe={class:"info"},Me={key:0},Pe={key:0},Le=le({__name:"SongSearcher",emits:["select"],setup(N,{emit:A}){const M=f(""),T=ae(),v=f(T.songs),p=f(-1),m=f(0),w=f(null),$=f(!1),V=me.debounce(()=>{v.value=T.songs.filter(g=>JSON.stringify({title:g.title,artist:g.artist,bpm:g.bpm,key:g.key}).toLowerCase().includes(M.value.toLowerCase()))},300),U=g=>{$.value&&(g.key==="ArrowDown"?(g.preventDefault(),p.value<2?p.value=Math.min(p.value+1,v.value.length-1):m.value<v.value.length-3&&(m.value=Math.min(m.value+1,v.value.length-1))):g.key==="ArrowUp"?(g.preventDefault(),p.value>0?p.value=Math.max(p.value-1,0):m.value>0&&(m.value=Math.max(m.value-1,0))):g.key==="Enter"&&(g.preventDefault(),console.log("selecting",v.value[p.value+m.value],p.value),P("select",v.value[p.value+m.value])))},K=F(()=>v.value.slice(m.value,Math.min(m.value+3,v.value.length)));ie(()=>{window.addEventListener("keydown",U),w.value&&w.value.focus()}),de(()=>{window.removeEventListener("keydown",U)});const P=A;return(g,o)=>(l(),i("div",{class:"content",onFocusin:o[2]||(o[2]=u=>$.value=!0),onFocusout:o[3]||(o[3]=u=>$.value=!1)},[ge(e("input",{type:"text",placeholder:"Search...","onUpdate:modelValue":o[0]||(o[0]=u=>M.value=u),ref_key:"searchField",ref:w,onInput:o[1]||(o[1]=(...u)=>C(V)&&C(V)(...u))},null,544),[[he,M.value]]),e("div",$e,[(l(!0),i(b,null,I(K.value,u=>(l(),i("div",{key:u.id,tabindex:"0",onClick:j=>P("select",u),onKeydown:_e(D(j=>P("select",u),["prevent","stop"]),["enter"]),class:B(["song",{selected:p.value+m.value===v.value.indexOf(u)}])},[e("div",Ee,[e("img",{src:u.cover||"placeholders/song.svg"},null,8,Ae)]),e("div",xe,[e("h2",null,r(u.title),1),e("span",null,r(u.artist),1)])],42,Ve))),128)),v.value.length===0?(l(),i("span",Me,"No results found")):k("",!0)]),v.value.length?(l(),i("span",Pe,r(v.value.length)+" songs found",1)):k("",!0)],32))}}),Ne=re(Le,[["__scopeId","data-v-e36d027d"]]),c=N=>(be("data-v-176976d0"),N=N(),De(),N),Te={class:"page-title"},Ue={class:"items"},Fe={class:"container"},Ie={class:"section-checks"},Ke=["title"],Oe=c(()=>e("span",{class:"material-symbols-rounded"}," warning ",-1)),Re=c(()=>e("span",{class:"material-symbols-rounded"}," music_note ",-1)),Be={title:"Pages"},je=c(()=>e("span",{class:"material-symbols-rounded"}," book ",-1)),Je={class:"duration",title:"Estimated duration (1 song = 4 minutes)"},qe=c(()=>e("span",{class:"material-symbols-rounded"}," schedule ",-1)),ze=["onClick"],He=c(()=>e("span",{class:"material-symbols-rounded"}," delete ",-1)),We=["onClick"],Ge=c(()=>e("span",{class:"material-symbols-rounded"}," add ",-1)),Qe=c(()=>e("span",{class:"material-symbols-rounded"}," add ",-1)),Xe={key:0,class:"preview"},Ye={class:"toolbar"},Ze=c(()=>e("div",{class:"divider"},null,-1)),es={class:"content"},ss={key:0},ts={key:0},ns={key:2},os={key:3},ls=c(()=>e("h2",null,"Insights",-1)),as={class:"insights"},is={class:"container"},ds=c(()=>e("span",{class:"muted"},"Sections",-1)),rs={class:"container"},us=c(()=>e("span",{class:"muted"},"Songs",-1)),cs={class:"container"},vs=c(()=>e("span",{class:"muted"},"Pages",-1)),ps={class:"container"},ms=c(()=>e("span",{class:"muted"},"of playing time",-1)),gs={class:"container"},hs=c(()=>e("span",{class:"muted"},"including breaks",-1)),_s={class:"container warning"},fs={class:"muted"},ys={class:"content"},ks={class:"preview-container"},ws={class:"preview scale-sm"},Ss=c(()=>e("h2",null,"Rendering...",-1)),bs=c(()=>e("p",null," Please wait while we render your chord sheets. This may take a while. ",-1)),Ds={class:"row"},Cs=["value","max"],$s=le({__name:"Editor",setup(N){const A=ae(),M=fe(),T=ke(),v=we(),p=f(),m=f(),w=f(-1),$=F(()=>A.songs.filter(t=>!o.value.sections.some(s=>s.songs.some(a=>a.id===t.id)))),V=F(()=>A.songs.filter(t=>o.value.sections.some(s=>s.songs.some(a=>a.id===t.id))));if(T.params.id==="new"){const{id:t}=M.addEmptySetlist();v.push({path:`/setlist/${t}`,replace:!0})}const U=async()=>{var a,d;(a=m.value)==null||a.showModal();let t=new Ce({orientation:"portrait",unit:"px",format:"a4"});w.value=0;const s=p.value??[];for(const[x,n]of s.entries())await n.renderTo(t),w.value++,x<s.length-1&&t.addPage();return(d=m.value)==null||d.close(),w.value=-1,t},K=async()=>{const t=await U();t.autoPrint(),t.output("dataurlnewwindow")},P=async()=>{(await U()).save(o.value.name+".pdf")},g=async()=>{const t=o.value.sections.map(x=>({type:"setlist",...x,songs:x.songs.map(n=>O(n))})),s={...o.value,sections:t},a="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(s)),d=document.createElement("a");d.setAttribute("href",a),d.setAttribute("download",`${o.value.name}.chordsheets.json`),document.body.appendChild(d),d.click(),d.remove()},o=f(M.setlist(Number(T.params.id))||{type:"setlist",id:-1,name:"",sections:[]}),u=f(o.value.sections.map(t=>t.songs.map(()=>1))),j=()=>{u.value.push([]),o.value.sections.push({id:new Date().getTime(),name:"Section "+(o.value.sections.length+1),songs:[]})},J=f(null),O=t=>"title"in t?t:A.songs.find(s=>s.id===t.id),X=t=>{J.value=null},q=t=>{const s=[],a=new Set;return t.songs.forEach(d=>{a.has(d.id)?s.push(O(d)):a.add(d.id)}),s},Y=t=>o.value.sections[t].songs.map((s,a)=>{var d;return((d=u.value[t])==null?void 0:d[a])??0}).reduce((s,a)=>s+a,0),Z=t=>{const s=t,a=Math.floor(s/60);return a===0?`${s}m`:`${a}h ${s%60}m`},ee=t=>t.songs.reduce((s,a)=>s+4,0),ue=()=>o.value.sections.reduce((t,s)=>t+ee(s),0)+(o.value.sections.length-1)*15,se=t=>Z(ee(t)),ce=F(()=>Array.from(o.value.sections.flatMap(s=>s.songs).reduce((s,a)=>(s.set(a.id,(s.get(a.id)??0)+1),s),new Map).entries()).filter(([s,a])=>a>1).map(([s,a])=>({song:A.songs.find(d=>d.id===s),count:a}))),ve=F(()=>o.value.sections.some(t=>t.songs.length));ye(()=>{o.value.id===-1&&v.push("/")});const te=t=>{t.ctrlKey&&t.key==="s"?(t.preventDefault(),g()):t.ctrlKey&&t.shiftKey&&t.key==="S"?(t.preventDefault(),P()):t.ctrlKey&&t.key==="p"&&(t.preventDefault(),t.stopImmediatePropagation(),K())},S=f("preview");return ie(()=>{document.addEventListener("click",X),window.addEventListener("keydown",te)}),de(()=>{document.removeEventListener("click",X),window.removeEventListener("keydown",te)}),(t,s)=>{var d,x;const a=Se("router-link");return l(),i("div",{class:"browser",onDragover:s[12]||(s[12]=D(()=>{},["stop"]))},[e("div",{class:"editor",onDragstart:s[3]||(s[3]=D(()=>{},["stop"])),onDragover:s[4]||(s[4]=D(()=>{},["stop"]))},[e("h1",Te,[R(a,{class:"link-on-hover",to:"/setlists"},{default:L(()=>[y(" Setlists ")]),_:1}),y(" / "),R(ne,{modelValue:o.value.name,"onUpdate:modelValue":s[0]||(s[0]=n=>o.value.name=n),placeholder:"Setlist name"},{default:L(()=>[y(r(o.value.name),1)]),_:1},8,["modelValue"])]),e("div",Ue,[(l(!0),i(b,null,I(o.value.sections,(n,_)=>(l(),i("div",Fe,[e("h2",null,[R(ne,{class:"section-name",modelValue:n.name,"onUpdate:modelValue":h=>n.name=h,placeholder:"Section name"},{default:L(()=>[y(r(n.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),e("div",Ie,[q(n).length?(l(),i("div",{key:0,class:"duplicates",title:`Duplicates: ${q(n).map(h=>h.title).join(", ")}`},[Oe,y(" "+r(q(n).length)+" Duplicates ",1)],8,Ke)):k("",!0),e("div",null,[Re,y(" "+r(n.songs.length)+" Songs ",1)]),e("div",Be,[je,y(" "+r(Y(_))+" Pages ",1)]),e("div",Je,[qe,y(" about "+r(se(n)),1)]),e("div",{title:"Delete Section",class:"delete-section",onClick:h=>o.value.sections.splice(_,1)},[He,y(" Delete Section ")],8,ze)]),R(C(W),{modelValue:n.songs,"onUpdate:modelValue":h=>n.songs=h,class:"songs","item-key":"id",onDragover:s[1]||(s[1]=D(()=>{},["stop"])),disabled:C(G)(),group:"songs"},{item:L(({element:h})=>[(l(),E(Q,{key:h.id,song:O(h),"allow-delete":"",onDelete:z=>n.songs.splice(n.songs.indexOf(h),1)},null,8,["song","onDelete"]))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),e("div",{class:"info add-song",onClick:D(h=>J.value=_,["stop"])},[J.value===_?(l(),E(Ne,{key:0,onClick:s[2]||(s[2]=D(()=>{},["stop"])),onSelect:h=>n.songs.push(h)},null,8,["onSelect"])):(l(),i(b,{key:1},[Ge,y(" Add Song ")],64))],8,We)]))),256)),e("div",{class:"info add-song",onClick:j},[Qe,y(" Add Section ")])])],32),ve.value?(l(),i("div",Xe,[e("div",Ye,[e("span",{class:"material-symbols-rounded",onClick:K,title:"Print (Ctrl+P)"}," print "),e("span",{class:"material-symbols-rounded",onClick:P,title:"Download as PDF (CTRL+SHIFT+S)"}," picture_as_pdf "),e("span",{class:"material-symbols-rounded",onClick:g,title:"Download as JSON (CTRL+S)"}," file_download "),Ze,e("span",{class:B(["material-symbols-rounded",{active:S.value==="preview"}]),onClick:s[5]||(s[5]=n=>S.value="preview"),title:"Insights"}," preview ",2),e("span",{class:B(["material-symbols-rounded",{active:S.value==="add"}]),onClick:s[6]||(s[6]=n=>S.value="add"),title:"Add songs"}," playlist_add ",2),e("span",{class:B(["material-symbols-rounded",{active:S.value==="insights"}]),onClick:s[7]||(s[7]=n=>S.value="insights"),title:"Insights"}," insights ",2)]),e("div",es,[S.value=="preview"?(l(!0),i(b,{key:0},I(o.value.sections,(n,_)=>(l(),i(b,null,[_>0?(l(),i("hr",ss)):k("",!0),e("h2",null,r(n.name),1),(l(!0),i(b,null,I(n.songs,(h,z)=>(l(),E(oe,{ref_for:!0,ref_key:"allPages",ref:p,printing:"",song:O(h),onOnPageCount:H=>u.value[_][z]=H,"page-offset":u.value[_].slice(0,z).reduce((H,pe)=>H+pe,0),"section-name":n.name,"disable-hotkeys":""},null,8,["song","onOnPageCount","page-offset","section-name"]))),256))],64))),256)):S.value=="add"?(l(),i(b,{key:1},[$.value.length?(l(),i("h2",ts,"Add new songs")):k("",!0),$.value.length?(l(),E(C(W),{key:1,modelValue:$.value,"onUpdate:modelValue":s[8]||(s[8]=n=>$.value=n),class:"songs","item-key":"id",onDragover:s[9]||(s[9]=D(()=>{},["stop"])),group:"songs",disabled:C(G)()},{item:L(({element:n})=>[(l(),E(Q,{key:n.id,song:n},null,8,["song"]))]),_:1},8,["modelValue","disabled"])):k("",!0),V.value.length?(l(),i("hr",ns)):k("",!0),V.value.length?(l(),i("h2",os,"Add songs again")):k("",!0),V.value.length?(l(),E(C(W),{key:4,modelValue:V.value,"onUpdate:modelValue":s[10]||(s[10]=n=>V.value=n),class:"songs","item-key":"id",onDragover:s[11]||(s[11]=D(()=>{},["stop"])),group:"songs",disabled:C(G)()},{item:L(({element:n})=>[(l(),E(Q,{key:n.id,song:n},null,8,["song"]))]),_:1},8,["modelValue","disabled"])):k("",!0)],64)):S.value=="insights"?(l(),i(b,{key:2},[ls,e("div",as,[e("div",is,[e("h3",null,r(o.value.sections.length),1),ds]),e("div",rs,[e("h3",null,r(o.value.sections.map(n=>n.songs.length).reduce((n,_)=>n+_,0)),1),us]),e("div",cs,[e("h3",null,r(o.value.sections.map((n,_)=>Y(_)).reduce((n,_)=>n+_,0)),1),vs]),e("div",ps,[e("h3",null,r(se({songs:o.value.sections.flatMap(n=>n.songs)})),1),ms]),e("div",gs,[e("h3",null,r(Z(ue())),1),hs]),(l(!0),i(b,null,I(ce.value,n=>(l(),i("div",_s,[e("h3",null,r(n.song.title),1),e("span",fs," Duplicated "+r(n.count)+" times ",1)]))),256))])],64)):k("",!0)])])):k("",!0),e("dialog",{ref_key:"renderDialog",ref:m},[e("div",ys,[e("div",ks,[e("div",ws,[w.value>=0?(l(),E(oe,{key:0,printing:"",song:C(A).songs[w.value]},null,8,["song"])):k("",!0)])]),Ss,bs,e("div",Ds,[e("progress",{value:w.value,max:(d=p.value)==null?void 0:d.length},null,8,Cs),e("p",null,[e("span",null,r(w.value),1),y(" / "+r((x=p.value)==null?void 0:x.length),1)])])])],512)],32)}}}),Ls=re($s,[["__scopeId","data-v-176976d0"]]);export{Ls as default};
