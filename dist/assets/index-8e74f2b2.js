import{d as P,r as M,y as G,i as J,o as O,w as X,e as y,c as w,b as Q,z as Y,A as Z,v as b,B as W,x as N,C as ee,_ as T,u as R,D as oe,j as z,F as I,a as s,m,s as c,t as g,k as _,g as L,f as H,n as te,l as A,p as q,h as j,E as se,G as ne,q as le}from"./main-fd247abd.js";import{M as ae}from"./MinWidth-41988fe3.js";import{d as K,E as de,a as ie}from"./vuedraggable.umd-c11bd1c4.js";import"./_commonjsHelpers-042e6b4d.js";const re=["onDblclick"],ue=["placeholder"],ce=P({__name:"EditableText",props:{modelValue:{type:String,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(t,{emit:p}){const U=t,f=M(U.modelValue);G(()=>U.modelValue,$=>f.value=$);const i=M(!1),v=M(null),E=()=>{U.locked||(i.value=!0,ee(()=>{v.value&&v.value.focus()}))},S=J(()=>U.locked?!0:i.value?!1:f.value||f.value=="0"),D=$=>{f.value=$,p("change",$),p("update:modelValue",$)},x=()=>{v.value&&(v.value.style.height="auto",v.value.style.height=v.value.scrollHeight+"px")};return O(()=>x()),X(()=>{i.value&&x()}),($,r)=>(y(),w("div",{class:N(["editable-text",{outlined:!t.noOutline&&i.value}]),onDblclick:b(E,["stop"])},[S.value?Q($.$slots,"default",{key:0},void 0,!0):Y((y(),w("input",{key:1,ref_key:"area",ref:v,type:"text",class:"textarea","onUpdate:modelValue":r[0]||(r[0]=V=>f.value=V),onChange:r[1]||(r[1]=V=>D(V.target.value)),onInput:r[2]||(r[2]=V=>x()),onClick:r[3]||(r[3]=b(V=>i.value=!0,["stop"])),onKeydown:[r[4]||(r[4]=W(V=>i.value=!1,["enter"])),r[5]||(r[5]=W(V=>i.value=!1,["esc"]))],onBlur:r[6]||(r[6]=V=>i.value=!1),placeholder:t.placeholder},null,40,ue)),[[Z,f.value]])],42,re))}});const h=T(ce,[["__scopeId","data-v-793c6cbc"]]),C=t=>(q("data-v-6229223b"),t=t(),j(),t),pe={class:"editor__header"},me={class:"wrap-to-line"},fe={class:"info"},ge=C(()=>s("span",{class:"material-symbols-rounded"},"music_note",-1)),ve={class:"info"},he=C(()=>s("span",{class:"material-symbols-rounded"},"piano",-1)),ye={class:"info"},_e={class:"material-symbols-rounded"},Ve={class:"info"},ke=C(()=>s("span",{class:"material-symbols-rounded"}," check ",-1)),we={class:"capitalise"},be=["onClick"],Ce=C(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),$e=C(()=>s("hr",null,null,-1)),Ue={class:"instruments"},Se={class:"instrument"},xe=["onClick"],Ee={class:"flex space-between"},Me={class:"flex gap-2"},De=C(()=>s("span",{class:"material-symbols-rounded"}," volume_up ",-1)),Ie={class:"settings"},Be={class:"muted"},ze=C(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Ne=C(()=>s("hr",null,null,-1)),Pe=["id"],Te={class:"name"},We={class:"buttons"},Le=["onClick"],Ae=["onClick"],Ke={key:0,class:"progression"},Oe=["onClick"],Re=C(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),He=["id","onMousedown","onMouseup"],qe=["onClick"],je=C(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Fe=0,Ge=P({__name:"Editor",props:{song:{type:Object,required:!0}},setup(t){const p=t,U=R(),f=M(!1),i=M(!1),v=(n,o)=>{const e=p.song.sections[n].progression[o],d={chord:e.chord,duration:e.duration};p.song.sections[n].progression.splice(o+1,0,d)},E=n=>{if(n.key==="Delete")for(const o of p.song.sections)o.progression=o.progression.filter(a=>!a.selected);if(n.ctrlKey&&(n.key==="d"||n.key==="b")){n.preventDefault();for(const o of p.song.sections)for(const a of o.progression)if(a.selected){const e={chord:a.chord,duration:a.duration};o.progression.splice(o.progression.indexOf(a)+1,0,e)}}n.ctrlKey&&n.key==="p"&&(n.preventDefault(),F())},S=(n,o)=>{if(o.button===2)return;const a=o.target;if(o.offsetX>a.clientWidth-10){o.preventDefault(),o.stopImmediatePropagation(),f.value=!0;const e=a.getBoundingClientRect().width/n.duration;let d=0;const l=u=>{const B=u.clientX-a.getBoundingClientRect().left;d=Math.round(B/e),n.duration=Math.max(1,Math.min(16,d))},k=u=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",k),f.value=!1,u.stopImmediatePropagation()};window.addEventListener("mousemove",l),window.addEventListener("mouseup",k)}},D=(n,o)=>{let a=n.selected;if(!o.shiftKey){console.log("shift");for(const e of p.song.sections)for(const d of e.progression)d.selected=!1}n.selected=!a},x=n=>{p.song.sections[n],p.song.sections.splice(n,1)},$=n=>{const o=p.song.sections[n],a={type:o.type,progression:o.progression.map(e=>({chord:e.chord,duration:e.duration})),page:0};p.song.sections.splice(n+1,0,a)},r=async n=>{const o=document.querySelectorAll(".editor");let a=o[0];const e=a.clientHeight/a.clientWidth;for(let k=0;k<1;k++){if(a=o[k],!a)continue;var d=n.internal.pageSize.getWidth(),l=n.internal.pageSize.getHeight();const u=2,B=await ie.toJpeg(a,{height:a.offsetHeight*u,width:a.offsetWidth*u,style:{transform:`scale(${u}) translate(${a.offsetWidth/2/u}px, ${a.offsetHeight/2/u}px)`}});l=e*d,n.addImage(B,"JPG",0,0,d,l),k+1<1&&n.addPage()}return n},V=async()=>{i.value=!0;const n=new de({orientation:"portrait",unit:"px",format:"a4"});return await r(n),i.value=!1,n},F=async()=>{await U.prepareRender();const n=await V();n&&(n.autoPrint(),window.open(n.output("bloburl"),"_blank"))};return O(()=>{window.addEventListener("keydown",E)}),oe(()=>{window.removeEventListener("keydown",E)}),(n,o)=>(y(!0),w(I,null,z(Fe+1,a=>(y(),w("div",{class:N(["editor",{resizing:f.value,print:i.value}]),onDragover:o[14]||(o[14]=b(()=>{},["prevent"]))},[a==1?(y(),w(I,{key:0},[s("div",pe,[m(h,{modelValue:t.song.artist,"onUpdate:modelValue":o[0]||(o[0]=e=>t.song.artist=e),class:"left",placeholder:"Click to edit artist name","no-outline":""},{default:c(()=>[s("h3",null,g(t.song.artist),1)]),_:1},8,["modelValue"]),m(h,{modelValue:t.song.title,"onUpdate:modelValue":o[1]||(o[1]=e=>t.song.title=e),class:"left h1",placeholder:"Click to edit song title","no-outline":""},{default:c(()=>[s("h1",null,g(t.song.title),1)]),_:1},8,["modelValue"])]),s("div",me,[s("div",fe,[ge,m(h,{modelValue:t.song.bpm,"onUpdate:modelValue":o[2]||(o[2]=e=>t.song.bpm=e),class:"left short",placeholder:"120"},{default:c(()=>[_(g(t.song.bpm),1)]),_:1},8,["modelValue"]),_(" BPM ")]),s("div",ve,[he,m(h,{modelValue:t.song.key,"onUpdate:modelValue":o[3]||(o[3]=e=>t.song.key=e),class:"left short",placeholder:"C"},{default:c(()=>[_(g(t.song.key),1)]),_:1},8,["modelValue"])]),s("div",ye,[s("span",_e,g(t.song.transpose>0?"arrow_upward":t.song.transpose<0?"arrow_downward":"drag_handle"),1),m(h,{modelValue:t.song.transpose,"onUpdate:modelValue":o[4]||(o[4]=e=>t.song.transpose=e),class:"left short",placeholder:"0"},{default:c(()=>[_(g(t.song.transpose),1)]),_:1},8,["modelValue"])]),t.song.options?(y(!0),w(I,{key:0},z(t.song.options,(e,d)=>(y(),w("div",Ve,[ke,m(h,{modelValue:t.song.options[d],"onUpdate:modelValue":l=>t.song.options[d]=l,class:"left",placeholder:"Option"},{default:c(()=>[s("span",we,g(e),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{onClick:l=>t.song.options.splice(d,1),class:"delete material-symbols-rounded"}," delete ",8,be)]))),256)):L("",!0),s("div",{class:"info add-option",onClick:o[5]||(o[5]=e=>t.song.options?t.song.options.push("Sustain"):t.song.options=["Sustain"])},[Ce,_(" Add Option ")])]),$e,s("div",Ue,[(y(!0),w(I,null,z(t.song.instruments,(e,d)=>(y(),w("div",Se,[s("span",{onClick:l=>t.song.instruments.splice(d,1),class:"delete material-symbols-rounded"}," delete ",8,xe),s("div",Ee,[m(h,{modelValue:e.for,"onUpdate:modelValue":l=>e.for=l,class:"left short",placeholder:"Click to edit instrument","no-outline":""},{default:c(()=>[s("span",null,g(e.for),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",Me,[De,m(h,{modelValue:e.volume,"onUpdate:modelValue":l=>e.volume=l,class:"left short",placeholder:"100"},{default:c(()=>[_(g(e==null?void 0:e.volume),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),s("div",Ie,[m(h,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,class:"left h3",placeholder:"Click to edit instrument name","no-outline":""},{default:c(()=>[s("h3",null,g(e.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",Be,[m(h,{modelValue:e.type,"onUpdate:modelValue":l=>e.type=l,class:"left",placeholder:"Click to edit instrument type","no-outline":""},{default:c(()=>[_(g(e==null?void 0:e.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]))),256)),s("div",{class:"instrument add-option",onClick:o[6]||(o[6]=e=>t.song.instruments.push({name:"New Instrument",for:"New Instrument",type:"New Instrument",volume:100}))},[ze,_(" Add Instrument ")])]),Ne],64)):L("",!0),m(A(K),{modelValue:t.song.sections,"onUpdate:modelValue":o[11]||(o[11]=e=>t.song.sections=e),class:"editor__content",onDragover:o[12]||(o[12]=b(()=>{},["stop"]))},{item:c(({element:e,index:d})=>[s("div",{class:"section",id:`section-${d}`},[m(h,{modelValue:e.type,"onUpdate:modelValue":l=>e.type=l,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:c(()=>[s("span",Te,g(e.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("div",We,[s("span",{class:"button material-symbols-rounded",onClick:l=>$(d)}," content_copy ",8,Le),s("span",{class:"button material-symbols-rounded",onClick:l=>x(d)}," delete ",8,Ae)]),e.progression.length===0?(y(),w("div",Ke,[s("div",{class:"chord create",style:{"--cols":4},onClick:b(l=>e.progression.push({chord:"C",duration:4}),["stop"])},[Re,_(" Add Chord ")],8,Oe)])):(y(),H(A(K),{key:1,modelValue:e.progression,"onUpdate:modelValue":l=>e.progression=l,class:"progression",onDragover:o[10]||(o[10]=b(()=>{},["stop"]))},{item:c(({element:l,index:k})=>[s("div",{class:N(["chord",l.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${d}-${k}`,onMousedown:u=>S(l,u),onMouseup:u=>D(l,u),onClick:o[9]||(o[9]=b(()=>{},["stop"])),style:te({"--cols":l.duration})},[m(h,{modelValue:l.chord,"onUpdate:modelValue":u=>l.chord=u,"no-outline":"",placeholder:"C"},{default:c(()=>[_(g(l.chord),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{class:"insert_chord_here",onMousedown:o[7]||(o[7]=b(()=>{},["stop"])),onMouseup:o[8]||(o[8]=b(()=>{},["stop"])),onClick:b(u=>v(d,k),["stop"])},null,40,qe)],46,He)]),_:2},1032,["modelValue","onUpdate:modelValue"]))],8,Pe)]),_:1},8,["modelValue"]),s("div",{class:"add-section",id:"add-section",onClick:o[13]||(o[13]=e=>t.song.sections.push({type:"New Section",progression:[]}))},[je,_(" Add Section ")])],34))),256))}});const Je=T(Ge,[["__scopeId","data-v-6229223b"]]),Xe=t=>(q("data-v-e1e8a1b1"),t=t(),j(),t),Qe=Xe(()=>s("span",{class:"material-symbols-rounded"},"arrow_back",-1)),Ye={class:"editor_container"},Ze=P({__name:"index",setup(t){const p=R(),U=se(),f=ne();let i=U.params.id;if(!i){const S=p.addEmptySong();f.push({path:`/editor/${S}`,replace:!0}),i=String(S)}const v=p.song(i);v||f.push("/");const E=M(v);return(S,D)=>{const x=le("router-link");return y(),H(ae,{minWidth:300},{default:c(()=>[m(x,{to:"/",class:"back-button"},{default:c(()=>[Qe]),_:1}),s("div",Ye,[m(Je,{song:E.value},null,8,["song"])])]),_:1})}}});const no=T(Ze,[["__scopeId","data-v-e1e8a1b1"]]);export{no as default};
