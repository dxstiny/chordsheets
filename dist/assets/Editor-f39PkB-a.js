import{d as X,r as B,v as T,s as le,x as ee,w as ne,c as m,G as te,B as ae,L as de,l as U,M as Y,p as F,o as r,A as q,_ as oe,e as J,k as v,u as ie,y as re,F as x,i as L,a,b as y,t as g,h as V,g as C,f as A,N as Z}from"./main-DSnlyUdv.js";import{d as _}from"./vuedraggable.umd-DbPxORnL.js";/* empty css                                                               */import{d as ue,E as ce}from"./dom-to-image-cKgm5kKk.js";const me=["placeholder"],pe=X({__name:"EditableText",props:{modelValue:{type:String,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(o,{emit:D}){const $=o,d=B($.modelValue);T(()=>$.modelValue,E=>d.value=E);const k=B(!1),M=D,s=B(null),h=()=>{$.locked||(k.value=!0,q(()=>{s.value&&s.value.focus()}))},O=le(()=>$.locked?!0:k.value?!1:d.value||d.value=="0"),W=E=>{d.value=E,M("change",E),M("update:modelValue",E)},H=()=>{s.value&&(s.value.style.height="auto",s.value.style.height=s.value.scrollHeight+"px")};return ee(()=>H()),ne(()=>{k.value&&H()}),(E,f)=>(r(),m("div",{class:F(["editable-text",{outlined:!o.noOutline&&k.value,editing:k.value}]),onDblclick:U(h,["stop"])},[O.value?te(E.$slots,"default",{key:0},void 0,!0):ae((r(),m("input",{key:1,ref_key:"area",ref:s,type:"text",class:"textarea","onUpdate:modelValue":f[0]||(f[0]=b=>d.value=b),onChange:f[1]||(f[1]=b=>W(b.target.value)),onInput:f[2]||(f[2]=b=>H()),onClick:f[3]||(f[3]=U(b=>k.value=!0,["stop"])),onKeydown:[f[4]||(f[4]=Y(b=>k.value=!1,["enter"])),f[5]||(f[5]=Y(b=>k.value=!1,["esc"]))],onBlur:f[6]||(f[6]=b=>k.value=!1),placeholder:o.placeholder},null,40,me)),[[de,d.value]])],34))}}),w=oe(pe,[["__scopeId","data-v-f3071512"]]),G=X({__name:"EditableNumber",props:{modelValue:{type:Number,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(o,{emit:D}){const $=o,d=B(String($.modelValue));T(()=>$.modelValue,s=>d.value=String(s));const k=D,M=s=>{const h=Number(s);d.value=s,k("change",h),k("update:modelValue",h)};return(s,h)=>(r(),J(w,{modelValue:d.value,"onUpdate:modelValue":h[0]||(h[0]=O=>d.value=O),onChange:M,"no-outline":o.noOutline,locked:o.locked,placeholder:o.placeholder},{default:v(()=>[te(s.$slots,"default")]),_:3},8,["modelValue","no-outline","locked","placeholder"]))}}),R=()=>window.innerWidth<=800,ge={class:"editor__header"},fe={class:"wrap-to-line"},ve={class:"info"},ke={class:"info"},ye={class:"info"},he={class:"material-symbols-rounded"},Ve={class:"info"},be={class:"capitalise"},Ce=["onClick"],we={key:0},Ue={class:"instruments"},$e={class:"instrument"},Ee=["onClick"],Me={class:"flex space-between"},Se={class:"flex gap-2"},Pe={class:"settings"},Be={class:"muted"},Ne=["id"],xe={class:"name"},De={key:0,class:"buttons"},Oe=["onClick"],He=["onClick"],Ke={key:1,class:"progression"},Le=["onClick"],Te=["id","onMousedown","onMouseup"],We=["onClick"],ze=["id"],Ae={class:"name"},qe={class:"progression"},Ie=["id"],Ge={key:4,class:"pageNumber"},Re={key:5,class:"sectionName"},Fe=X({__name:"Editor",props:{song:{type:Object,required:!0},printing:{type:Boolean,default:!1},pageOffset:{type:Number,default:0},sectionName:{type:String,required:!1},disableHotkeys:{type:Boolean,default:!1}},emits:["onPageCount"],setup(o,{expose:D,emit:$}){const d=o,k=ie(),M=B(!1),s=B(d.printing),h=B(),O=(l,e)=>{const u=d.song.sections[l].progression[e],p={chord:u.chord,duration:u.duration};d.song.sections[l].progression.splice(e+1,0,p)},W=l=>{if(!d.disableHotkeys){if(l.key==="Delete")for(const e of d.song.sections)e.progression=e.progression.filter(i=>!i.selected);if(l.ctrlKey&&(l.key==="d"||l.key==="b")){l.preventDefault();for(const e of d.song.sections){const i=e.progression.filter(u=>u.selected);e.progression.splice(e.progression.indexOf(i[i.length-1])+1,0,...i.map(u=>({chord:u.chord,duration:u.duration,selected:!0}))),i.forEach(u=>u.selected=!1)}}l.ctrlKey&&l.key==="p"&&(l.preventDefault(),se())}},H=(l,e)=>{if(e.button===2||R())return;const i=e.target;if(e.offsetX>i.clientWidth-10){e.preventDefault(),e.stopImmediatePropagation(),M.value=!0;const u=i.getBoundingClientRect().width/l.duration;let p=0;const t=n=>{const P=n.clientX-i.getBoundingClientRect().left;p=Math.round(P/u),l.duration=Math.max(1,Math.min(16,p))},c=n=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",c),M.value=!1,n.stopImmediatePropagation()};window.addEventListener("mousemove",t),window.addEventListener("mouseup",c)}},E=(l,e)=>{let i=l.selected;if(!e.shiftKey)for(const u of d.song.sections)for(const p of u.progression)p.selected=!1;l.selected=!i},f=l=>{d.song.sections.splice(l,1)},b=l=>{const e=d.song.sections[l],i={type:e.type,progression:e.progression.map(u=>({chord:u.chord,duration:u.duration})),page:0};d.song.sections.splice(l+1,0,i)},j=async l=>{const e=h.value.querySelectorAll(".editor");let i=e[0];const u=i.clientHeight/i.clientWidth;for(let c=0;c<e.length;c++){if(i=e[c],!i)continue;var p=l.internal.pageSize.getWidth(),t=l.internal.pageSize.getHeight();const n=2,P=await ue.toJpeg(i,{height:i.clientHeight*n,width:i.clientWidth*n,style:{transform:`scale(${n}) translate(${i.clientWidth/2/n}px, ${i.clientHeight/2/n}px)`}});t=u*p,l.addImage(P,"JPG",0,0,p,t),c+1<e.length&&l.addPage()}return l};let z;const Q=async()=>{s.value=!0,d.song.sections.length&&!d.printing&&await new Promise(i=>{z=i});const l=new ce({orientation:"portrait",unit:"px",format:"a4"});return await j(l),s.value=d.printing,l},se=async()=>{await k.prepareRender();const l=await Q();l&&(l.autoPrint(),window.open(l.output("bloburl"),"_blank"))};ee(()=>{window.addEventListener("keydown",W),K()}),re(()=>{window.removeEventListener("keydown",W)});const S=B([]),K=()=>{if(d.song.sections.length==0){S.value=[{start:0,end:0}],I("onPageCount",1);return}if(!s.value||S.value.length==0){S.value=[{start:0,end:d.song.sections.length}],s.value&&d.song.sections.length>0&&q(K),I("onPageCount",1);return}const l=h.value.querySelectorAll(".section");if(l.length==0)return;const e=l[0].parentElement,i=getComputedStyle(e),u=e.clientHeight-parseFloat(i.paddingBottom);for(let p=0;p<l.length;p++){const t=l[p];if(t.offsetTop+t.offsetHeight>u){S.value[S.value.length-1].end=p,S.value.push({start:p,end:d.song.sections.length}),q(K);return}}I("onPageCount",S.value.length),z==null||z()};T(()=>d.song,K,{deep:!0}),T(s,()=>q(K)),T(()=>d.printing,()=>{s.value=d.printing}),D({renderTo:j,render:Q,name:()=>d.song.title});const I=$;return(l,e)=>(r(),m("div",{ref_key:"parent",ref:h,class:"pageWrapper"},[(r(!0),m(x,null,L(S.value,(i,u)=>{var p;return r(),m("div",{class:F(["editor",{resizing:M.value,print:s.value}]),onDragover:e[14]||(e[14]=U(()=>{},["prevent"]))},[u==0?(r(),m(x,{key:0},[a("div",ge,[y(w,{locked:s.value,modelValue:o.song.artist,"onUpdate:modelValue":e[0]||(e[0]=t=>o.song.artist=t),class:"left",placeholder:"Click to edit artist name","no-outline":""},{default:v(()=>[a("h3",null,g(o.song.artist),1)]),_:1},8,["locked","modelValue"]),y(w,{locked:s.value,modelValue:o.song.title,"onUpdate:modelValue":e[1]||(e[1]=t=>o.song.title=t),class:"left h1",placeholder:"Click to edit song title","no-outline":""},{default:v(()=>[a("h1",null,g(o.song.title),1)]),_:1},8,["locked","modelValue"])]),a("div",fe,[a("div",ve,[e[15]||(e[15]=a("span",{class:"material-symbols-rounded"},"music_note",-1)),y(G,{locked:s.value,modelValue:o.song.bpm,"onUpdate:modelValue":e[2]||(e[2]=t=>o.song.bpm=t),class:"left short",placeholder:"120"},{default:v(()=>[V(g(o.song.bpm),1)]),_:1},8,["locked","modelValue"]),e[16]||(e[16]=V(" BPM "))]),a("div",ke,[e[17]||(e[17]=a("span",{class:"material-symbols-rounded"},"piano",-1)),y(w,{locked:s.value,modelValue:o.song.key,"onUpdate:modelValue":e[3]||(e[3]=t=>o.song.key=t),class:"left short",placeholder:"C"},{default:v(()=>[V(g(o.song.key),1)]),_:1},8,["locked","modelValue"])]),a("div",ye,[a("span",he,g(o.song.transpose>0?"arrow_upward":o.song.transpose<0?"arrow_downward":"drag_handle"),1),y(G,{locked:s.value,modelValue:o.song.transpose,"onUpdate:modelValue":e[4]||(e[4]=t=>o.song.transpose=t),class:"left short",placeholder:"0"},{default:v(()=>[V(g(o.song.transpose),1)]),_:1},8,["locked","modelValue"])]),o.song.options?(r(!0),m(x,{key:0},L(o.song.options,(t,c)=>(r(),m("div",Ve,[e[18]||(e[18]=a("span",{class:"material-symbols-rounded"}," check ",-1)),y(w,{locked:s.value,modelValue:o.song.options[c],"onUpdate:modelValue":n=>o.song.options[c]=n,class:"left",placeholder:"Option"},{default:v(()=>[a("span",be,g(t),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?C("",!0):(r(),m("span",{key:0,onClick:n=>o.song.options.splice(c,1),class:"delete material-symbols-rounded"}," delete ",8,Ce))]))),256)):C("",!0),a("div",{class:"info add-option",onClick:e[5]||(e[5]=t=>o.song.options?o.song.options.push("Sustain"):o.song.options=["Sustain"])},e[19]||(e[19]=[a("span",{class:"material-symbols-rounded"}," add ",-1),V(" Add Option ")]))]),(p=o.song.instruments)!=null&&p.length?(r(),m("hr",we)):C("",!0),a("div",Ue,[(r(!0),m(x,null,L(o.song.instruments,(t,c)=>(r(),m("div",$e,[s.value?C("",!0):(r(),m("span",{key:0,onClick:n=>o.song.instruments.splice(c,1),class:"delete material-symbols-rounded"}," delete ",8,Ee)),a("div",Me,[y(w,{locked:s.value,modelValue:t.for,"onUpdate:modelValue":n=>t.for=n,class:"left short",placeholder:"Click to edit instrument","no-outline":""},{default:v(()=>[a("span",null,g(t.for),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),a("span",Se,[e[20]||(e[20]=a("span",{class:"material-symbols-rounded"}," volume_up ",-1)),y(G,{locked:s.value,modelValue:t.volume,"onUpdate:modelValue":n=>t.volume=n,class:"left short",placeholder:"100"},{default:v(()=>[V(g(t==null?void 0:t.volume),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"])])]),a("div",Pe,[y(w,{locked:s.value,modelValue:t.name,"onUpdate:modelValue":n=>t.name=n,class:"left h3",placeholder:"Click to edit instrument name","no-outline":""},{default:v(()=>[a("h3",null,g(t.name),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),a("span",Be,[y(w,{locked:s.value,modelValue:t.type,"onUpdate:modelValue":n=>t.type=n,class:"left",placeholder:"Click to edit instrument type","no-outline":""},{default:v(()=>[V(g(t==null?void 0:t.type),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"])])])]))),256)),a("div",{class:"instrument add-option",onClick:e[6]||(e[6]=t=>o.song.instruments.push({name:"ConcertGrand",for:"R1",type:"Piano",volume:100}))},e[21]||(e[21]=[a("span",{class:"material-symbols-rounded"}," add ",-1),V(" Add Instrument ")]))]),e[22]||(e[22]=a("hr",null,null,-1))],64)):C("",!0),s.value?(r(!0),m(x,{key:2},L(d.song.sections.slice(i.start,i.end),(t,c)=>(r(),m("div",{class:"section printable",id:`section-${c}`},[a("span",Ae,g(t.type),1),a("div",qe,[(r(!0),m(x,null,L(t.progression,(n,P)=>(r(),m("div",{class:"chord",ref_for:!0,ref:"chordElements",id:`chord-${c}-${P}`,style:Z({"--cols":n.duration})},g(n.chord),13,Ie))),256))])],8,ze))),256)):(r(),J(A(_),{key:1,modelValue:o.song.sections,"onUpdate:modelValue":e[11]||(e[11]=t=>o.song.sections=t),class:"editor__content",onDragover:e[12]||(e[12]=U(()=>{},["stop"])),itemKey:"id",disabled:A(R)()},{item:v(({element:t,index:c})=>[a("div",{class:"section",id:`section-${c}`},[y(w,{locked:s.value,modelValue:t.type,"onUpdate:modelValue":n=>t.type=n,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:v(()=>[a("span",xe,g(t.type),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?C("",!0):(r(),m("div",De,[a("span",{class:"button material-symbols-rounded",onClick:n=>b(c)}," content_copy ",8,Oe),a("span",{class:"button material-symbols-rounded",onClick:n=>f(c)}," delete ",8,He)])),t.progression.length===0?(r(),m("div",Ke,[a("div",{class:"chord create",style:{"--cols":4},onClick:U(n=>t.progression.push({chord:"C",duration:4}),["stop"])},e[23]||(e[23]=[a("span",{class:"material-symbols-rounded"}," add ",-1),V(" Add Chord ")]),8,Le)])):(r(),J(A(_),{key:2,modelValue:t.progression,"onUpdate:modelValue":n=>t.progression=n,class:"progression",onDragover:e[10]||(e[10]=U(()=>{},["stop"])),itemKey:"id",disabled:A(R)()},{item:v(({element:n,index:P})=>[a("div",{class:F(["chord",n.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${c}-${P}`,onMousedown:N=>H(n,N),onMouseup:N=>E(n,N),onClick:e[9]||(e[9]=U(()=>{},["stop"])),style:Z({"--cols":n.duration})},[y(w,{locked:s.value,modelValue:n.chord,"onUpdate:modelValue":N=>n.chord=N,"no-outline":"",placeholder:"C"},{default:v(()=>[V(g(n.chord),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?C("",!0):(r(),m("span",{key:0,class:"insert_chord_here",onMousedown:e[7]||(e[7]=U(()=>{},["stop"])),onMouseup:e[8]||(e[8]=U(()=>{},["stop"])),onClick:U(N=>O(c,P),["stop"])},null,40,We))],46,Te)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]))],8,Ne)]),_:2},1032,["modelValue","disabled"])),s.value?C("",!0):(r(),m("div",{key:3,class:"add-section",id:"add-section",onClick:e[13]||(e[13]=t=>o.song.sections.push({type:"New Section",progression:[]}))},e[24]||(e[24]=[a("span",{class:"material-symbols-rounded"}," add ",-1),V(" Add Section ")]))),s.value?(r(),m("span",Ge,g(u+o.pageOffset+1),1)):C("",!0),s.value&&o.sectionName?(r(),m("span",Re,g(o.sectionName),1)):C("",!0)],34)}),256))],512))}}),Ye=oe(Fe,[["__scopeId","data-v-2c938d6d"]]);export{Ye as E,w as a,R as i};
