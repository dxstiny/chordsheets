import{d as M,u as q,r as w,e as k,c as P,a as e,t as y,k as I,l as b,m as n,p as E,h as j,_ as R,w as U,q as F,s as T,v as O,f as N,g as J,F as A,j as W}from"./main-7ad6aae4.js";import{I as u,D as Y}from"./Dropdown-a36abab6.js";import{T as z,A as B}from"./TextInput-d997e281.js";import{d as G,E as H}from"./vuedraggable.umd-5c39a83c.js";import"./MidiPreview-a141f8b8.js";import"./_commonjsHelpers-042e6b4d.js";const K=p=>(E("data-v-c192c0a9"),p=p(),j(),p),Q=K(()=>e("br",null,null,-1)),X={class:"actions"},Z=M({__name:"Import",setup(p,{expose:l}){const i=q(),c=w([]),a=w(),x=()=>{c.value=[];const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=_=>{var f;const g=(f=_.target.files)==null?void 0:f[0];if(!g)return;const d=new FileReader;d.onload=D=>{var o;const V=(o=D.target)==null?void 0:o.result,t=JSON.parse(V);if(!i.songs.length){i.songs=t;return}c.value=t,a.value.showModal()},d.readAsText(g)},r.click()},S=()=>{for(const r of c.value){const _=i.songs.find(g=>g.title===r.title&&g.artist===r.artist);_?Object.assign(_,r):i.songs.push(r)}c.value=[],a.value.close()},$=()=>{i.songs=c.value,c.value=[],a.value.close()};return l({show:x}),(r,_)=>(k(),P("dialog",{ref_key:"addOrOverwrite",ref:a},[e("h1",null,y(c.value.length)+" songs to import",1),e("p",null,[I(" You already have "+y(b(i).songs.length)+" songs in your library. ",1),Q,I(" Do you want to merge the libraries songs or overwrite the existing one? ")]),e("div",X,[n(u,{label:"Cancel",icon:"close",style:"red",onClick:_[0]||(_[0]=g=>a.value.close())}),n(u,{label:"Merge",icon:"merge",onClick:S}),n(u,{label:"Overwrite",icon:"sync_problem",style:"yellow",onClick:$})])],512))}});const ee=R(Z,[["__scopeId","data-v-c192c0a9"]]),h=p=>(E("data-v-d7b8fd45"),p=p(),j(),p),te={class:"dashboard"},oe={class:"wrap"},se=h(()=>e("h1",null,[I("Chord"),e("span",{class:"accent"},"Sheets")],-1)),le={class:"flex"},ne=h(()=>e("hr",null,null,-1)),ae={class:"filters"},re=h(()=>e("hr",null,null,-1)),ie={class:"song"},de={class:"cover"},ce=["src"],ue={class:"info"},pe={class:"bpm"},_e={class:"key"},ve=["onClick"],he={class:"card sticky learn"},ge={class:"content"},fe=h(()=>e("h2",null,"Learn Music Theory",-1)),me=h(()=>e("hr",null,null,-1)),we=h(()=>e("h2",null,"New editor coming soon!",-1)),ye=h(()=>e("p",null," The new editor will let you edit your songs directly in-place. No more switching between editor and preview. It also introduces new shortcuts to improve your workflow. ",-1)),be={class:"content"},ke={class:"preview-container"},xe={class:"preview scale-sm"},Ce=h(()=>e("h2",null,"Rendering...",-1)),Ie=h(()=>e("p",null," Please wait while we render your chord sheets. This may take a while. ",-1)),Se={class:"row"},$e=["value","max"],De={class:"void"},Ve={class:"parent"},Le=M({__name:"Dashboard",setup(p){const l=q(),i=w(),c=w(),a=w(-1),x=w(),S=async()=>{await l.prepareRender();const t=JSON.stringify(l.songs,null,4),o=document.createElement("a"),v=new Blob([t],{type:"text/plain"});o.href=URL.createObjectURL(v),o.download="chordsheets.json",o.click()},$=()=>{var t;(t=x.value)==null||t.show()},r=async()=>{var o,v;(o=c.value)==null||o.showModal();let t=new H({orientation:"portrait",unit:"px",format:"a4"});a.value=0;for(const m of i.value??[])await m.renderTo(t),a.value++,m.song!==l.songs[l.songs.length-1]&&t.addPage();return(v=c.value)==null||v.close(),a.value=-1,t},_=async()=>{const t=await r();t.autoPrint(),t.output("dataurlnewwindow")},g=async()=>{(await r()).save("chordsheets.pdf")},d=w({artist:"",query:""}),f=w([]);U(()=>{f.value=l.songs.filter(t=>{if(d.value.artist&&d.value.artist!=="(any)"&&!t.artist.toLowerCase().includes(d.value.artist.toLowerCase()))return!1;const o=`${t.title} ${t.artist}`.toLowerCase();return!(d.value.query&&!o.includes(d.value.query.toLowerCase()))})});const D=({moved:t})=>{const o=l.songs.findIndex(s=>s.id===t.element.id),v=f.value[t.newIndex-1%f.value.length],m=v?l.songs.findIndex(s=>s.id===v.id):-1,C=t.newIndex>t.oldIndex?m:m+1;l.moveTo(o,C)},V=window.innerWidth<800;return(t,o)=>{var m,C;const v=F("router-link");return k(),P(A,null,[e("div",te,[e("div",oe,[e("main",null,[se,e("div",le,[n(u,{icon:"add",label:"New Song",onClick:o[0]||(o[0]=s=>t.$router.push("/editor")),style:"green"}),n(u,{icon:"file_download",label:"Save Library",onClick:S,style:"yellow"}),n(u,{icon:"file_upload",label:"Import",onClick:$,style:"yellow"}),n(u,{label:"Export all as PDF",icon:"picture_as_pdf",onClick:g,style:"blue"}),n(u,{label:"Print All",icon:"print",onClick:_,style:"blue"})]),ne,e("div",ae,[n(z,{label:"Search",modelValue:d.value.query,"onUpdate:modelValue":o[1]||(o[1]=s=>d.value.query=s),placeholder:"Search for a song"},null,8,["modelValue"]),n(Y,{label:"Artist",modelValue:d.value.artist,"onUpdate:modelValue":o[2]||(o[2]=s=>d.value.artist=s),options:["(any)",...new Set(b(l).songs.map(s=>s.artist).sort())]},null,8,["modelValue","options"])]),re,n(b(G),{modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=s=>f.value=s),class:"songs",onChange:D,"item-key":"id",onDragover:o[4]||(o[4]=O(()=>{},["stop"])),disabled:V},{item:T(({element:s})=>[n(v,{to:`/editor/${s.id}`},{default:T(()=>[e("div",ie,[e("div",de,[e("img",{src:s.cover||"placeholders/song.svg"},null,8,ce)]),e("div",ue,[e("h2",null,y(s.title),1),e("span",null,y(s.artist),1)]),e("span",pe,y(s.bpm)+" BPM ",1),e("span",_e,y(s.key),1),e("span",{class:"material-symbols-rounded delete",onClick:O(L=>b(l).removeSong(s),["prevent"])}," delete ",8,ve)])]),_:2},1032,["to"])]),_:1},8,["modelValue"])]),e("aside",he,[e("div",ge,[fe,n(u,{label:"Try the Beta",icon:"arrow_forward",onClick:o[5]||(o[5]=s=>t.$router.push("/learn")),style:"blue"}),me,we,ye,n(u,{label:"Try the preview",icon:"arrow_forward",onClick:o[6]||(o[6]=s=>{var L;return t.$router.push("/editor/v2/"+((L=b(l).songs[0])==null?void 0:L.id))}),style:"blue"})])])])]),e("dialog",{ref_key:"renderDialog",ref:c},[e("div",be,[e("div",ke,[e("div",xe,[a.value>=0?(k(),N(B,{key:0,ref_key:"allPages",ref:i,song:b(l).songs[a.value]},null,8,["song"])):J("",!0)])]),Ce,Ie,e("div",Se,[e("progress",{value:a.value,max:(m=i.value)==null?void 0:m.length},null,8,$e),e("p",null,[e("span",null,y(a.value),1),I(" / "+y((C=i.value)==null?void 0:C.length),1)])])])],512),n(ee,{ref_key:"importDialog",ref:x},null,512),e("div",De,[e("div",Ve,[(k(!0),P(A,null,W(b(l).songs,s=>(k(),N(B,{ref_for:!0,ref_key:"allPages",ref:i,song:s},null,8,["song"]))),256))])])],64)}}});const Me=R(Le,[["__scopeId","data-v-d7b8fd45"]]);export{Me as default};
