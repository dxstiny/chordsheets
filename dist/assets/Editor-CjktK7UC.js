import{d as te,u as ne,o as l,e as f,J as ue,H as me,r as _,s as M,K as pe,x as ve,y as ge,c as r,a as s,b as N,k as D,h as v,F as y,i as L,l as k,p as R,g,f as C,t as d,z as ce,m as fe,n as ye,_ as ke}from"./main-DZED5YHt.js";import{E as we}from"./dom-to-image-CGH7_zTS.js";import{d as F}from"./vuedraggable.umd-WXmkIpja.js";import{a as ee,E as se,i as I}from"./Editor-tBKLEV3F.js";import{S as J}from"./Song-C5Sxc_iJ.js";/* empty css                                                               */const Se=te({__name:"SongSearcher",emits:["select"],setup(oe,{emit:w}){const A=ne(),E=w,P=S=>A.songs.filter(u=>JSON.stringify({title:u.title,artist:u.artist,bpm:u.bpm,key:u.key}).toLowerCase().includes(S.toLowerCase())).map(u=>({id:u.id,title:u.title,subtitle:u.artist,img:u.cover,action:()=>{E("select",u)}}));return(S,u)=>(l(),f(ue,{search:P}))}}),he={class:"page-title"},be={class:"items"},_e={class:"container"},Ce={class:"section-checks"},De=["title"],Ve={title:"Pages"},Ae={class:"duration",title:"Estimated duration (1 song = 4 minutes)"},Ee=["onClick"],Pe=["onClick"],$e={key:0,class:"preview"},Te={class:"toolbar"},xe={class:"content"},Me={key:0},Ne={key:0},Le={key:2},Ue={key:3},Be={class:"insights"},Ke={class:"container"},Oe={class:"container"},Re={class:"container"},Fe={class:"container"},Ie={class:"container"},Je={class:"container warning"},je={class:"muted"},He={class:"content"},ze={class:"preview-container"},We={class:"preview scale-sm"},qe={class:"row"},Ge=["value","max"],Qe=te({__name:"Editor",setup(oe){const w=ne(),A=me(),E=ce(),P=fe(),S=_(),u=_(),h=_(-1),$=M(()=>w.songs.filter(t=>!a.value.sections.some(e=>e.songs.some(o=>o.id===t.id)))),V=M(()=>w.songs.filter(t=>a.value.sections.some(e=>e.songs.some(o=>o.id===t.id))));if(E.params.id==="new"){const{id:t}=A.addEmptySetlist();P.push({path:`/setlist/${t}`,replace:!0})}const j=async()=>{var o,i;(o=u.value)==null||o.showModal();let t=new we({orientation:"portrait",unit:"px",format:"a4"});h.value=0;const e=S.value??[];for(const[b,n]of e.entries())await n.renderTo(t),h.value++,b<e.length-1&&t.addPage();return(i=u.value)==null||i.close(),h.value=-1,t},H=async()=>{const t=await j();t.autoPrint(),t.output("dataurlnewwindow")},z=async()=>{(await j()).save(a.value.name+".pdf")},W=async()=>{const t=a.value.sections.map(b=>({type:"setlist",...b,songs:b.songs.map(n=>x(n))})),e={...a.value,sections:t},o="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),i=document.createElement("a");i.setAttribute("href",o),i.setAttribute("download",`${a.value.name}.chordsheets.json`),document.body.appendChild(i),i.click(),i.remove()},a=_(A.setlist(Number(E.params.id))||{type:"setlist",id:-1,name:"",sections:[]}),T=_(a.value.sections.map(t=>t.songs.map(()=>1))),le=()=>{T.value.push([]),a.value.sections.push({id:new Date().getTime(),name:"Section "+(a.value.sections.length+1),songs:[]})},U=_(null),x=t=>"title"in t?t:w.songs.find(e=>e.id===t.id),q=t=>{U.value=null},B=t=>{const e=[],o=new Set;return t.songs.forEach(i=>{o.has(i.id)?e.push(x(i)):o.add(i.id)}),e},G=t=>a.value.sections[t].songs.map((e,o)=>{var i;return((i=T.value[t])==null?void 0:i[o])??0}).reduce((e,o)=>e+o,0),Q=t=>{const e=t,o=Math.floor(e/60);return o===0?`${e}m`:`${o}h ${e%60}m`},X=t=>t.songs.reduce((e,o)=>e+4,0),ae=()=>a.value.sections.reduce((t,e)=>t+X(e),0)+(a.value.sections.length-1)*15,Y=t=>Q(X(t)),ie=M(()=>Array.from(a.value.sections.flatMap(e=>e.songs).reduce((e,o)=>(e.set(o.id,(e.get(o.id)??0)+1),e),new Map).entries()).filter(([e,o])=>o>1).map(([e,o])=>({song:w.songs.find(i=>i.id===e),count:o}))),re=M(()=>a.value.sections.some(t=>t.songs.length));pe(()=>{a.value.id===-1&&P.push("/")});const Z=t=>{t.ctrlKey&&t.key==="s"?(t.preventDefault(),W()):t.ctrlKey&&t.shiftKey&&t.key==="S"?(t.preventDefault(),z()):t.ctrlKey&&t.key==="p"&&(t.preventDefault(),t.stopImmediatePropagation(),H())},c=_("preview");return ve(()=>{document.addEventListener("click",q),window.addEventListener("keydown",Z)}),ge(()=>{document.removeEventListener("click",q),window.removeEventListener("keydown",Z)}),(t,e)=>{var i,b;const o=ye("router-link");return l(),r("div",{class:"browser",onDragover:e[12]||(e[12]=k(()=>{},["stop"]))},[s("div",{class:"editor",onDragstart:e[3]||(e[3]=k(()=>{},["stop"])),onDragover:e[4]||(e[4]=k(()=>{},["stop"]))},[s("h1",he,[N(o,{class:"link-on-hover",to:"/setlists"},{default:D(()=>e[13]||(e[13]=[v(" Setlists ")])),_:1}),e[14]||(e[14]=v(" / ")),N(ee,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.name=n),placeholder:"Setlist name"},{default:D(()=>[v(d(a.value.name),1)]),_:1},8,["modelValue"])]),s("div",be,[(l(!0),r(y,null,L(a.value.sections,(n,p)=>(l(),r("div",_e,[s("h2",null,[N(ee,{class:"section-name",modelValue:n.name,"onUpdate:modelValue":m=>n.name=m,placeholder:"Section name"},{default:D(()=>[v(d(n.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),s("div",Ce,[B(n).length?(l(),r("div",{key:0,class:"duplicates",title:`Duplicates: ${B(n).map(m=>m.title).join(", ")}`},[e[15]||(e[15]=s("span",{class:"material-symbols-rounded"}," warning ",-1)),v(" "+d(B(n).length)+" Duplicates ",1)],8,De)):g("",!0),s("div",null,[e[16]||(e[16]=s("span",{class:"material-symbols-rounded"}," music_note ",-1)),v(" "+d(n.songs.length)+" Songs ",1)]),s("div",Ve,[e[17]||(e[17]=s("span",{class:"material-symbols-rounded"}," book ",-1)),v(" "+d(G(p))+" Pages ",1)]),s("div",Ae,[e[18]||(e[18]=s("span",{class:"material-symbols-rounded"}," schedule ",-1)),v(" about "+d(Y(n)),1)]),s("div",{title:"Delete Section",class:"delete-section",onClick:m=>a.value.sections.splice(p,1)},e[19]||(e[19]=[s("span",{class:"material-symbols-rounded"}," delete ",-1),v(" Delete Section ")]),8,Ee)]),N(C(F),{modelValue:n.songs,"onUpdate:modelValue":m=>n.songs=m,class:"songs","item-key":"id",onDragover:e[1]||(e[1]=k(()=>{},["stop"])),disabled:C(I)(),group:"songs"},{item:D(({element:m})=>[(l(),f(J,{key:m.id,song:x(m),"allow-delete":"",onDelete:K=>n.songs.splice(n.songs.indexOf(m),1)},null,8,["song","onDelete"]))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),s("div",{class:"info add-song",onClick:k(m=>U.value=p,["stop"])},[U.value===p?(l(),f(Se,{key:0,onClick:e[2]||(e[2]=k(()=>{},["stop"])),onSelect:m=>n.songs.push(m)},null,8,["onSelect"])):(l(),r(y,{key:1},[e[20]||(e[20]=s("span",{class:"material-symbols-rounded"}," add ",-1)),e[21]||(e[21]=v(" Add Song "))],64))],8,Pe)]))),256)),s("div",{class:"info add-song",onClick:le},e[22]||(e[22]=[s("span",{class:"material-symbols-rounded"}," add ",-1),v(" Add Section ")]))])],32),re.value?(l(),r("div",$e,[s("div",Te,[s("span",{class:"material-symbols-rounded",onClick:H,title:"Print (Ctrl+P)"}," print "),s("span",{class:"material-symbols-rounded",onClick:z,title:"Download as PDF (CTRL+SHIFT+S)"}," picture_as_pdf "),s("span",{class:"material-symbols-rounded",onClick:W,title:"Download as JSON (CTRL+S)"}," file_download "),e[23]||(e[23]=s("div",{class:"divider"},null,-1)),s("span",{class:R(["material-symbols-rounded",{active:c.value==="preview"}]),onClick:e[5]||(e[5]=n=>c.value="preview"),title:"Insights"}," preview ",2),s("span",{class:R(["material-symbols-rounded",{active:c.value==="add"}]),onClick:e[6]||(e[6]=n=>c.value="add"),title:"Add songs"}," playlist_add ",2),s("span",{class:R(["material-symbols-rounded",{active:c.value==="insights"}]),onClick:e[7]||(e[7]=n=>c.value="insights"),title:"Insights"}," insights ",2)]),s("div",xe,[c.value=="preview"?(l(!0),r(y,{key:0},L(a.value.sections,(n,p)=>(l(),r(y,null,[p>0?(l(),r("hr",Me)):g("",!0),s("h2",null,d(n.name),1),(l(!0),r(y,null,L(n.songs,(m,K)=>(l(),f(se,{ref_for:!0,ref_key:"allPages",ref:S,printing:"",song:x(m),onOnPageCount:O=>T.value[p][K]=O,"page-offset":T.value[p].slice(0,K).reduce((O,de)=>O+de,0),"section-name":n.name,"disable-hotkeys":""},null,8,["song","onOnPageCount","page-offset","section-name"]))),256))],64))),256)):c.value=="add"?(l(),r(y,{key:1},[$.value.length?(l(),r("h2",Ne,"Add new songs")):g("",!0),$.value.length?(l(),f(C(F),{key:1,modelValue:$.value,"onUpdate:modelValue":e[8]||(e[8]=n=>$.value=n),class:"songs","item-key":"id",onDragover:e[9]||(e[9]=k(()=>{},["stop"])),group:"songs",disabled:C(I)()},{item:D(({element:n})=>[(l(),f(J,{key:n.id,song:n},null,8,["song"]))]),_:1},8,["modelValue","disabled"])):g("",!0),V.value.length?(l(),r("hr",Le)):g("",!0),V.value.length?(l(),r("h2",Ue,"Add songs again")):g("",!0),V.value.length?(l(),f(C(F),{key:4,modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=n=>V.value=n),class:"songs","item-key":"id",onDragover:e[11]||(e[11]=k(()=>{},["stop"])),group:"songs",disabled:C(I)()},{item:D(({element:n})=>[(l(),f(J,{key:n.id,song:n},null,8,["song"]))]),_:1},8,["modelValue","disabled"])):g("",!0)],64)):c.value=="insights"?(l(),r(y,{key:2},[e[29]||(e[29]=s("h2",null,"Insights",-1)),s("div",Be,[s("div",Ke,[s("h3",null,d(a.value.sections.length),1),e[24]||(e[24]=s("span",{class:"muted"},"Sections",-1))]),s("div",Oe,[s("h3",null,d(a.value.sections.map(n=>n.songs.length).reduce((n,p)=>n+p,0)),1),e[25]||(e[25]=s("span",{class:"muted"},"Songs",-1))]),s("div",Re,[s("h3",null,d(a.value.sections.map((n,p)=>G(p)).reduce((n,p)=>n+p,0)),1),e[26]||(e[26]=s("span",{class:"muted"},"Pages",-1))]),s("div",Fe,[s("h3",null,d(Y({songs:a.value.sections.flatMap(n=>n.songs)})),1),e[27]||(e[27]=s("span",{class:"muted"},"of playing time",-1))]),s("div",Ie,[s("h3",null,d(Q(ae())),1),e[28]||(e[28]=s("span",{class:"muted"},"including breaks",-1))]),(l(!0),r(y,null,L(ie.value,n=>(l(),r("div",Je,[s("h3",null,d(n.song.title),1),s("span",je," Duplicated "+d(n.count)+" times ",1)]))),256))])],64)):g("",!0)])])):g("",!0),s("dialog",{ref_key:"renderDialog",ref:u},[s("div",He,[s("div",ze,[s("div",We,[h.value>=0?(l(),f(se,{key:0,printing:"",song:C(w).songs[h.value]},null,8,["song"])):g("",!0)])]),e[30]||(e[30]=s("h2",null,"Rendering...",-1)),e[31]||(e[31]=s("p",null," Please wait while we render your chord sheets. This may take a while. ",-1)),s("div",qe,[s("progress",{value:h.value,max:(i=S.value)==null?void 0:i.length},null,8,Ge),s("p",null,[s("span",null,d(h.value),1),v(" / "+d((b=S.value)==null?void 0:b.length),1)])])])],512)],32)}}}),ns=ke(Qe,[["__scopeId","data-v-993b5d56"]]);export{ns as default};
