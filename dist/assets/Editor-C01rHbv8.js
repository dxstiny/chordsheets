import{d as oe,u as ae,o as a,e as h,L as ce,K as me,r as C,x as N,M as pe,z as ve,A as ge,c as d,a as s,b as U,l as V,h as v,F as f,i as I,m as y,s as F,g,f as D,t as r,B as _e,n as he,q as fe,p as ye,j as ke,_ as Se}from"./main-Ff3BIIMF.js";import{E as we}from"./dom-to-image-aRLAw4Vz.js";import{d as j}from"./vuedraggable.umd-C9rQ_nbd.js";import{a as te,E as ne,i as J}from"./Editor-CbYEmPdg.js";import{S as z}from"./Song-BzEItQPT.js";/* empty css                                                               */const be=oe({__name:"SongSearcher",emits:["select"],setup(A,{emit:k}){const P=ae(),$=k,M=S=>P.songs.filter(c=>JSON.stringify({title:c.title,artist:c.artist,bpm:c.bpm,key:c.key}).toLowerCase().includes(S.toLowerCase())).map(c=>({id:c.id,title:c.title,subtitle:c.artist,img:c.cover,action:()=>{$("select",c)}}));return(S,c)=>(a(),h(ce,{search:M}))}}),u=A=>(ye("data-v-993b5d56"),A=A(),ke(),A),Ce={class:"page-title"},De={class:"items"},Ve={class:"container"},Ae={class:"section-checks"},Ee=["title"],Pe=u(()=>s("span",{class:"material-symbols-rounded"}," warning ",-1)),$e=u(()=>s("span",{class:"material-symbols-rounded"}," music_note ",-1)),Me={title:"Pages"},Te=u(()=>s("span",{class:"material-symbols-rounded"}," book ",-1)),xe={class:"duration",title:"Estimated duration (1 song = 4 minutes)"},Le=u(()=>s("span",{class:"material-symbols-rounded"}," schedule ",-1)),Ne=["onClick"],Ue=u(()=>s("span",{class:"material-symbols-rounded"}," delete ",-1)),Ie=["onClick"],Be=u(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Ke=u(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Oe={key:0,class:"preview"},Re={class:"toolbar"},Fe=u(()=>s("div",{class:"divider"},null,-1)),je={class:"content"},Je={key:0},ze={key:0},He={key:2},qe={key:3},We=u(()=>s("h2",null,"Insights",-1)),Ge={class:"insights"},Qe={class:"container"},Xe=u(()=>s("span",{class:"muted"},"Sections",-1)),Ye={class:"container"},Ze=u(()=>s("span",{class:"muted"},"Songs",-1)),es={class:"container"},ss=u(()=>s("span",{class:"muted"},"Pages",-1)),ts={class:"container"},ns=u(()=>s("span",{class:"muted"},"of playing time",-1)),os={class:"container"},as=u(()=>s("span",{class:"muted"},"including breaks",-1)),ls={class:"container warning"},is={class:"muted"},ds={class:"content"},rs={class:"preview-container"},us={class:"preview scale-sm"},cs=u(()=>s("h2",null,"Rendering...",-1)),ms=u(()=>s("p",null," Please wait while we render your chord sheets. This may take a while. ",-1)),ps={class:"row"},vs=["value","max"],gs=oe({__name:"Editor",setup(A){const k=ae(),P=me(),$=_e(),M=he(),S=C(),c=C(),w=C(-1),T=N(()=>k.songs.filter(t=>!l.value.sections.some(e=>e.songs.some(o=>o.id===t.id)))),E=N(()=>k.songs.filter(t=>l.value.sections.some(e=>e.songs.some(o=>o.id===t.id))));if($.params.id==="new"){const{id:t}=P.addEmptySetlist();M.push({path:`/setlist/${t}`,replace:!0})}const H=async()=>{var o,i;(o=c.value)==null||o.showModal();let t=new we({orientation:"portrait",unit:"px",format:"a4"});w.value=0;const e=S.value??[];for(const[b,n]of e.entries())await n.renderTo(t),w.value++,b<e.length-1&&t.addPage();return(i=c.value)==null||i.close(),w.value=-1,t},q=async()=>{const t=await H();t.autoPrint(),t.output("dataurlnewwindow")},W=async()=>{(await H()).save(l.value.name+".pdf")},G=async()=>{const t=l.value.sections.map(b=>({type:"setlist",...b,songs:b.songs.map(n=>L(n))})),e={...l.value,sections:t},o="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),i=document.createElement("a");i.setAttribute("href",o),i.setAttribute("download",`${l.value.name}.chordsheets.json`),document.body.appendChild(i),i.click(),i.remove()},l=C(P.setlist(Number($.params.id))||{type:"setlist",id:-1,name:"",sections:[]}),x=C(l.value.sections.map(t=>t.songs.map(()=>1))),le=()=>{x.value.push([]),l.value.sections.push({id:new Date().getTime(),name:"Section "+(l.value.sections.length+1),songs:[]})},B=C(null),L=t=>"title"in t?t:k.songs.find(e=>e.id===t.id),Q=t=>{B.value=null},K=t=>{const e=[],o=new Set;return t.songs.forEach(i=>{o.has(i.id)?e.push(L(i)):o.add(i.id)}),e},X=t=>l.value.sections[t].songs.map((e,o)=>{var i;return((i=x.value[t])==null?void 0:i[o])??0}).reduce((e,o)=>e+o,0),Y=t=>{const e=t,o=Math.floor(e/60);return o===0?`${e}m`:`${o}h ${e%60}m`},Z=t=>t.songs.reduce((e,o)=>e+4,0),ie=()=>l.value.sections.reduce((t,e)=>t+Z(e),0)+(l.value.sections.length-1)*15,ee=t=>Y(Z(t)),de=N(()=>Array.from(l.value.sections.flatMap(e=>e.songs).reduce((e,o)=>(e.set(o.id,(e.get(o.id)??0)+1),e),new Map).entries()).filter(([e,o])=>o>1).map(([e,o])=>({song:k.songs.find(i=>i.id===e),count:o}))),re=N(()=>l.value.sections.some(t=>t.songs.length));pe(()=>{l.value.id===-1&&M.push("/")});const se=t=>{t.ctrlKey&&t.key==="s"?(t.preventDefault(),G()):t.ctrlKey&&t.shiftKey&&t.key==="S"?(t.preventDefault(),W()):t.ctrlKey&&t.key==="p"&&(t.preventDefault(),t.stopImmediatePropagation(),q())},_=C("preview");return ve(()=>{document.addEventListener("click",Q),window.addEventListener("keydown",se)}),ge(()=>{document.removeEventListener("click",Q),window.removeEventListener("keydown",se)}),(t,e)=>{var i,b;const o=fe("router-link");return a(),d("div",{class:"browser",onDragover:e[12]||(e[12]=y(()=>{},["stop"]))},[s("div",{class:"editor",onDragstart:e[3]||(e[3]=y(()=>{},["stop"])),onDragover:e[4]||(e[4]=y(()=>{},["stop"]))},[s("h1",Ce,[U(o,{class:"link-on-hover",to:"/setlists"},{default:V(()=>[v(" Setlists ")]),_:1}),v(" / "),U(te,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.name=n),placeholder:"Setlist name"},{default:V(()=>[v(r(l.value.name),1)]),_:1},8,["modelValue"])]),s("div",De,[(a(!0),d(f,null,I(l.value.sections,(n,p)=>(a(),d("div",Ve,[s("h2",null,[U(te,{class:"section-name",modelValue:n.name,"onUpdate:modelValue":m=>n.name=m,placeholder:"Section name"},{default:V(()=>[v(r(n.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),s("div",Ae,[K(n).length?(a(),d("div",{key:0,class:"duplicates",title:`Duplicates: ${K(n).map(m=>m.title).join(", ")}`},[Pe,v(" "+r(K(n).length)+" Duplicates ",1)],8,Ee)):g("",!0),s("div",null,[$e,v(" "+r(n.songs.length)+" Songs ",1)]),s("div",Me,[Te,v(" "+r(X(p))+" Pages ",1)]),s("div",xe,[Le,v(" about "+r(ee(n)),1)]),s("div",{title:"Delete Section",class:"delete-section",onClick:m=>l.value.sections.splice(p,1)},[Ue,v(" Delete Section ")],8,Ne)]),U(D(j),{modelValue:n.songs,"onUpdate:modelValue":m=>n.songs=m,class:"songs","item-key":"id",onDragover:e[1]||(e[1]=y(()=>{},["stop"])),disabled:D(J)(),group:"songs"},{item:V(({element:m})=>[(a(),h(z,{key:m.id,song:L(m),"allow-delete":"",onDelete:O=>n.songs.splice(n.songs.indexOf(m),1)},null,8,["song","onDelete"]))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),s("div",{class:"info add-song",onClick:y(m=>B.value=p,["stop"])},[B.value===p?(a(),h(be,{key:0,onClick:e[2]||(e[2]=y(()=>{},["stop"])),onSelect:m=>n.songs.push(m)},null,8,["onSelect"])):(a(),d(f,{key:1},[Be,v(" Add Song ")],64))],8,Ie)]))),256)),s("div",{class:"info add-song",onClick:le},[Ke,v(" Add Section ")])])],32),re.value?(a(),d("div",Oe,[s("div",Re,[s("span",{class:"material-symbols-rounded",onClick:q,title:"Print (Ctrl+P)"}," print "),s("span",{class:"material-symbols-rounded",onClick:W,title:"Download as PDF (CTRL+SHIFT+S)"}," picture_as_pdf "),s("span",{class:"material-symbols-rounded",onClick:G,title:"Download as JSON (CTRL+S)"}," file_download "),Fe,s("span",{class:F(["material-symbols-rounded",{active:_.value==="preview"}]),onClick:e[5]||(e[5]=n=>_.value="preview"),title:"Insights"}," preview ",2),s("span",{class:F(["material-symbols-rounded",{active:_.value==="add"}]),onClick:e[6]||(e[6]=n=>_.value="add"),title:"Add songs"}," playlist_add ",2),s("span",{class:F(["material-symbols-rounded",{active:_.value==="insights"}]),onClick:e[7]||(e[7]=n=>_.value="insights"),title:"Insights"}," insights ",2)]),s("div",je,[_.value=="preview"?(a(!0),d(f,{key:0},I(l.value.sections,(n,p)=>(a(),d(f,null,[p>0?(a(),d("hr",Je)):g("",!0),s("h2",null,r(n.name),1),(a(!0),d(f,null,I(n.songs,(m,O)=>(a(),h(ne,{ref_for:!0,ref_key:"allPages",ref:S,printing:"",song:L(m),onOnPageCount:R=>x.value[p][O]=R,"page-offset":x.value[p].slice(0,O).reduce((R,ue)=>R+ue,0),"section-name":n.name,"disable-hotkeys":""},null,8,["song","onOnPageCount","page-offset","section-name"]))),256))],64))),256)):_.value=="add"?(a(),d(f,{key:1},[T.value.length?(a(),d("h2",ze,"Add new songs")):g("",!0),T.value.length?(a(),h(D(j),{key:1,modelValue:T.value,"onUpdate:modelValue":e[8]||(e[8]=n=>T.value=n),class:"songs","item-key":"id",onDragover:e[9]||(e[9]=y(()=>{},["stop"])),group:"songs",disabled:D(J)()},{item:V(({element:n})=>[(a(),h(z,{key:n.id,song:n},null,8,["song"]))]),_:1},8,["modelValue","disabled"])):g("",!0),E.value.length?(a(),d("hr",He)):g("",!0),E.value.length?(a(),d("h2",qe,"Add songs again")):g("",!0),E.value.length?(a(),h(D(j),{key:4,modelValue:E.value,"onUpdate:modelValue":e[10]||(e[10]=n=>E.value=n),class:"songs","item-key":"id",onDragover:e[11]||(e[11]=y(()=>{},["stop"])),group:"songs",disabled:D(J)()},{item:V(({element:n})=>[(a(),h(z,{key:n.id,song:n},null,8,["song"]))]),_:1},8,["modelValue","disabled"])):g("",!0)],64)):_.value=="insights"?(a(),d(f,{key:2},[We,s("div",Ge,[s("div",Qe,[s("h3",null,r(l.value.sections.length),1),Xe]),s("div",Ye,[s("h3",null,r(l.value.sections.map(n=>n.songs.length).reduce((n,p)=>n+p,0)),1),Ze]),s("div",es,[s("h3",null,r(l.value.sections.map((n,p)=>X(p)).reduce((n,p)=>n+p,0)),1),ss]),s("div",ts,[s("h3",null,r(ee({songs:l.value.sections.flatMap(n=>n.songs)})),1),ns]),s("div",os,[s("h3",null,r(Y(ie())),1),as]),(a(!0),d(f,null,I(de.value,n=>(a(),d("div",ls,[s("h3",null,r(n.song.title),1),s("span",is," Duplicated "+r(n.count)+" times ",1)]))),256))])],64)):g("",!0)])])):g("",!0),s("dialog",{ref_key:"renderDialog",ref:c},[s("div",ds,[s("div",rs,[s("div",us,[w.value>=0?(a(),h(ne,{key:0,printing:"",song:D(k).songs[w.value]},null,8,["song"])):g("",!0)])]),cs,ms,s("div",ps,[s("progress",{value:w.value,max:(i=S.value)==null?void 0:i.length},null,8,vs),s("p",null,[s("span",null,r(w.value),1),v(" / "+r((b=S.value)==null?void 0:b.length),1)])])])],512)],32)}}}),ws=Se(gs,[["__scopeId","data-v-993b5d56"]]);export{ws as default};
