import{u as U,P as Z,_ as ee,T as $,a as j,D as W,I as x,S as te,d as A,m as ne}from"./vuedraggable.umd-0b224424.js";import{d as k,r as h,q as Y,o as _,c as f,b as l,e as c,t as y,l as P,s as w,F as V,g as I,i as O,u as M,v as oe,x as se,f as T,p as G,j as H,y as le,z as ae,A as ie,B as ue,C as de,a as re,k as ce}from"./main-2e932615.js";import{_ as N}from"./_commonjsHelpers-4c1cfbbd.js";import{m as pe}from"./importMidi-9b1ed0ab.js";const me={class:"song printable"},ve={class:"wrap"},_e={class:"void"},ge=k({__name:"Song",props:{song:{required:!0,type:Object}},setup(d,{expose:m}){const g=d,e=U(),p=h(),v=h(),s=h(),o=h([[...g.song.sections,...g.song.midi??[]]]),i=h(0);Y(()=>{var D,F;if(!s.value)return;const b=[],q=(D=v.value)==null?void 0:D.getSections();if(!q)return;const J=[...g.song.sections,...g.song.midi??[]];for(let B=0;B<q.length;B++){const K=q[B],z=J[B],Q=K.getBoundingClientRect().bottom,X=((F=s.value)==null?void 0:F.getBoundingClientRect().bottom)??0,L=Math.ceil(Q/X)-1;if(!b[L]){b[L]=[z];continue}b[L].push(z)}o.value=b});const t=()=>{i.value+1>=o.value.length||i.value++},a=()=>{i.value-1<0||i.value--},n=()=>i.value+1,u=()=>o.value.length,r=async()=>{var b;return await((b=p.value)==null?void 0:b.render())};return m({nextPage:t,prevPage:a,getCurrentPage:n,getTotalPages:u,download:async()=>{await e.prepareRender();const b=await r();b&&b.save(`${g.song.title}.pdf`)},print:async()=>{await e.prepareRender();const b=await r();b&&(b.autoPrint(),window.open(b.output("bloburl"),"_blank"))}}),(b,q)=>(_(),f("div",{class:"parent",ref_key:"element",ref:s},[l("div",me,[l("div",ve,[c(Z,{ref_key:"mainPage",ref:v,song:d.song,pages:o.value,currentPage:i.value},null,8,["song","pages","currentPage"])])]),l("div",_e,[c(ee,{ref_key:"allPages",ref:p,song:d.song},null,8,["song"])])],512))}}),fe={class:"input"},be={key:0},he=["value","max","min"],Ve=k({__name:"NumberInput",props:{modelValue:{required:!0,type:Number},max:{required:!1,type:Number},min:{required:!1,type:Number},label:{required:!1,type:String}},emits:["update:modelValue"],setup(d,{emit:m}){const g=e=>{const p=e.target.value;m("update:modelValue",p)};return(e,p)=>(_(),f("div",fe,[d.label?(_(),f("h2",be,y(d.label),1)):P("",!0),l("input",{value:d.modelValue,onInput:g,class:"textinput",type:"number",max:d.max,min:d.min},null,40,he)]))}});const S=N(Ve,[["__scopeId","data-v-b43258cc"]]),ye={class:"material-symbols-rounded"},ke={key:0},xe=k({__name:"Checkbox",props:{modelValue:{required:!0,type:Boolean},label:{required:!1,type:String}},emits:["update:modelValue"],setup(d,{emit:m}){const g=e=>{m("update:modelValue",e)};return(e,p)=>(_(),f("div",{class:"input",onClick:p[0]||(p[0]=v=>g(!d.modelValue))},[l("span",ye,y(d.modelValue?"check_box":"check_box_outline_blank"),1),d.label?(_(),f("h2",ke,y(d.label),1)):P("",!0)]))}});const $e=N(xe,[["__scopeId","data-v-96cc0e53"]]),we={class:"group"},Ce=l("h2",null,"Options",-1),Ie={class:"content"},Se={class:"group"},Ue=l("div",{class:"flex space-between"},[l("h2",null,"Instruments")],-1),Ee={class:"content"},Pe={class:"group"},Ne={class:"flex end"},qe=["onClick"],Be={class:"content"},Me={class:"flex"},Te=k({__name:"Instrument",props:{song:{required:!0,type:Object}},setup(d){const m=d,g=U();w(()=>m.song,s=>{s&&(e.value=s)});const e=h(m.song),p=s=>{if(["l","r1","r2"].includes(s)&&!e.value.instruments[s]){e.value.instruments[s]={type:j[0],name:j[0],volume:100,page:1};return}};w(()=>e.value,s=>{s&&g.updateSong(s)});const v=h({});return window.addEventListener("click",s=>{let o=s.target;for(let a=0;a<5;a++){if(!o)return;if(o.classList.contains("group")||!o.parentElement)break;o=o.parentElement}if(!o)return;const[i,t]=o.id.split(".");for(let a=0;a<e.value.sections.length;a++){const n=e.value.sections[a];for(let u=0;u<n.progression.length;u++){if(a===Number(i)&&u===Number(t)){console.log("found");continue}const r=n.progression[u];delete r.selected}}}),window.addEventListener("chord-click",s=>{const{sectionIndex:o,chordIndex:i}=s.detail,t=`${o}.${i}`,a=()=>{var n;(n=document.getElementById(t))==null||n.scrollIntoView({behavior:"smooth",block:"center"})};if(!v.value.sections){v.value.sections=!0,setTimeout(a,10);return}a()}),(s,o)=>(_(),f(V,null,[l("div",we,[Ce,l("div",Ie,[(_(!0),f(V,null,I(e.value.options,(i,t)=>(_(),O($e,{modelValue:e.value.options[t],"onUpdate:modelValue":a=>e.value.options[t]=a,label:t},null,8,["modelValue","onUpdate:modelValue","label"]))),256))])]),l("div",Se,[Ue,l("div",Ee,[(_(!0),f(V,null,I(Object.keys(e.value.instruments),i=>(_(),f("div",Pe,[l("h2",null,y(i),1),l("div",Ne,[l("span",{onClick:t=>delete e.value.instruments[i],class:"material-symbols-rounded"}," - ",8,qe)]),l("div",Be,[c($,{modelValue:e.value.instruments[i].name,"onUpdate:modelValue":t=>e.value.instruments[i].name=t,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),c(S,{modelValue:e.value.instruments[i].volume,"onUpdate:modelValue":t=>e.value.instruments[i].volume=t,min:0,max:127,label:"volume"},null,8,["modelValue","onUpdate:modelValue"]),c(S,{modelValue:e.value.instruments[i].page,"onUpdate:modelValue":t=>e.value.instruments[i].page=t,label:"page"},null,8,["modelValue","onUpdate:modelValue"]),c(W,{modelValue:e.value.instruments[i].type,"onUpdate:modelValue":t=>e.value.instruments[i].type=t,options:M(j),label:"type"},null,8,["modelValue","onUpdate:modelValue","options"])])]))),256))]),l("div",Me,[(_(),f(V,null,I(["l","r1","r2"],i=>oe(c(x,{onClick:t=>p(i),icon:"add",label:"Add "+i},null,8,["onClick","label"]),[[se,!e.value.instruments[i]]])),64))])])],64))}}),Oe=k({__name:"Metadata",props:{song:{required:!0,type:Object}},setup(d){const m=d,g=U();w(()=>m.song,v=>{v&&(e.value=v)});const e=h(m.song);w(()=>e.value,v=>{v&&g.updateSong(v)});const p=h({});return window.addEventListener("click",v=>{let s=v.target;for(let t=0;t<5;t++){if(!s)return;if(s.classList.contains("group")||!s.parentElement)break;s=s.parentElement}if(!s)return;const[o,i]=s.id.split(".");for(let t=0;t<e.value.sections.length;t++){const a=e.value.sections[t];for(let n=0;n<a.progression.length;n++){if(t===Number(o)&&n===Number(i)){console.log("found");continue}const u=a.progression[n];delete u.selected}}}),window.addEventListener("chord-click",v=>{const{sectionIndex:s,chordIndex:o}=v.detail,i=`${s}.${o}`,t=()=>{var a;(a=document.getElementById(i))==null||a.scrollIntoView({behavior:"smooth",block:"center"})};if(!p.value.sections){p.value.sections=!0,setTimeout(t,10);return}t()}),(v,s)=>(_(),f(V,null,[c($,{modelValue:e.value.title,"onUpdate:modelValue":s[0]||(s[0]=o=>e.value.title=o),label:"title"},null,8,["modelValue"]),c($,{modelValue:e.value.artist,"onUpdate:modelValue":s[1]||(s[1]=o=>e.value.artist=o),label:"artist"},null,8,["modelValue"]),c($,{modelValue:e.value.key,"onUpdate:modelValue":s[2]||(s[2]=o=>e.value.key=o),label:"key"},null,8,["modelValue"]),c(S,{modelValue:e.value.bpm,"onUpdate:modelValue":s[3]||(s[3]=o=>e.value.bpm=o),min:0,label:"bpm"},null,8,["modelValue"]),c(S,{modelValue:e.value.transpose,"onUpdate:modelValue":s[4]||(s[4]=o=>e.value.transpose=o),min:-12,max:12,label:"transpose"},null,8,["modelValue"]),c(S,{modelValue:e.value.octave,"onUpdate:modelValue":s[5]||(s[5]=o=>e.value.octave=o),min:-1,max:1,label:"octave"},null,8,["modelValue"])],64))}}),R=d=>(G("data-v-e1cdf1ce"),d=d(),H(),d),Le={class:"group"},je=R(()=>l("h2",null,"Structure",-1)),We={class:"content"},Re={class:"group"},De={class:"flex space-between"},Fe=R(()=>l("h2",null,"Sections",-1)),ze={class:"group section"},Ae={class:"flex space-between"},Ye={class:"flex"},Ge=["onClick"],He={class:"content"},Je=["onClick","id"],Ke={class:"flex end"},Qe=["onClick"],Xe={class:"content flex-row"},Ze={class:"group"},et=R(()=>l("h2",null,"Melodies",-1)),tt={class:"content"},nt={class:"group"},ot={class:"flex"},st=k({__name:"Structure",props:{song:{required:!0,type:Object}},setup(d){const m=d,g=U();w(()=>m.song,t=>{t&&(e.value=t)});const e=h(m.song);w(()=>e.value,t=>{t&&g.updateSong(t)});const p=h({});window.addEventListener("click",t=>{let a=t.target;for(let r=0;r<5;r++){if(!a)return;if(a.classList.contains("group")||!a.parentElement)break;a=a.parentElement}if(!a)return;const[n,u]=a.id.split(".");for(let r=0;r<e.value.sections.length;r++){const C=e.value.sections[r];for(let E=0;E<C.progression.length;E++){if(r===Number(n)&&E===Number(u)){console.log("found");continue}const b=C.progression[E];delete b.selected}}}),window.addEventListener("chord-click",t=>{const{sectionIndex:a,chordIndex:n}=t.detail,u=`${a}.${n}`,r=()=>{var C;(C=document.getElementById(u))==null||C.scrollIntoView({behavior:"smooth",block:"center"})};if(!p.value.sections){p.value.sections=!0,setTimeout(r,10);return}r()});const v=t=>{e.value.midi&&e.value.midi.splice(t,1)},s=async()=>new Promise((t,a)=>{const n=document.createElement("input");n.type="file",n.accept=".mid",n.onchange=async()=>{if(!n.files){a();return}const u=n.files[0],r=await pe(u);if(!r){a();return}t(r)},n.click()}),o=async t=>{const a=await s();a&&e.value.midi&&(e.value.midi[t]=a)},i=async()=>{e.value.midi||(e.value.midi=[]);const t=await s();t&&e.value.midi.push(t)};return(t,a)=>(_(),f(V,null,[l("div",Le,[je,l("div",We,[(_(!0),f(V,null,I(e.value.structure,(n,u)=>(_(),O(W,{modelValue:e.value.structure[u],"onUpdate:modelValue":[r=>e.value.structure[u]=r,r=>{r==="(none)"&&e.value.structure.splice(u,1)}],options:[...e.value.sections.map(r=>String(r.type)),"(none)"],label:"section"},null,8,["modelValue","onUpdate:modelValue","options"]))),256))]),c(x,{onClick:a[0]||(a[0]=n=>e.value.structure.push("")),icon:"add",label:"add section"})]),l("div",Re,[l("div",De,[Fe,l("span",{class:"material-symbols-rounded",onClick:a[1]||(a[1]=n=>p.value.sections=!p.value.sections)},y(p.value.sections?"expand_less":"expand_more"),1)]),p.value.sections?(_(),f(V,{key:0},[c(M(A),{modelValue:e.value.sections,"onUpdate:modelValue":a[2]||(a[2]=n=>e.value.sections=n),class:"content"},{item:T(({element:n})=>[l("div",ze,[l("div",Ae,[l("div",Ye,[c(W,{modelValue:n.type,"onUpdate:modelValue":u=>n.type=u,options:M(te),label:"type"},null,8,["modelValue","onUpdate:modelValue","options"]),c($,{modelValue:n.name,"onUpdate:modelValue":u=>n.name=u,label:"name"},null,8,["modelValue","onUpdate:modelValue"])]),l("span",{onClick:u=>e.value.sections.splice(e.value.sections.indexOf(n),1),class:"material-symbols-rounded"}," delete ",8,Ge)]),l("div",He,[c(M(A),{modelValue:n.progression,"onUpdate:modelValue":u=>n.progression=u,class:"content"},{item:T(({element:u})=>[l("div",{class:"group chord",onClick:r=>u.selected=!0,id:e.value.sections.indexOf(n)+"."+n.progression.indexOf(u)},[l("div",Ke,[l("span",{onClick:r=>n.progression.splice(n.progression.indexOf(u),1),class:"material-symbols-rounded"},"-",8,Qe)]),l("div",Xe,[c($,{modelValue:u.chord,"onUpdate:modelValue":r=>u.chord=r,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),c(S,{modelValue:u.duration,"onUpdate:modelValue":r=>u.duration=r,min:1,label:"duration"},null,8,["modelValue","onUpdate:modelValue"])])],8,Je)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),c(x,{onClick:u=>n.progression.push({chord:"C",duration:4}),icon:"add",label:"add chord"},null,8,["onClick"])])]),_:1},8,["modelValue"]),c(x,{onClick:a[3]||(a[3]=n=>e.value.sections.push({type:"chorus",progression:[]})),icon:"add",label:"add section"})],64)):P("",!0)]),l("div",Ze,[et,l("div",tt,[(_(!0),f(V,null,I(d.song.midi,(n,u)=>(_(),f("div",nt,[c($,{modelValue:n.name,"onUpdate:modelValue":r=>n.name=r,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),l("div",ot,[c(x,{onClick:r=>v(u),icon:"delete",label:"delete"},null,8,["onClick"]),c(x,{onClick:r=>o(u),icon:"sync",label:"replace"},null,8,["onClick"])])]))),256))]),c(x,{onClick:i,icon:"add",label:"add"})])],64))}});const lt=N(st,[["__scopeId","data-v-e1cdf1ce"]]),at={class:"settings"},it={class:"tabs flex space-between"},ut=["onClick"],dt={class:"configuration"},rt=k({__name:"Editor",props:{song:{required:!0,type:Object}},setup(d){const m=d;U(),w(()=>m.song,v=>{v&&(g.value=v)});const g=h(m.song),e=[{name:"metadata",component:Oe},{name:"instrument",component:Te},{name:"sections",component:lt}],p=h(e[0]);return(v,s)=>(_(),f("div",at,[l("div",it,[(_(),f(V,null,I(e,o=>l("label",{key:o.name,class:le({selected:p.value.name===o.name}),onClick:i=>p.value=o},y(o.name),11,ut)),64))]),l("div",dt,[(_(),O(ae(p.value.component),{song:d.song},null,8,["song"]))])]))}});const ct={key:0,class:"min-width"},pt=k({__name:"MinWidth",props:{minWidth:{required:!0,type:Number},error:{required:!1,type:String,default:"Mobile devices are currently not supported."}},setup(d){const m=h(0);return Y(()=>{m.value=window.innerWidth}),window.addEventListener("resize",()=>{m.value=window.innerWidth}),(g,e)=>m.value<d.minWidth?(_(),f("div",ct,[l("p",null,y(d.error),1)])):ie(g.$slots,"default",{key:1},void 0,!0)}});const mt=N(pt,[["__scopeId","data-v-40782251"]]),vt=d=>(G("data-v-33979d70"),d=d(),H(),d),_t={key:0,class:"editor"},gt=vt(()=>l("span",{class:"material-symbols-rounded"},"arrow_back",-1)),ft={class:"preview"},bt={key:0,class:"pages"},ht={class:"print a4"},Vt={class:"config"},yt=k({__name:"index",setup(d){const m=U();m.songs.length||m.addSong(ne);const g=ue(),e=de();let p=g.query.s;if(!p){const i=m.addEmptySong();e.push({query:{s:i},replace:!0}),p=String(i)}const v=Number(p);isNaN(v)&&e.push("/"),m.songs[v]||e.push("/");const s=h(m.songs[v]),o=h();return(i,t)=>{const a=re("router-link");return _(),O(mt,{minWidth:1100},{default:T(()=>[s.value?(_(),f("div",_t,[c(a,{to:"/",class:"back-button"},{default:T(()=>[gt]),_:1}),l("div",ft,[o.value?(_(),f("div",bt,[l("span",{onClick:t[0]||(t[0]=(...n)=>o.value.prevPage&&o.value.prevPage(...n)),class:"material-symbols-rounded"}," chevron_left "),ce(" "+y(o.value.getCurrentPage())+" / "+y(o.value.getTotalPages())+" ",1),l("span",{onClick:t[1]||(t[1]=(...n)=>o.value.nextPage&&o.value.nextPage(...n)),class:"material-symbols-rounded"}," chevron_right "),l("span",{class:"material-symbols-rounded",onClick:t[2]||(t[2]=(...n)=>o.value.print&&o.value.print(...n))}," print "),l("span",{class:"material-symbols-rounded",onClick:t[3]||(t[3]=(...n)=>o.value.download&&o.value.download(...n))}," file_download ")])):P("",!0),l("div",ht,[c(ge,{song:s.value,ref_key:"preview",ref:o},null,8,["song"])])]),l("div",Vt,[c(rt,{song:s.value},null,8,["song"])])])):P("",!0)]),_:1})}}});const Ct=N(yt,[["__scopeId","data-v-33979d70"]]);export{Ct as default};
