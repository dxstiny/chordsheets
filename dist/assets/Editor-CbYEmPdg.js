import{d as G,r as N,y as K,x as le,z as te,w as ae,c as m,J as oe,D as de,N as ie,m as U,O as Y,s as j,o as r,C as L,_ as se,e as F,l as v,u as re,A as ue,F as D,i as I,a,b as k,t as g,h as V,g as C,f as A,P as Z,p as ce,j as me}from"./main-Ff3BIIMF.js";import{d as ee}from"./vuedraggable.umd-C9rQ_nbd.js";/* empty css                                                               */import{d as pe,E as ge}from"./dom-to-image-aRLAw4Vz.js";const fe=["placeholder"],ve=G({__name:"EditableText",props:{modelValue:{type:String,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(o,{emit:x}){const $=o,d=N($.modelValue);K(()=>$.modelValue,S=>d.value=S);const h=N(!1),P=x,s=N(null),y=()=>{$.locked||(h.value=!0,L(()=>{s.value&&s.value.focus()}))},O=le(()=>$.locked?!0:h.value?!1:d.value||d.value=="0"),T=S=>{d.value=S,P("change",S),P("update:modelValue",S)},H=()=>{s.value&&(s.value.style.height="auto",s.value.style.height=s.value.scrollHeight+"px")};return te(()=>H()),ae(()=>{h.value&&H()}),(S,f)=>(r(),m("div",{class:j(["editable-text",{outlined:!o.noOutline&&h.value,editing:h.value}]),onDblclick:U(y,["stop"])},[O.value?oe(S.$slots,"default",{key:0},void 0,!0):de((r(),m("input",{key:1,ref_key:"area",ref:s,type:"text",class:"textarea","onUpdate:modelValue":f[0]||(f[0]=b=>d.value=b),onChange:f[1]||(f[1]=b=>T(b.target.value)),onInput:f[2]||(f[2]=b=>H()),onClick:f[3]||(f[3]=U(b=>h.value=!0,["stop"])),onKeydown:[f[4]||(f[4]=Y(b=>h.value=!1,["enter"])),f[5]||(f[5]=Y(b=>h.value=!1,["esc"]))],onBlur:f[6]||(f[6]=b=>h.value=!1),placeholder:o.placeholder},null,40,fe)),[[ie,d.value]])],34))}}),w=se(ve,[["__scopeId","data-v-f3071512"]]),J=G({__name:"EditableNumber",props:{modelValue:{type:Number,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(o,{emit:x}){const $=o,d=N(String($.modelValue));K(()=>$.modelValue,s=>d.value=String(s));const h=x,P=s=>{const y=Number(s);d.value=s,h("change",y),h("update:modelValue",y)};return(s,y)=>(r(),F(w,{modelValue:d.value,"onUpdate:modelValue":y[0]||(y[0]=O=>d.value=O),onChange:P,"no-outline":o.noOutline,locked:o.locked,placeholder:o.placeholder},{default:v(()=>[oe(s.$slots,"default")]),_:3},8,["modelValue","no-outline","locked","placeholder"]))}}),R=()=>window.innerWidth<=800,E=o=>(ce("data-v-2c938d6d"),o=o(),me(),o),he={class:"editor__header"},ke={class:"wrap-to-line"},ye={class:"info"},Ve=E(()=>a("span",{class:"material-symbols-rounded"},"music_note",-1)),be={class:"info"},Ce=E(()=>a("span",{class:"material-symbols-rounded"},"piano",-1)),we={class:"info"},Ue={class:"material-symbols-rounded"},$e={class:"info"},Se=E(()=>a("span",{class:"material-symbols-rounded"}," check ",-1)),Ee={class:"capitalise"},Pe=["onClick"],Me=E(()=>a("span",{class:"material-symbols-rounded"}," add ",-1)),Be={key:0},Ne={class:"instruments"},_e={class:"instrument"},De=["onClick"],xe={class:"flex space-between"},Oe={class:"flex gap-2"},He=E(()=>a("span",{class:"material-symbols-rounded"}," volume_up ",-1)),ze={class:"settings"},Ie={class:"muted"},Ke=E(()=>a("span",{class:"material-symbols-rounded"}," add ",-1)),Te=E(()=>a("hr",null,null,-1)),We=["id"],Ae={class:"name"},Le={key:0,class:"buttons"},qe=["onClick"],Je=["onClick"],Re={key:1,class:"progression"},je=["onClick"],Fe=E(()=>a("span",{class:"material-symbols-rounded"}," add ",-1)),Ge=["id","onMousedown","onMouseup"],Xe=["onClick"],Qe=["id"],Ye={class:"name"},Ze={class:"progression"},et=["id"],tt=E(()=>a("span",{class:"material-symbols-rounded"}," add ",-1)),ot={key:4,class:"pageNumber"},st={key:5,class:"sectionName"},nt=G({__name:"Editor",props:{song:{type:Object,required:!0},printing:{type:Boolean,default:!1},pageOffset:{type:Number,default:0},sectionName:{type:String,required:!1},disableHotkeys:{type:Boolean,default:!1}},emits:["onPageCount"],setup(o,{expose:x,emit:$}){const d=o,h=re(),P=N(!1),s=N(d.printing),y=N(),O=(n,e)=>{const u=d.song.sections[n].progression[e],p={chord:u.chord,duration:u.duration};d.song.sections[n].progression.splice(e+1,0,p)},T=n=>{if(!d.disableHotkeys){if(n.key==="Delete")for(const e of d.song.sections)e.progression=e.progression.filter(i=>!i.selected);if(n.ctrlKey&&(n.key==="d"||n.key==="b")){n.preventDefault();for(const e of d.song.sections){const i=e.progression.filter(u=>u.selected);e.progression.splice(e.progression.indexOf(i[i.length-1])+1,0,...i.map(u=>({chord:u.chord,duration:u.duration,selected:!0}))),i.forEach(u=>u.selected=!1)}}n.ctrlKey&&n.key==="p"&&(n.preventDefault(),ne())}},H=(n,e)=>{if(e.button===2||R())return;const i=e.target;if(e.offsetX>i.clientWidth-10){e.preventDefault(),e.stopImmediatePropagation(),P.value=!0;const u=i.getBoundingClientRect().width/n.duration;let p=0;const t=l=>{const B=l.clientX-i.getBoundingClientRect().left;p=Math.round(B/u),n.duration=Math.max(1,Math.min(16,p))},c=l=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",c),P.value=!1,l.stopImmediatePropagation()};window.addEventListener("mousemove",t),window.addEventListener("mouseup",c)}},S=(n,e)=>{let i=n.selected;if(!e.shiftKey)for(const u of d.song.sections)for(const p of u.progression)p.selected=!1;n.selected=!i},f=n=>{d.song.sections.splice(n,1)},b=n=>{const e=d.song.sections[n],i={type:e.type,progression:e.progression.map(u=>({chord:u.chord,duration:u.duration})),page:0};d.song.sections.splice(n+1,0,i)},X=async n=>{const e=y.value.querySelectorAll(".editor");let i=e[0];const u=i.clientHeight/i.clientWidth;for(let c=0;c<e.length;c++){if(i=e[c],!i)continue;var p=n.internal.pageSize.getWidth(),t=n.internal.pageSize.getHeight();const l=2,B=await pe.toJpeg(i,{height:i.clientHeight*l,width:i.clientWidth*l,style:{transform:`scale(${l}) translate(${i.clientWidth/2/l}px, ${i.clientHeight/2/l}px)`}});t=u*p,n.addImage(B,"JPG",0,0,p,t),c+1<e.length&&n.addPage()}return n};let W;const Q=async()=>{s.value=!0,d.song.sections.length&&!d.printing&&await new Promise(i=>{W=i});const n=new ge({orientation:"portrait",unit:"px",format:"a4"});return await X(n),s.value=d.printing,n},ne=async()=>{await h.prepareRender();const n=await Q();n&&(n.autoPrint(),window.open(n.output("bloburl"),"_blank"))};te(()=>{window.addEventListener("keydown",T),z()}),ue(()=>{window.removeEventListener("keydown",T)});const M=N([]),z=()=>{if(d.song.sections.length==0){M.value=[{start:0,end:0}],q("onPageCount",1);return}if(!s.value||M.value.length==0){M.value=[{start:0,end:d.song.sections.length}],s.value&&d.song.sections.length>0&&L(z),q("onPageCount",1);return}const n=y.value.querySelectorAll(".section");if(n.length==0)return;const e=n[0].parentElement,i=getComputedStyle(e),u=e.clientHeight-parseFloat(i.paddingBottom);for(let p=0;p<n.length;p++){const t=n[p];if(t.offsetTop+t.offsetHeight>u){M.value[M.value.length-1].end=p,M.value.push({start:p,end:d.song.sections.length}),L(z);return}}q("onPageCount",M.value.length),W==null||W()};K(()=>d.song,z,{deep:!0}),K(s,()=>L(z)),K(()=>d.printing,()=>{s.value=d.printing}),x({renderTo:X,render:Q,name:()=>d.song.title});const q=$;return(n,e)=>(r(),m("div",{ref_key:"parent",ref:y,class:"pageWrapper"},[(r(!0),m(D,null,I(M.value,(i,u)=>{var p;return r(),m("div",{class:j(["editor",{resizing:P.value,print:s.value}]),onDragover:e[14]||(e[14]=U(()=>{},["prevent"]))},[u==0?(r(),m(D,{key:0},[a("div",he,[k(w,{locked:s.value,modelValue:o.song.artist,"onUpdate:modelValue":e[0]||(e[0]=t=>o.song.artist=t),class:"left",placeholder:"Click to edit artist name","no-outline":""},{default:v(()=>[a("h3",null,g(o.song.artist),1)]),_:1},8,["locked","modelValue"]),k(w,{locked:s.value,modelValue:o.song.title,"onUpdate:modelValue":e[1]||(e[1]=t=>o.song.title=t),class:"left h1",placeholder:"Click to edit song title","no-outline":""},{default:v(()=>[a("h1",null,g(o.song.title),1)]),_:1},8,["locked","modelValue"])]),a("div",ke,[a("div",ye,[Ve,k(J,{locked:s.value,modelValue:o.song.bpm,"onUpdate:modelValue":e[2]||(e[2]=t=>o.song.bpm=t),class:"left short",placeholder:"120"},{default:v(()=>[V(g(o.song.bpm),1)]),_:1},8,["locked","modelValue"]),V(" BPM ")]),a("div",be,[Ce,k(w,{locked:s.value,modelValue:o.song.key,"onUpdate:modelValue":e[3]||(e[3]=t=>o.song.key=t),class:"left short",placeholder:"C"},{default:v(()=>[V(g(o.song.key),1)]),_:1},8,["locked","modelValue"])]),a("div",we,[a("span",Ue,g(o.song.transpose>0?"arrow_upward":o.song.transpose<0?"arrow_downward":"drag_handle"),1),k(J,{locked:s.value,modelValue:o.song.transpose,"onUpdate:modelValue":e[4]||(e[4]=t=>o.song.transpose=t),class:"left short",placeholder:"0"},{default:v(()=>[V(g(o.song.transpose),1)]),_:1},8,["locked","modelValue"])]),o.song.options?(r(!0),m(D,{key:0},I(o.song.options,(t,c)=>(r(),m("div",$e,[Se,k(w,{locked:s.value,modelValue:o.song.options[c],"onUpdate:modelValue":l=>o.song.options[c]=l,class:"left",placeholder:"Option"},{default:v(()=>[a("span",Ee,g(t),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?C("",!0):(r(),m("span",{key:0,onClick:l=>o.song.options.splice(c,1),class:"delete material-symbols-rounded"}," delete ",8,Pe))]))),256)):C("",!0),a("div",{class:"info add-option",onClick:e[5]||(e[5]=t=>o.song.options?o.song.options.push("Sustain"):o.song.options=["Sustain"])},[Me,V(" Add Option ")])]),(p=o.song.instruments)!=null&&p.length?(r(),m("hr",Be)):C("",!0),a("div",Ne,[(r(!0),m(D,null,I(o.song.instruments,(t,c)=>(r(),m("div",_e,[s.value?C("",!0):(r(),m("span",{key:0,onClick:l=>o.song.instruments.splice(c,1),class:"delete material-symbols-rounded"}," delete ",8,De)),a("div",xe,[k(w,{locked:s.value,modelValue:t.for,"onUpdate:modelValue":l=>t.for=l,class:"left short",placeholder:"Click to edit instrument","no-outline":""},{default:v(()=>[a("span",null,g(t.for),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),a("span",Oe,[He,k(J,{locked:s.value,modelValue:t.volume,"onUpdate:modelValue":l=>t.volume=l,class:"left short",placeholder:"100"},{default:v(()=>[V(g(t==null?void 0:t.volume),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"])])]),a("div",ze,[k(w,{locked:s.value,modelValue:t.name,"onUpdate:modelValue":l=>t.name=l,class:"left h3",placeholder:"Click to edit instrument name","no-outline":""},{default:v(()=>[a("h3",null,g(t.name),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),a("span",Ie,[k(w,{locked:s.value,modelValue:t.type,"onUpdate:modelValue":l=>t.type=l,class:"left",placeholder:"Click to edit instrument type","no-outline":""},{default:v(()=>[V(g(t==null?void 0:t.type),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"])])])]))),256)),a("div",{class:"instrument add-option",onClick:e[6]||(e[6]=t=>o.song.instruments.push({name:"ConcertGrand",for:"R1",type:"Piano",volume:100}))},[Ke,V(" Add Instrument ")])]),Te],64)):C("",!0),s.value?(r(!0),m(D,{key:2},I(d.song.sections.slice(i.start,i.end),(t,c)=>(r(),m("div",{class:"section printable",id:`section-${c}`},[a("span",Ye,g(t.type),1),a("div",Ze,[(r(!0),m(D,null,I(t.progression,(l,B)=>(r(),m("div",{class:"chord",ref_for:!0,ref:"chordElements",id:`chord-${c}-${B}`,style:Z({"--cols":l.duration})},g(l.chord),13,et))),256))])],8,Qe))),256)):(r(),F(A(ee),{key:1,modelValue:o.song.sections,"onUpdate:modelValue":e[11]||(e[11]=t=>o.song.sections=t),class:"editor__content",onDragover:e[12]||(e[12]=U(()=>{},["stop"])),itemKey:"id",disabled:A(R)()},{item:v(({element:t,index:c})=>[a("div",{class:"section",id:`section-${c}`},[k(w,{locked:s.value,modelValue:t.type,"onUpdate:modelValue":l=>t.type=l,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:v(()=>[a("span",Ae,g(t.type),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?C("",!0):(r(),m("div",Le,[a("span",{class:"button material-symbols-rounded",onClick:l=>b(c)}," content_copy ",8,qe),a("span",{class:"button material-symbols-rounded",onClick:l=>f(c)}," delete ",8,Je)])),t.progression.length===0?(r(),m("div",Re,[a("div",{class:"chord create",style:{"--cols":4},onClick:U(l=>t.progression.push({chord:"C",duration:4}),["stop"])},[Fe,V(" Add Chord ")],8,je)])):(r(),F(A(ee),{key:2,modelValue:t.progression,"onUpdate:modelValue":l=>t.progression=l,class:"progression",onDragover:e[10]||(e[10]=U(()=>{},["stop"])),itemKey:"id",disabled:A(R)()},{item:v(({element:l,index:B})=>[a("div",{class:j(["chord",l.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${c}-${B}`,onMousedown:_=>H(l,_),onMouseup:_=>S(l,_),onClick:e[9]||(e[9]=U(()=>{},["stop"])),style:Z({"--cols":l.duration})},[k(w,{locked:s.value,modelValue:l.chord,"onUpdate:modelValue":_=>l.chord=_,"no-outline":"",placeholder:"C"},{default:v(()=>[V(g(l.chord),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?C("",!0):(r(),m("span",{key:0,class:"insert_chord_here",onMousedown:e[7]||(e[7]=U(()=>{},["stop"])),onMouseup:e[8]||(e[8]=U(()=>{},["stop"])),onClick:U(_=>O(c,B),["stop"])},null,40,Xe))],46,Ge)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]))],8,We)]),_:2},1032,["modelValue","disabled"])),s.value?C("",!0):(r(),m("div",{key:3,class:"add-section",id:"add-section",onClick:e[13]||(e[13]=t=>o.song.sections.push({type:"New Section",progression:[]}))},[tt,V(" Add Section ")])),s.value?(r(),m("span",ot,g(u+o.pageOffset+1),1)):C("",!0),s.value&&o.sectionName?(r(),m("span",st,g(o.sectionName),1)):C("",!0)],34)}),256))],512))}}),rt=se(nt,[["__scopeId","data-v-2c938d6d"]]);export{rt as E,w as a,R as i};
