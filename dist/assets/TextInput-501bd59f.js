import{M as W}from"./MidiPreview-1221b8c9.js";import{d as B,r as w,i as A,e as s,c as o,a as n,t as c,k as b,g as p,F as v,j as k,x as j,m as N,p as H,h as L,_ as T,o as z,y as O,C as F,f as J}from"./main-fd247abd.js";import{a as R,E as D}from"./vuedraggable.umd-c11bd1c4.js";import{I as G}from"./Dropdown-9babb4f1.js";const I=t=>(H("data-v-be96f358"),t=t(),L(),t),U={key:0,class:"meta"},K={class:"wrap-to-line"},Q={class:"info"},X=I(()=>n("span",{class:"material-symbols-rounded"},"music_note",-1)),Y={class:"info"},Z=I(()=>n("span",{class:"material-symbols-rounded"},"piano",-1)),ee={key:0,class:"info"},te={class:"material-symbols-rounded"},se={key:1,class:"info"},ne={class:"material-symbols-rounded"},oe={key:0,class:"info"},ae=I(()=>n("span",{class:"material-symbols-rounded"}," check ",-1)),le={class:"capitalise"},ce={key:0},re={class:"instruments"},ie={class:"instrument"},ue={class:"flex space-between"},de={class:"flex gap-2"},ge=I(()=>n("span",{class:"material-symbols-rounded"},"volume_up",-1)),_e={class:"settings"},he={class:"muted"},pe={key:0},ve={class:"structure"},fe=I(()=>n("hr",null,null,-1)),me=["id"],ye={class:"progression"},be=["onClick"],ke=B({__name:"Page",props:{currentPage:{required:!0,type:Number},pages:{required:!0,type:Array},song:{required:!0,type:Object}},setup(t,{expose:P}){const i=t,_=w([]),d=w([]),y=w(),S=()=>[..._.value,...d.value],$=(l,a)=>{const e=new CustomEvent("chord-click",{detail:{sectionIndex:l,chordIndex:a}});window.dispatchEvent(e)};P({getSections:S});const C=l=>{let{type:a,name:e}=l;return a==="(other)"?e:a+(e?`: ${e}`:"")},g=A(()=>{var l;return(l=i.pages[i.currentPage])==null?void 0:l.filter(a=>a==null?void 0:a.type)}),r=A(()=>i.pages[i.currentPage].filter(l=>l==null?void 0:l.signature));return(l,a)=>(s(),o("div",{class:"page",ref_key:"page",ref:y},[t.currentPage==0?(s(),o("div",U,[n("h2",null,c(t.song.artist),1),n("h1",null,c(t.song.title),1),n("div",K,[n("div",Q,[X,b(" "+c(t.song.bpm)+" BPM ",1)]),n("div",Y,[Z,b(" "+c(t.song.key),1)]),t.song.transpose?(s(),o("div",ee,[n("span",te,c(t.song.transpose>0?"arrow_upward":"arrow_downward"),1),b(" "+c(t.song.transpose),1)])):p("",!0),t.song.octave?(s(),o("div",se,[n("span",ne,c(t.song.octave>0?"arrow_upward":"arrow_downward"),1),b(" "+c(t.song.octave)+" octave ",1)])):p("",!0),(s(!0),o(v,null,k(t.song.options,(e,u)=>(s(),o(v,null,[e?(s(),o("div",oe,[ae,n("span",le,c(u),1)])):p("",!0)],64))),256))]),Object.keys(t.song.instruments).length?(s(),o("hr",ce)):p("",!0),n("div",re,[(s(!0),o(v,null,k(t.song.instruments,(e,u)=>(s(),o("div",ie,[n("div",ue,[n("span",null,c(u),1),n("span",de,[ge,b(" "+c(e==null?void 0:e.volume),1)])]),n("div",_e,[n("h3",null,c(e==null?void 0:e.name),1),n("span",he,[b(c(e==null?void 0:e.type)+" ",1),e!=null&&e.page?(s(),o(v,{key:0},[b(" | P"+c(e==null?void 0:e.page),1)],64)):p("",!0)])])]))),256))]),t.song.structure?(s(),o(v,{key:1},[t.song.structure.length?(s(),o("hr",pe)):p("",!0),n("div",ve,[(s(!0),o(v,null,k(t.song.structure,e=>(s(),o("span",null,c(e),1))),256))])],64)):p("",!0),fe])):p("",!0),(s(!0),o(v,null,k(g.value,(e,u)=>(s(),o("div",{class:"section",ref_for:!0,ref_key:"sections",ref:_,id:String(u)},[n("span",null,c(C(e)),1),n("div",ye,[(s(!0),o(v,null,k(e.progression,(f,m)=>(s(),o("div",{class:j(["chord",`w-${f.duration}`+(f.selected?" selected":"")]),onClick:h=>$(u,m)},c(f.chord),11,be))),256))])],8,me))),256)),t.song.midi?(s(!0),o(v,{key:1},k(r.value,e=>{var u;return s(),o("div",{class:"section",ref_for:!0,ref_key:"midiSections",ref:d},[n("span",null,c(e==null?void 0:e.name),1),N(W,{track:e,width:((u=y.value)==null?void 0:u.clientWidth)??400},null,8,["track","width"])],512)}),256)):p("",!0)],512))}});const we=T(ke,[["__scopeId","data-v-be96f358"]]),Pe={class:"wrap"},Ie=B({__name:"AllPages",props:{song:{required:!0,type:Object}},setup(t,{expose:P}){const i=t,_=w(),d=w(),y=w(),S=()=>{var u,f,m;const r=(u=d.value)==null?void 0:u[0];if(!r)return;const l=[],a=(m=(f=y.value)==null?void 0:f[0])==null?void 0:m.getSections();if(!a)return;const e=[...i.song.sections,...i.song.midi??[]];for(let h=0;h<a.length;h++){const x=a[h],V=e[h],E=x.getBoundingClientRect().bottom,M=(r==null?void 0:r.getBoundingClientRect().height)??0,q=Math.ceil(E/M)-1;if(!l[q]){l[q]=[V];continue}l[q].push(V)}g.value=l,g.value.length||g.value.push([null])};z(S),O(()=>i.song.sections.length,()=>{g.value=[[...i.song.sections,...i.song.midi??[]]],F(S)});const $=async r=>{if(!_.value)return r;const l=_.value.querySelectorAll(".parent__element");let a=l[0];const e=a.clientHeight/a.clientWidth;for(let m=0;m<g.value.length;m++){if(a=l[m],!a)continue;var u=r.internal.pageSize.getWidth(),f=r.internal.pageSize.getHeight();const h=2,x=await R.toJpeg(a,{height:a.offsetHeight*h,width:a.offsetWidth*h,style:{transform:`scale(${h}) translate(${a.offsetWidth/2/h}px, ${a.offsetHeight/2/h}px)`}});f=e*u,r.addImage(x,"JPG",0,0,u,f),m+1<g.value.length&&r.addPage()}return r},C=async()=>{const r=new D({orientation:"portrait",unit:"px",format:"a4"});return await $(r),r},g=w([[...i.song.sections,...i.song.midi??[]]]);return g.value[0].length===0&&(g.value=[[null]]),P({render:C,renderTo:$,song:i.song}),(r,l)=>(s(),o("div",{ref_key:"allpageselement",ref:_,id:"allPages"},[(s(!0),o(v,null,k(g.value,(a,e)=>(s(),o("div",{class:"print a4 parent__element",ref_for:!0,ref_key:"parent",ref:d},[n("div",Pe,[N(we,{class:"page__element",ref_for:!0,ref_key:"element",ref:y,song:t.song,pages:g.value,currentPage:e},null,8,["song","pages","currentPage"])])],512))),256))],512))}});const Ne=T(Ie,[["__scopeId","data-v-b8c86e17"]]),Se={class:"input"},$e={key:0},Ce={class:"items"},xe=["value","placeholder"],qe=B({__name:"TextInput",props:{modelValue:{required:!0,type:String},label:{required:!1,type:String},placeholder:{required:!1,type:String},buttonLabel:{required:!1,type:String},buttonIcon:{required:!1,type:String}},emits:["update:modelValue","change","buttonClick"],setup(t,{emit:P}){const i=_=>{const d=_.target.value;P("update:modelValue",d)};return(_,d)=>(s(),o("div",Se,[t.label?(s(),o("h2",$e,c(t.label),1)):p("",!0),n("div",Ce,[n("input",{value:t.modelValue,onInput:i,class:"textinput",type:"text",placeholder:t.placeholder,onChange:d[0]||(d[0]=y=>_.$emit("change"))},null,40,xe),t.buttonLabel||t.buttonIcon?(s(),J(G,{key:0,label:t.buttonLabel,icon:t.buttonIcon,onClick:d[1]||(d[1]=y=>_.$emit("buttonClick"))},null,8,["label","icon"])):p("",!0)])]))}});const Ee=T(qe,[["__scopeId","data-v-818508fa"]]);export{Ne as A,we as P,Ee as T};
