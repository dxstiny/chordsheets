import{d as G,r as S,z as W,m as Y,i as J,x as Z,o as m,j as C,k as ee,A as oe,B as te,y as g,C as q,D as N,E as H,_ as R,u as se,G as ne,n as A,F as D,g as s,f as y,w as p,t as v,s as k,l as j,e as L,v as K,q as F,p as le,h as ae}from"./main-f436b829.js";import{a as de,d as O,E as ie}from"./vuedraggable.umd-5d20f546.js";const re=["onDblclick"],ue=["placeholder"],ce=G({__name:"EditableText",props:{modelValue:{type:String,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(n,{emit:P}){const i=n,$=S(i.modelValue);W(()=>i.modelValue,U=>$.value=U);const w=S(!1),h=S(null),x=()=>{i.locked||(w.value=!0,H(()=>{h.value&&h.value.focus()}))},I=Y(()=>i.locked?!0:w.value?!1:$.value||$.value=="0"),T=U=>{$.value=U,P("change",U),P("update:modelValue",U)},M=()=>{h.value&&(h.value.style.height="auto",h.value.style.height=h.value.scrollHeight+"px")};return J(()=>M()),Z(()=>{w.value&&M()}),(U,r)=>(m(),C("div",{class:N(["editable-text",{outlined:!n.noOutline&&w.value}]),onDblclick:g(x,["stop"])},[I.value?ee(U.$slots,"default",{key:0},void 0,!0):oe((m(),C("input",{key:1,ref_key:"area",ref:h,type:"text",class:"textarea","onUpdate:modelValue":r[0]||(r[0]=_=>$.value=_),onChange:r[1]||(r[1]=_=>T(_.target.value)),onInput:r[2]||(r[2]=_=>M()),onClick:r[3]||(r[3]=g(_=>w.value=!0,["stop"])),onKeydown:[r[4]||(r[4]=q(_=>w.value=!1,["enter"])),r[5]||(r[5]=q(_=>w.value=!1,["esc"]))],onBlur:r[6]||(r[6]=_=>w.value=!1),placeholder:n.placeholder},null,40,ue)),[[te,$.value]])],42,re))}});const V=R(ce,[["__scopeId","data-v-793c6cbc"]]),b=n=>(le("data-v-dd8e19da"),n=n(),ae(),n),pe={class:"editor__header"},me={class:"wrap-to-line"},ge={class:"info"},fe=b(()=>s("span",{class:"material-symbols-rounded"},"music_note",-1)),ve={class:"info"},he=b(()=>s("span",{class:"material-symbols-rounded"},"piano",-1)),ye={class:"info"},Ve={class:"material-symbols-rounded"},ke={class:"info"},Ce=b(()=>s("span",{class:"material-symbols-rounded"}," check ",-1)),we={class:"capitalise"},_e=["onClick"],be=b(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Ue=b(()=>s("hr",null,null,-1)),$e={class:"instruments"},Me={class:"instrument"},Ee=["onClick"],Se={class:"flex space-between"},Be={class:"flex gap-2"},De=b(()=>s("span",{class:"material-symbols-rounded"}," volume_up ",-1)),Pe={class:"settings"},xe={class:"muted"},Ie=b(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Te=b(()=>s("hr",null,null,-1)),ze=["id"],Ae={class:"name"},Ne={class:"buttons"},He=["onClick"],Le=["onClick"],Ke={key:0,class:"progression"},Oe=["onClick"],We=b(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),qe=["id","onMousedown","onMouseup"],je=["onClick"],Fe=["id"],Ge={class:"name"},Je={class:"buttons"},Re=["onClick"],Xe=["onClick"],Qe={key:0,class:"progression"},Ye=["onClick"],Ze=b(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),eo=["id","onMousedown","onMouseup"],oo=["onClick"],to=b(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),so=G({__name:"Editor",props:{song:{type:Object,required:!0},printing:{type:Boolean,default:!1}},setup(n,{expose:P}){const i=n,$=se(),w=S(!1),h=S(i.printing),x=(l,e)=>{const u=i.song.sections[l].progression[e],o={chord:u.chord,duration:u.duration};i.song.sections[l].progression.splice(e+1,0,o)},I=l=>{if(l.key==="Delete")for(const e of i.song.sections)e.progression=e.progression.filter(a=>!a.selected);if(l.ctrlKey&&(l.key==="d"||l.key==="b")){l.preventDefault();for(const e of i.song.sections)for(const a of e.progression)if(a.selected){const u={chord:a.chord,duration:a.duration};e.progression.splice(e.progression.indexOf(a)+1,0,u)}}l.ctrlKey&&l.key==="p"&&(l.preventDefault(),Q())},T=(l,e)=>{if(e.button===2)return;const a=e.target;if(e.offsetX>a.clientWidth-10){e.preventDefault(),e.stopImmediatePropagation(),w.value=!0;const u=a.getBoundingClientRect().width/l.duration;let o=0;const d=f=>{const c=f.clientX-a.getBoundingClientRect().left;o=Math.round(c/u),l.duration=Math.max(1,Math.min(16,o))},t=f=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",t),w.value=!1,f.stopImmediatePropagation()};window.addEventListener("mousemove",d),window.addEventListener("mouseup",t)}},M=(l,e)=>{let a=l.selected;if(!e.shiftKey)for(const u of i.song.sections)for(const o of u.progression)o.selected=!1;l.selected=!a},U=l=>{i.song.sections[l],i.song.sections.splice(l,1)},r=l=>{const e=i.song.sections[l],a={type:e.type,progression:e.progression.map(u=>({chord:u.chord,duration:u.duration})),page:0};i.song.sections.splice(l+1,0,a)},_=async l=>{const e=document.querySelectorAll(".editor");let a=e[0];const u=a.clientHeight/a.clientWidth;for(let t=0;t<e.length;t++){if(a=e[t],!a)continue;var o=l.internal.pageSize.getWidth(),d=l.internal.pageSize.getHeight();const f=2,c=await de.toJpeg(a,{height:a.clientHeight*f,width:a.clientWidth*f,style:{transform:`scale(${f}) translate(${a.clientWidth/2/f}px, ${a.clientHeight/2/f}px)`}});d=u*o,l.addImage(c,"JPG",0,0,o,d),t+1<e.length&&l.addPage()}return l};let z;const X=async()=>{h.value=!0,await new Promise(a=>{z=a});const e=new ie({orientation:"portrait",unit:"px",format:"a4"});return await _(e),e},Q=async()=>{await $.prepareRender();const l=await X();l&&(l.autoPrint(),window.open(l.output("bloburl"),"_blank"))};J(()=>{window.addEventListener("keydown",I),B()}),ne(()=>{window.removeEventListener("keydown",I)});const E=S([]),B=()=>{if(!h.value||E.value.length==0){E.value=[{start:0,end:i.song.sections.length}],h.value&&H(B);return}const l=document.querySelectorAll(".section");if(l.length==0)return;const e=l[0].parentElement,a=getComputedStyle(e),u=e.clientHeight-parseFloat(a.paddingBottom);for(let o=0;o<l.length;o++){const d=l[o];if(d.offsetTop+d.offsetHeight>u){E.value[E.value.length-1].end=o,E.value.push({start:o,end:i.song.sections.length}),H(B);return}}z==null||z()};return W(()=>i.song,B,{deep:!0}),W(h,()=>H(B)),P({renderTo:_}),(l,e)=>(m(!0),C(D,null,A(E.value,(a,u)=>(m(),C("div",{class:N(["editor",{resizing:w.value,print:h.value}]),onDragover:e[18]||(e[18]=g(()=>{},["prevent"]))},[u==0?(m(),C(D,{key:0},[s("div",pe,[y(V,{modelValue:n.song.artist,"onUpdate:modelValue":e[0]||(e[0]=o=>n.song.artist=o),class:"left",placeholder:"Click to edit artist name","no-outline":""},{default:p(()=>[s("h3",null,v(n.song.artist),1)]),_:1},8,["modelValue"]),y(V,{modelValue:n.song.title,"onUpdate:modelValue":e[1]||(e[1]=o=>n.song.title=o),class:"left h1",placeholder:"Click to edit song title","no-outline":""},{default:p(()=>[s("h1",null,v(n.song.title),1)]),_:1},8,["modelValue"])]),s("div",me,[s("div",ge,[fe,y(V,{modelValue:n.song.bpm,"onUpdate:modelValue":e[2]||(e[2]=o=>n.song.bpm=o),class:"left short",placeholder:"120"},{default:p(()=>[k(v(n.song.bpm),1)]),_:1},8,["modelValue"]),k(" BPM ")]),s("div",ve,[he,y(V,{modelValue:n.song.key,"onUpdate:modelValue":e[3]||(e[3]=o=>n.song.key=o),class:"left short",placeholder:"C"},{default:p(()=>[k(v(n.song.key),1)]),_:1},8,["modelValue"])]),s("div",ye,[s("span",Ve,v(n.song.transpose>0?"arrow_upward":n.song.transpose<0?"arrow_downward":"drag_handle"),1),y(V,{modelValue:n.song.transpose,"onUpdate:modelValue":e[4]||(e[4]=o=>n.song.transpose=o),class:"left short",placeholder:"0"},{default:p(()=>[k(v(n.song.transpose),1)]),_:1},8,["modelValue"])]),n.song.options?(m(!0),C(D,{key:0},A(n.song.options,(o,d)=>(m(),C("div",ke,[Ce,y(V,{modelValue:n.song.options[d],"onUpdate:modelValue":t=>n.song.options[d]=t,class:"left",placeholder:"Option"},{default:p(()=>[s("span",we,v(o),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{onClick:t=>n.song.options.splice(d,1),class:"delete material-symbols-rounded"}," delete ",8,_e)]))),256)):j("",!0),s("div",{class:"info add-option",onClick:e[5]||(e[5]=o=>n.song.options?n.song.options.push("Sustain"):n.song.options=["Sustain"])},[be,k(" Add Option ")])]),Ue,s("div",$e,[(m(!0),C(D,null,A(n.song.instruments,(o,d)=>(m(),C("div",Me,[s("span",{onClick:t=>n.song.instruments.splice(d,1),class:"delete material-symbols-rounded"}," delete ",8,Ee),s("div",Se,[y(V,{modelValue:o.for,"onUpdate:modelValue":t=>o.for=t,class:"left short",placeholder:"Click to edit instrument","no-outline":""},{default:p(()=>[s("span",null,v(o.for),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",Be,[De,y(V,{modelValue:o.volume,"onUpdate:modelValue":t=>o.volume=t,class:"left short",placeholder:"100"},{default:p(()=>[k(v(o==null?void 0:o.volume),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),s("div",Pe,[y(V,{modelValue:o.name,"onUpdate:modelValue":t=>o.name=t,class:"left h3",placeholder:"Click to edit instrument name","no-outline":""},{default:p(()=>[s("h3",null,v(o.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",xe,[y(V,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit instrument type","no-outline":""},{default:p(()=>[k(v(o==null?void 0:o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]))),256)),s("div",{class:"instrument add-option",onClick:e[6]||(e[6]=o=>n.song.instruments.push({name:"New Instrument",for:"New Instrument",type:"New Instrument",volume:100}))},[Ie,k(" Add Instrument ")])]),Te],64)):j("",!0),h.value?(m(!0),C(D,{key:2},A(i.song.sections.slice(a.start,a.end),(o,d)=>(m(),C("div",{class:"section",id:`section-${d}`},[y(V,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:p(()=>[s("span",Ge,v(o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("div",Je,[s("span",{class:"button material-symbols-rounded",onClick:t=>r(d)}," content_copy ",8,Re),s("span",{class:"button material-symbols-rounded",onClick:t=>U(d)}," delete ",8,Xe)]),o.progression.length===0?(m(),C("div",Qe,[s("div",{class:"chord create",style:{"--cols":4},onClick:g(t=>o.progression.push({chord:"C",duration:4}),["stop"])},[Ze,k(" Add Chord ")],8,Ye)])):(m(),L(K(O),{key:1,modelValue:o.progression,"onUpdate:modelValue":t=>o.progression=t,class:"progression",onDragover:e[16]||(e[16]=g(()=>{},["stop"]))},{item:p(({element:t,index:f})=>[s("div",{class:N(["chord",t.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${d}-${f}`,onMousedown:c=>T(t,c),onMouseup:c=>M(t,c),onClick:e[15]||(e[15]=g(()=>{},["stop"])),style:F({"--cols":t.duration})},[y(V,{modelValue:t.chord,"onUpdate:modelValue":c=>t.chord=c,"no-outline":"",placeholder:"C"},{default:p(()=>[k(v(t.chord),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{class:"insert_chord_here",onMousedown:e[13]||(e[13]=g(()=>{},["stop"])),onMouseup:e[14]||(e[14]=g(()=>{},["stop"])),onClick:g(c=>x(d,f),["stop"])},null,40,oo)],46,eo)]),_:2},1032,["modelValue","onUpdate:modelValue"]))],8,Fe))),256)):(m(),L(K(O),{key:1,modelValue:n.song.sections,"onUpdate:modelValue":e[11]||(e[11]=o=>n.song.sections=o),class:"editor__content",onDragover:e[12]||(e[12]=g(()=>{},["stop"]))},{item:p(({element:o,index:d})=>[s("div",{class:"section",id:`section-${d}`},[y(V,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:p(()=>[s("span",Ae,v(o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("div",Ne,[s("span",{class:"button material-symbols-rounded",onClick:t=>r(d)}," content_copy ",8,He),s("span",{class:"button material-symbols-rounded",onClick:t=>U(d)}," delete ",8,Le)]),o.progression.length===0?(m(),C("div",Ke,[s("div",{class:"chord create",style:{"--cols":4},onClick:g(t=>o.progression.push({chord:"C",duration:4}),["stop"])},[We,k(" Add Chord ")],8,Oe)])):(m(),L(K(O),{key:1,modelValue:o.progression,"onUpdate:modelValue":t=>o.progression=t,class:"progression",onDragover:e[10]||(e[10]=g(()=>{},["stop"]))},{item:p(({element:t,index:f})=>[s("div",{class:N(["chord",t.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${d}-${f}`,onMousedown:c=>T(t,c),onMouseup:c=>M(t,c),onClick:e[9]||(e[9]=g(()=>{},["stop"])),style:F({"--cols":t.duration})},[y(V,{modelValue:t.chord,"onUpdate:modelValue":c=>t.chord=c,"no-outline":"",placeholder:"C"},{default:p(()=>[k(v(t.chord),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{class:"insert_chord_here",onMousedown:e[7]||(e[7]=g(()=>{},["stop"])),onMouseup:e[8]||(e[8]=g(()=>{},["stop"])),onClick:g(c=>x(d,f),["stop"])},null,40,je)],46,qe)]),_:2},1032,["modelValue","onUpdate:modelValue"]))],8,ze)]),_:2},1032,["modelValue"])),s("div",{class:"add-section",id:"add-section",onClick:e[17]||(e[17]=o=>n.song.sections.push({type:"New Section",progression:[]}))},[to,k(" Add Section ")])],34))),256))}});const ao=R(so,[["__scopeId","data-v-dd8e19da"]]);export{ao as E};
