import{d as R,r as B,D as A,c as Z,s as ee,B as se,o as p,b as w,E as ne,x as le,y as ae,n as v,z as F,A as z,G as W,_ as oe,h as q,a as de,v as ie,F as x,f as L,e as s,g as C,w as f,t as y,k as b,j as X,i as N,H as Q,p as re,q as ue,I as ce}from"./main-rlhmeQaC.js";import{d as J}from"./vuedraggable.umd-CarpODAZ.js";import{d as pe,E as me}from"./dom-to-image-Bnns0Qfg.js";const ge=["placeholder"],fe=R({__name:"EditableText",props:{modelValue:{type:String,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(n,{emit:U}){const d=n,V=B(d.modelValue);A(()=>d.modelValue,E=>V.value=E);const u=B(!1),k=U,c=B(null),$=()=>{d.locked||(u.value=!0,W(()=>{c.value&&c.value.focus()}))},D=Z(()=>d.locked?!0:u.value?!1:V.value||V.value=="0"),H=E=>{V.value=E,k("change",E),k("update:modelValue",E)},I=()=>{c.value&&(c.value.style.height="auto",c.value.style.height=c.value.scrollHeight+"px")};return ee(()=>I()),se(()=>{u.value&&I()}),(E,m)=>(p(),w("div",{class:z(["editable-text",{outlined:!n.noOutline&&u.value}]),onDblclick:v($,["stop"])},[D.value?ne(E.$slots,"default",{key:0},void 0,!0):le((p(),w("input",{key:1,ref_key:"area",ref:c,type:"text",class:"textarea","onUpdate:modelValue":m[0]||(m[0]=_=>V.value=_),onChange:m[1]||(m[1]=_=>H(_.target.value)),onInput:m[2]||(m[2]=_=>I()),onClick:m[3]||(m[3]=v(_=>u.value=!0,["stop"])),onKeydown:[m[4]||(m[4]=F(_=>u.value=!1,["enter"])),m[5]||(m[5]=F(_=>u.value=!1,["esc"]))],onBlur:m[6]||(m[6]=_=>u.value=!1),placeholder:n.placeholder},null,40,ge)),[[ae,V.value]])],34))}}),S=oe(fe,[["__scopeId","data-v-793c6cbc"]]),G=R({__name:"EditableNumber",props:{modelValue:{type:Number,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(n,{emit:U}){const d=n,V=B(String(d.modelValue));A(()=>d.modelValue,c=>V.value=String(c));const u=U,k=c=>{const $=Number(c);V.value=$,u("change",$),u("update:modelValue",$)};return(c,$)=>(p(),q(S,{modelValue:V.value,"onUpdate:modelValue":$[0]||($[0]=D=>V.value=D),onChange:k,"no-outline":n.noOutline,locked:n.locked,placeholder:n.placeholder},null,8,["modelValue","no-outline","locked","placeholder"]))}}),T=()=>(console.log(window.innerWidth),window.innerWidth<=800),M=n=>(re("data-v-9977e654"),n=n(),ue(),n),ve={class:"editor__header"},he={class:"wrap-to-line"},ye={class:"info"},Ve=M(()=>s("span",{class:"material-symbols-rounded"},"music_note",-1)),ke={class:"info"},Ce=M(()=>s("span",{class:"material-symbols-rounded"},"piano",-1)),we={class:"info"},be={class:"material-symbols-rounded"},Se={class:"info"},Ue=M(()=>s("span",{class:"material-symbols-rounded"}," check ",-1)),$e={class:"capitalise"},_e=["onClick"],Me=M(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Ee=M(()=>s("hr",null,null,-1)),Be={class:"instruments"},Pe={class:"instrument"},De=["onClick"],Ie={class:"flex space-between"},Ne={class:"flex gap-2"},Oe=M(()=>s("span",{class:"material-symbols-rounded"}," volume_up ",-1)),xe={class:"settings"},Ae={class:"muted"},He=M(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Ke=M(()=>s("hr",null,null,-1)),Le=["id"],Te={class:"name"},ze={class:"buttons"},We=["onClick"],qe=["onClick"],Je={key:0,class:"progression"},Ge=["onClick"],Re=M(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),je=["id","onMousedown","onMouseup"],Fe=["onClick"],Xe=["id"],Qe={class:"name"},Ye={class:"buttons"},Ze=["onClick"],eo=["onClick"],oo={key:0,class:"progression"},to=["onClick"],so=M(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),no=["id","onMousedown","onMouseup"],lo=["onClick"],ao=M(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),io=R({__name:"Editor",props:{song:{type:Object,required:!0},printing:{type:Boolean,default:!1}},setup(n,{expose:U}){const d=n,V=de(),u=B(!1),k=B(d.printing),c=B(),$=(l,e)=>{const r=d.song.sections[l].progression[e],o={chord:r.chord,duration:r.duration};d.song.sections[l].progression.splice(e+1,0,o)},D=l=>{if(l.key==="Delete")for(const e of d.song.sections)e.progression=e.progression.filter(a=>!a.selected);if(l.ctrlKey&&(l.key==="d"||l.key==="b")){l.preventDefault();for(const e of d.song.sections){const a=e.progression.filter(r=>r.selected);e.progression.splice(e.progression.indexOf(a[a.length-1])+1,0,...a.map(r=>({chord:r.chord,duration:r.duration,selected:!0}))),a.forEach(r=>r.selected=!1)}}l.ctrlKey&&l.key==="p"&&(l.preventDefault(),te())},H=(l,e)=>{if(e.button===2||T())return;const a=e.target;if(e.offsetX>a.clientWidth-10){e.preventDefault(),e.stopImmediatePropagation(),u.value=!0;const r=a.getBoundingClientRect().width/l.duration;let o=0;const i=h=>{const g=h.clientX-a.getBoundingClientRect().left;o=Math.round(g/r),l.duration=Math.max(1,Math.min(16,o))},t=h=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",t),u.value=!1,h.stopImmediatePropagation()};window.addEventListener("mousemove",i),window.addEventListener("mouseup",t)}},I=(l,e)=>{let a=l.selected;if(!e.shiftKey)for(const r of d.song.sections)for(const o of r.progression)o.selected=!1;l.selected=!a},E=l=>{d.song.sections.splice(l,1)},m=l=>{const e=d.song.sections[l],a={type:e.type,progression:e.progression.map(r=>({chord:r.chord,duration:r.duration})),page:0};d.song.sections.splice(l+1,0,a)},_=async l=>{const e=c.value.querySelectorAll(".editor");let a=e[0];const r=a.clientHeight/a.clientWidth;for(let t=0;t<e.length;t++){if(a=e[t],!a)continue;var o=l.internal.pageSize.getWidth(),i=l.internal.pageSize.getHeight();const h=2,g=await pe.toJpeg(a,{height:a.clientHeight*h,width:a.clientWidth*h,style:{transform:`scale(${h}) translate(${a.clientWidth/2/h}px, ${a.clientHeight/2/h}px)`}});i=r*o,l.addImage(g,"JPG",0,0,o,i),t+1<e.length&&l.addPage()}return l};let K;const j=async()=>{k.value=!0,d.song.sections.length&&!d.printing&&await new Promise(a=>{K=a});const l=new me({orientation:"portrait",unit:"px",format:"a4"});return await _(l),k.value=d.printing,l},te=async()=>{await V.prepareRender();const l=await j();l&&(l.autoPrint(),window.open(l.output("bloburl"),"_blank"))};ee(()=>{window.addEventListener("keydown",D),O()}),ie(()=>{window.removeEventListener("keydown",D)});const P=B([]),O=()=>{if(d.song.sections.length==0){P.value=[{start:0,end:0}];return}if(!k.value||P.value.length==0){P.value=[{start:0,end:d.song.sections.length}],k.value&&d.song.sections.length>0&&W(O);return}const l=c.value.querySelectorAll(".section");if(l.length==0)return;const e=l[0].parentElement,a=getComputedStyle(e),r=e.clientHeight-parseFloat(a.paddingBottom);for(let o=0;o<l.length;o++){const i=l[o];if(i.offsetTop+i.offsetHeight>r){P.value[P.value.length-1].end=o,P.value.push({start:o,end:d.song.sections.length}),W(O);return}}K==null||K()};return A(()=>d.song,O,{deep:!0}),A(k,()=>W(O)),U({renderTo:_,render:j,name:()=>d.song.title}),(l,e)=>(p(),w("div",{ref_key:"parent",ref:c},[(p(!0),w(x,null,L(P.value,(a,r)=>(p(),w("div",{class:z(["editor",{resizing:u.value,print:k.value}]),onDragover:e[18]||(e[18]=v(()=>{},["prevent"]))},[r==0?(p(),w(x,{key:0},[s("div",ve,[C(S,{modelValue:n.song.artist,"onUpdate:modelValue":e[0]||(e[0]=o=>n.song.artist=o),class:"left",placeholder:"Click to edit artist name","no-outline":""},{default:f(()=>[s("h3",null,y(n.song.artist),1)]),_:1},8,["modelValue"]),C(S,{modelValue:n.song.title,"onUpdate:modelValue":e[1]||(e[1]=o=>n.song.title=o),class:"left h1",placeholder:"Click to edit song title","no-outline":""},{default:f(()=>[s("h1",null,y(n.song.title),1)]),_:1},8,["modelValue"])]),s("div",he,[s("div",ye,[Ve,C(G,{modelValue:n.song.bpm,"onUpdate:modelValue":e[2]||(e[2]=o=>n.song.bpm=o),class:"left short",placeholder:"120"},{default:f(()=>[b(y(n.song.bpm),1)]),_:1},8,["modelValue"]),b(" BPM ")]),s("div",ke,[Ce,C(S,{modelValue:n.song.key,"onUpdate:modelValue":e[3]||(e[3]=o=>n.song.key=o),class:"left short",placeholder:"C"},{default:f(()=>[b(y(n.song.key),1)]),_:1},8,["modelValue"])]),s("div",we,[s("span",be,y(n.song.transpose>0?"arrow_upward":n.song.transpose<0?"arrow_downward":"drag_handle"),1),C(G,{modelValue:n.song.transpose,"onUpdate:modelValue":e[4]||(e[4]=o=>n.song.transpose=o),class:"left short",placeholder:"0"},{default:f(()=>[b(y(n.song.transpose),1)]),_:1},8,["modelValue"])]),n.song.options?(p(!0),w(x,{key:0},L(n.song.options,(o,i)=>(p(),w("div",Se,[Ue,C(S,{modelValue:n.song.options[i],"onUpdate:modelValue":t=>n.song.options[i]=t,class:"left",placeholder:"Option"},{default:f(()=>[s("span",$e,y(o),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{onClick:t=>n.song.options.splice(i,1),class:"delete material-symbols-rounded"}," delete ",8,_e)]))),256)):X("",!0),s("div",{class:"info add-option",onClick:e[5]||(e[5]=o=>n.song.options?n.song.options.push("Sustain"):n.song.options=["Sustain"])},[Me,b(" Add Option ")])]),Ee,s("div",Be,[(p(!0),w(x,null,L(n.song.instruments,(o,i)=>(p(),w("div",Pe,[s("span",{onClick:t=>n.song.instruments.splice(i,1),class:"delete material-symbols-rounded"}," delete ",8,De),s("div",Ie,[C(S,{modelValue:o.for,"onUpdate:modelValue":t=>o.for=t,class:"left short",placeholder:"Click to edit instrument","no-outline":""},{default:f(()=>[s("span",null,y(o.for),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",Ne,[Oe,C(G,{modelValue:o.volume,"onUpdate:modelValue":t=>o.volume=t,class:"left short",placeholder:"100"},{default:f(()=>[b(y(o==null?void 0:o.volume),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),s("div",xe,[C(S,{modelValue:o.name,"onUpdate:modelValue":t=>o.name=t,class:"left h3",placeholder:"Click to edit instrument name","no-outline":""},{default:f(()=>[s("h3",null,y(o.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",Ae,[C(S,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit instrument type","no-outline":""},{default:f(()=>[b(y(o==null?void 0:o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]))),256)),s("div",{class:"instrument add-option",onClick:e[6]||(e[6]=o=>n.song.instruments.push({name:"ConcertGrand",for:"R1",type:"Piano",volume:100}))},[He,b(" Add Instrument ")])]),Ke],64)):X("",!0),k.value?(p(!0),w(x,{key:2},L(d.song.sections.slice(a.start,a.end),(o,i)=>(p(),w("div",{class:"section",id:`section-${i}`},[C(S,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:f(()=>[s("span",Qe,y(o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("div",Ye,[s("span",{class:"button material-symbols-rounded",onClick:t=>m(i)}," content_copy ",8,Ze),s("span",{class:"button material-symbols-rounded",onClick:t=>E(i)}," delete ",8,eo)]),o.progression.length===0?(p(),w("div",oo,[s("div",{class:"chord create",style:{"--cols":4},onClick:v(t=>o.progression.push({chord:"C",duration:4}),["stop"])},[so,b(" Add Chord ")],8,to)])):(p(),q(N(J),{key:1,modelValue:o.progression,"onUpdate:modelValue":t=>o.progression=t,class:"progression",onDragover:e[16]||(e[16]=v(()=>{},["stop"])),itemKey:"id",disabled:N(T)()},{item:f(({element:t,index:h})=>[s("div",{class:z(["chord",t.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${i}-${h}`,onMousedown:g=>H(t,g),onMouseup:g=>I(t,g),onClick:e[15]||(e[15]=v(()=>{},["stop"])),style:Q({"--cols":t.duration})},[C(S,{modelValue:t.chord,"onUpdate:modelValue":g=>t.chord=g,"no-outline":"",placeholder:"C"},{default:f(()=>[b(y(t.chord),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{class:"insert_chord_here",onMousedown:e[13]||(e[13]=v(()=>{},["stop"])),onMouseup:e[14]||(e[14]=v(()=>{},["stop"])),onClick:v(g=>$(i,h),["stop"])},null,40,lo)],46,no)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]))],8,Xe))),256)):(p(),q(N(J),{key:1,modelValue:n.song.sections,"onUpdate:modelValue":e[11]||(e[11]=o=>n.song.sections=o),class:"editor__content",onDragover:e[12]||(e[12]=v(()=>{},["stop"])),itemKey:"id",disabled:N(T)()},{item:f(({element:o,index:i})=>[s("div",{class:"section",id:`section-${i}`},[C(S,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:f(()=>[s("span",Te,y(o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("div",ze,[s("span",{class:"button material-symbols-rounded",onClick:t=>m(i)}," content_copy ",8,We),s("span",{class:"button material-symbols-rounded",onClick:t=>E(i)}," delete ",8,qe)]),o.progression.length===0?(p(),w("div",Je,[s("div",{class:"chord create",style:{"--cols":4},onClick:v(t=>o.progression.push({chord:"C",duration:4}),["stop"])},[Re,b(" Add Chord ")],8,Ge)])):(p(),q(N(J),{key:1,modelValue:o.progression,"onUpdate:modelValue":t=>o.progression=t,class:"progression",onDragover:e[10]||(e[10]=v(()=>{},["stop"])),itemKey:"id",disabled:N(T)()},{item:f(({element:t,index:h})=>[s("div",{class:z(["chord",t.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${i}-${h}`,onMousedown:g=>H(t,g),onMouseup:g=>I(t,g),onClick:e[9]||(e[9]=v(()=>{},["stop"])),style:Q({"--cols":t.duration})},[C(S,{modelValue:t.chord,"onUpdate:modelValue":g=>t.chord=g,"no-outline":"",placeholder:"C"},{default:f(()=>[b(y(t.chord),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{class:"insert_chord_here",onMousedown:e[7]||(e[7]=v(()=>{},["stop"])),onMouseup:e[8]||(e[8]=v(()=>{},["stop"])),onClick:v(g=>$(i,h),["stop"])},null,40,Fe)],46,je)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]))],8,Le)]),_:2},1032,["modelValue","disabled"])),s("div",{class:"add-section",id:"add-section",onClick:e[17]||(e[17]=o=>n.song.sections.push({type:"New Section",progression:[]}))},[ao,b(" Add Section ")])],34))),256))],512))}}),po=oe(io,[["__scopeId","data-v-9977e654"]]),Y="chordsheets.history",mo=ce("history",()=>{const U=B(JSON.parse(localStorage.getItem(Y)||"[]")),d=Z(()=>JSON.stringify(U.value));return A(U,()=>{localStorage.setItem(Y,d.value)},{deep:!0}),{history:U,songEdited:u=>{const k=new Date().toISOString();U.value=[{songId:u,date:k},...U.value.filter(c=>c.songId!==u).slice(0,9)]}}});export{po as E,mo as u};
