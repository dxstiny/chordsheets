import{a as J,r as S,D as N,c as Z,o as X,x as ee,f as m,g as V,E as oe,w as te,v as se,z as g,k as R,n as I,G as L,_ as Q,u as ne,e as le,F as D,j as T,h as s,p as h,y as p,t as v,m as k,l as j,A as O,i as W,H as F,q as ae,s as de}from"./main-xqxsP662.js";import{a as ie,E as re,d as q}from"./dom-to-image-DIqK-UZv.js";const ue=["placeholder"],ce=J({__name:"EditableText",props:{modelValue:{type:String,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(l,{emit:K}){const i=l,M=S(i.modelValue);N(()=>i.modelValue,$=>M.value=$);const C=S(!1),_=K,w=S(null),x=()=>{i.locked||(C.value=!0,L(()=>{w.value&&w.value.focus()}))},z=Z(()=>i.locked?!0:C.value?!1:M.value||M.value=="0"),A=$=>{M.value=$,_("change",$),_("update:modelValue",$)},P=()=>{w.value&&(w.value.style.height="auto",w.value.style.height=w.value.scrollHeight+"px")};return X(()=>P()),ee(()=>{C.value&&P()}),($,u)=>(m(),V("div",{class:I(["editable-text",{outlined:!l.noOutline&&C.value}]),onDblclick:g(x,["stop"])},[z.value?oe($.$slots,"default",{key:0},void 0,!0):te((m(),V("input",{key:1,ref_key:"area",ref:w,type:"text",class:"textarea","onUpdate:modelValue":u[0]||(u[0]=b=>M.value=b),onChange:u[1]||(u[1]=b=>A(b.target.value)),onInput:u[2]||(u[2]=b=>P()),onClick:u[3]||(u[3]=g(b=>C.value=!0,["stop"])),onKeydown:[u[4]||(u[4]=R(b=>C.value=!1,["enter"])),u[5]||(u[5]=R(b=>C.value=!1,["esc"]))],onBlur:u[6]||(u[6]=b=>C.value=!1),placeholder:l.placeholder},null,40,ue)),[[se,M.value]])],34))}}),y=Q(ce,[["__scopeId","data-v-793c6cbc"]]),U=l=>(ae("data-v-87b25612"),l=l(),de(),l),pe={class:"editor__header"},me={class:"wrap-to-line"},ge={class:"info"},fe=U(()=>s("span",{class:"material-symbols-rounded"},"music_note",-1)),ve={class:"info"},he=U(()=>s("span",{class:"material-symbols-rounded"},"piano",-1)),ye={class:"info"},Ve={class:"material-symbols-rounded"},ke={class:"info"},Ce=U(()=>s("span",{class:"material-symbols-rounded"}," check ",-1)),we={class:"capitalise"},be=["onClick"],Ue=U(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),_e=U(()=>s("hr",null,null,-1)),$e={class:"instruments"},Me={class:"instrument"},Ee=["onClick"],Se={class:"flex space-between"},Pe={class:"flex gap-2"},Be=U(()=>s("span",{class:"material-symbols-rounded"}," volume_up ",-1)),De={class:"settings"},xe={class:"muted"},ze=U(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Ae=U(()=>s("hr",null,null,-1)),He=["id"],Te={class:"name"},Ie={class:"buttons"},Le=["onClick"],Ke=["onClick"],Oe={key:0,class:"progression"},We=["onClick"],qe=U(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),Ne=["id","onMousedown","onMouseup"],Ge=["onClick"],Re=["id"],je={class:"name"},Fe={class:"buttons"},Je=["onClick"],Xe=["onClick"],Qe={key:0,class:"progression"},Ye=["onClick"],Ze=U(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),eo=["id","onMousedown","onMouseup"],oo=["onClick"],to=U(()=>s("span",{class:"material-symbols-rounded"}," add ",-1)),so=J({__name:"Editor",props:{song:{type:Object,required:!0},printing:{type:Boolean,default:!1}},setup(l,{expose:K}){const i=l,M=ne(),C=S(!1),_=S(i.printing),w=S(),x=(n,e)=>{const r=i.song.sections[n].progression[e],o={chord:r.chord,duration:r.duration};i.song.sections[n].progression.splice(e+1,0,o)},z=n=>{if(n.key==="Delete")for(const e of i.song.sections)e.progression=e.progression.filter(a=>!a.selected);if(n.ctrlKey&&(n.key==="d"||n.key==="b")){n.preventDefault();for(const e of i.song.sections){const a=e.progression.filter(r=>r.selected);e.progression.splice(e.progression.indexOf(a[a.length-1])+1,0,...a.map(r=>({chord:r.chord,duration:r.duration,selected:!0}))),a.forEach(r=>r.selected=!1)}}n.ctrlKey&&n.key==="p"&&(n.preventDefault(),Y())},A=(n,e)=>{if(e.button===2)return;const a=e.target;if(e.offsetX>a.clientWidth-10){e.preventDefault(),e.stopImmediatePropagation(),C.value=!0;const r=a.getBoundingClientRect().width/n.duration;let o=0;const d=f=>{const c=f.clientX-a.getBoundingClientRect().left;o=Math.round(c/r),n.duration=Math.max(1,Math.min(16,o))},t=f=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",t),C.value=!1,f.stopImmediatePropagation()};window.addEventListener("mousemove",d),window.addEventListener("mouseup",t)}},P=(n,e)=>{let a=n.selected;if(!e.shiftKey)for(const r of i.song.sections)for(const o of r.progression)o.selected=!1;n.selected=!a},$=n=>{i.song.sections.splice(n,1)},u=n=>{const e=i.song.sections[n],a={type:e.type,progression:e.progression.map(r=>({chord:r.chord,duration:r.duration})),page:0};i.song.sections.splice(n+1,0,a)},b=async n=>{const e=w.value.querySelectorAll(".editor");let a=e[0];const r=a.clientHeight/a.clientWidth;for(let t=0;t<e.length;t++){if(a=e[t],!a)continue;var o=n.internal.pageSize.getWidth(),d=n.internal.pageSize.getHeight();const f=2,c=await ie.toJpeg(a,{height:a.clientHeight*f,width:a.clientWidth*f,style:{transform:`scale(${f}) translate(${a.clientWidth/2/f}px, ${a.clientHeight/2/f}px)`}});d=r*o,n.addImage(c,"JPG",0,0,o,d),t+1<e.length&&n.addPage()}return n};let H;const G=async()=>{_.value=!0,i.song.sections.length&&!i.printing&&await new Promise(a=>{H=a});const n=new re({orientation:"portrait",unit:"px",format:"a4"});return await b(n),_.value=i.printing,n},Y=async()=>{await M.prepareRender();const n=await G();n&&(n.autoPrint(),window.open(n.output("bloburl"),"_blank"))};X(()=>{window.addEventListener("keydown",z),B()}),le(()=>{window.removeEventListener("keydown",z)});const E=S([]),B=()=>{if(i.song.sections.length==0){E.value=[{start:0,end:0}];return}if(!_.value||E.value.length==0){E.value=[{start:0,end:i.song.sections.length}],_.value&&i.song.sections.length>0&&L(B);return}const n=w.value.querySelectorAll(".section");if(n.length==0)return;const e=n[0].parentElement,a=getComputedStyle(e),r=e.clientHeight-parseFloat(a.paddingBottom);for(let o=0;o<n.length;o++){const d=n[o];if(d.offsetTop+d.offsetHeight>r){E.value[E.value.length-1].end=o,E.value.push({start:o,end:i.song.sections.length}),L(B);return}}H==null||H()};return N(()=>i.song,B,{deep:!0}),N(_,()=>L(B)),K({renderTo:b,render:G,name:()=>i.song.title}),(n,e)=>(m(),V("div",{ref_key:"parent",ref:w},[(m(!0),V(D,null,T(E.value,(a,r)=>(m(),V("div",{class:I(["editor",{resizing:C.value,print:_.value}]),onDragover:e[18]||(e[18]=g(()=>{},["prevent"]))},[r==0?(m(),V(D,{key:0},[s("div",pe,[h(y,{modelValue:l.song.artist,"onUpdate:modelValue":e[0]||(e[0]=o=>l.song.artist=o),class:"left",placeholder:"Click to edit artist name","no-outline":""},{default:p(()=>[s("h3",null,v(l.song.artist),1)]),_:1},8,["modelValue"]),h(y,{modelValue:l.song.title,"onUpdate:modelValue":e[1]||(e[1]=o=>l.song.title=o),class:"left h1",placeholder:"Click to edit song title","no-outline":""},{default:p(()=>[s("h1",null,v(l.song.title),1)]),_:1},8,["modelValue"])]),s("div",me,[s("div",ge,[fe,h(y,{modelValue:l.song.bpm,"onUpdate:modelValue":e[2]||(e[2]=o=>l.song.bpm=o),class:"left short",placeholder:"120"},{default:p(()=>[k(v(l.song.bpm),1)]),_:1},8,["modelValue"]),k(" BPM ")]),s("div",ve,[he,h(y,{modelValue:l.song.key,"onUpdate:modelValue":e[3]||(e[3]=o=>l.song.key=o),class:"left short",placeholder:"C"},{default:p(()=>[k(v(l.song.key),1)]),_:1},8,["modelValue"])]),s("div",ye,[s("span",Ve,v(l.song.transpose>0?"arrow_upward":l.song.transpose<0?"arrow_downward":"drag_handle"),1),h(y,{modelValue:l.song.transpose,"onUpdate:modelValue":e[4]||(e[4]=o=>l.song.transpose=o),class:"left short",placeholder:"0"},{default:p(()=>[k(v(l.song.transpose),1)]),_:1},8,["modelValue"])]),l.song.options?(m(!0),V(D,{key:0},T(l.song.options,(o,d)=>(m(),V("div",ke,[Ce,h(y,{modelValue:l.song.options[d],"onUpdate:modelValue":t=>l.song.options[d]=t,class:"left",placeholder:"Option"},{default:p(()=>[s("span",we,v(o),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{onClick:t=>l.song.options.splice(d,1),class:"delete material-symbols-rounded"}," delete ",8,be)]))),256)):j("",!0),s("div",{class:"info add-option",onClick:e[5]||(e[5]=o=>l.song.options?l.song.options.push("Sustain"):l.song.options=["Sustain"])},[Ue,k(" Add Option ")])]),_e,s("div",$e,[(m(!0),V(D,null,T(l.song.instruments,(o,d)=>(m(),V("div",Me,[s("span",{onClick:t=>l.song.instruments.splice(d,1),class:"delete material-symbols-rounded"}," delete ",8,Ee),s("div",Se,[h(y,{modelValue:o.for,"onUpdate:modelValue":t=>o.for=t,class:"left short",placeholder:"Click to edit instrument","no-outline":""},{default:p(()=>[s("span",null,v(o.for),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",Pe,[Be,h(y,{modelValue:o.volume,"onUpdate:modelValue":t=>o.volume=t,class:"left short",placeholder:"100"},{default:p(()=>[k(v(o==null?void 0:o.volume),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),s("div",De,[h(y,{modelValue:o.name,"onUpdate:modelValue":t=>o.name=t,class:"left h3",placeholder:"Click to edit instrument name","no-outline":""},{default:p(()=>[s("h3",null,v(o.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",xe,[h(y,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit instrument type","no-outline":""},{default:p(()=>[k(v(o==null?void 0:o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]))),256)),s("div",{class:"instrument add-option",onClick:e[6]||(e[6]=o=>l.song.instruments.push({name:"ConcertGrand",for:"R1",type:"Piano",volume:100}))},[ze,k(" Add Instrument ")])]),Ae],64)):j("",!0),_.value?(m(!0),V(D,{key:2},T(i.song.sections.slice(a.start,a.end),(o,d)=>(m(),V("div",{class:"section",id:`section-${d}`},[h(y,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:p(()=>[s("span",je,v(o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("div",Fe,[s("span",{class:"button material-symbols-rounded",onClick:t=>u(d)}," content_copy ",8,Je),s("span",{class:"button material-symbols-rounded",onClick:t=>$(d)}," delete ",8,Xe)]),o.progression.length===0?(m(),V("div",Qe,[s("div",{class:"chord create",style:{"--cols":4},onClick:g(t=>o.progression.push({chord:"C",duration:4}),["stop"])},[Ze,k(" Add Chord ")],8,Ye)])):(m(),O(W(q),{key:1,modelValue:o.progression,"onUpdate:modelValue":t=>o.progression=t,class:"progression",onDragover:e[16]||(e[16]=g(()=>{},["stop"]))},{item:p(({element:t,index:f})=>[s("div",{class:I(["chord",t.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${d}-${f}`,onMousedown:c=>A(t,c),onMouseup:c=>P(t,c),onClick:e[15]||(e[15]=g(()=>{},["stop"])),style:F({"--cols":t.duration})},[h(y,{modelValue:t.chord,"onUpdate:modelValue":c=>t.chord=c,"no-outline":"",placeholder:"C"},{default:p(()=>[k(v(t.chord),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{class:"insert_chord_here",onMousedown:e[13]||(e[13]=g(()=>{},["stop"])),onMouseup:e[14]||(e[14]=g(()=>{},["stop"])),onClick:g(c=>x(d,f),["stop"])},null,40,oo)],46,eo)]),_:2},1032,["modelValue","onUpdate:modelValue"]))],8,Re))),256)):(m(),O(W(q),{key:1,modelValue:l.song.sections,"onUpdate:modelValue":e[11]||(e[11]=o=>l.song.sections=o),class:"editor__content",onDragover:e[12]||(e[12]=g(()=>{},["stop"]))},{item:p(({element:o,index:d})=>[s("div",{class:"section",id:`section-${d}`},[h(y,{modelValue:o.type,"onUpdate:modelValue":t=>o.type=t,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:p(()=>[s("span",Te,v(o.type),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("div",Ie,[s("span",{class:"button material-symbols-rounded",onClick:t=>u(d)}," content_copy ",8,Le),s("span",{class:"button material-symbols-rounded",onClick:t=>$(d)}," delete ",8,Ke)]),o.progression.length===0?(m(),V("div",Oe,[s("div",{class:"chord create",style:{"--cols":4},onClick:g(t=>o.progression.push({chord:"C",duration:4}),["stop"])},[qe,k(" Add Chord ")],8,We)])):(m(),O(W(q),{key:1,modelValue:o.progression,"onUpdate:modelValue":t=>o.progression=t,class:"progression",onDragover:e[10]||(e[10]=g(()=>{},["stop"]))},{item:p(({element:t,index:f})=>[s("div",{class:I(["chord",t.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${d}-${f}`,onMousedown:c=>A(t,c),onMouseup:c=>P(t,c),onClick:e[9]||(e[9]=g(()=>{},["stop"])),style:F({"--cols":t.duration})},[h(y,{modelValue:t.chord,"onUpdate:modelValue":c=>t.chord=c,"no-outline":"",placeholder:"C"},{default:p(()=>[k(v(t.chord),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",{class:"insert_chord_here",onMousedown:e[7]||(e[7]=g(()=>{},["stop"])),onMouseup:e[8]||(e[8]=g(()=>{},["stop"])),onClick:g(c=>x(d,f),["stop"])},null,40,Ge)],46,Ne)]),_:2},1032,["modelValue","onUpdate:modelValue"]))],8,He)]),_:2},1032,["modelValue"])),s("div",{class:"add-section",id:"add-section",onClick:e[17]||(e[17]=o=>l.song.sections.push({type:"New Section",progression:[]}))},[to,k(" Add Section ")])],34))),256))],512))}}),ao=Q(so,[["__scopeId","data-v-87b25612"]]);export{ao as E};
