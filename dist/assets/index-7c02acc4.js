import{A as ne,P as se,T as w,d as Y}from"./vuedraggable.umd-bbe8c4f7.js";import{d as k,u as E,r as b,v as W,o as v,c as g,b as n,e as c,_ as M,t as C,j as $,x as S,F as V,l as P,i as j,f as T,I as D,y as le,z as ae,g as B,S as ie,h as G,p as Q,m as X,A as L,s as ue,B as re,C as de,D as ce,E as pe,a as me}from"./main-f8fa1c53.js";import{D as R,I as x}from"./Dropdown-13470a0a.js";import{m as ve}from"./importMidi-08b014be.js";import{s as _e,c as H}from"./inputListener-9decaab2.js";import"./_commonjsHelpers-678b9a21.js";const fe={class:"song printable"},ge={class:"wrap"},he={class:"void"},ye=k({__name:"Song",props:{song:{required:!0,type:Object}},setup(u,{expose:_}){const f=u,e=E(),m=b(),y=b(),i=b(),t=b([[...f.song.sections,...f.song.midi??[]]]),s=b(0);W(()=>{var F,z;if(!i.value)return;const h=[],U=(F=y.value)==null?void 0:F.getSections();if(!U)return;const Z=[...f.song.sections,...f.song.midi??[]];for(let O=0;O<U.length;O++){const ee=U[O],J=Z[O],te=ee.getBoundingClientRect().bottom,oe=((z=i.value)==null?void 0:z.getBoundingClientRect().bottom)??0,q=Math.ceil(te/oe)-1;if(!h[q]){h[q]=[J];continue}h[q].push(J)}t.value=h,t.value.length||t.value.push([null])});const d=()=>{s.value+1>=t.value.length||s.value++},o=()=>{s.value-1<0||s.value--},a=()=>s.value+1,l=()=>t.value.length,r=async()=>{var h;return await((h=m.value)==null?void 0:h.render())};return _({nextPage:d,prevPage:o,getCurrentPage:a,getTotalPages:l,download:async()=>{await e.prepareRender();const h=await r();h&&h.save(`${f.song.title}.pdf`)},print:async()=>{await e.prepareRender();const h=await r();h&&(h.autoPrint(),window.open(h.output("bloburl"),"_blank"))}}),(h,U)=>(v(),g("div",{class:"parent",ref_key:"element",ref:i},[n("div",fe,[n("div",ge,[c(ne,{ref_key:"allPages",ref:m,song:u.song},null,8,["song"])])]),n("div",he,[c(se,{ref_key:"mainPage",ref:y,song:u.song,pages:t.value,currentPage:s.value},null,8,["song","pages","currentPage"])])],512))}});const be=M(ye,[["__scopeId","data-v-423a3f7b"]]),Ve={class:"input"},ke={key:0},we=["value","max","min"],xe=k({__name:"NumberInput",props:{modelValue:{required:!0,type:Number},max:{required:!1,type:Number},min:{required:!1,type:Number},label:{required:!1,type:String}},emits:["update:modelValue"],setup(u,{emit:_}){const f=e=>{const m=e.target.value;_("update:modelValue",Number(m))};return(e,m)=>(v(),g("div",Ve,[u.label?(v(),g("h2",ke,C(u.label),1)):$("",!0),n("input",{value:u.modelValue,onInput:f,class:"textinput",type:"number",max:u.max,min:u.min},null,40,we)]))}});const N=M(xe,[["__scopeId","data-v-a474a2f7"]]),$e={class:"material-symbols-rounded"},Ce={key:0},Se=k({__name:"Checkbox",props:{modelValue:{required:!0,type:Boolean},label:{required:!1,type:String}},emits:["update:modelValue"],setup(u,{emit:_}){const f=e=>{_("update:modelValue",e)};return(e,m)=>(v(),g("div",{class:"input",onClick:m[0]||(m[0]=y=>f(!u.modelValue))},[n("span",$e,C(u.modelValue?"check_box":"check_box_outline_blank"),1),u.label?(v(),g("h2",Ce,C(u.label),1)):$("",!0)]))}});const Ie=M(Se,[["__scopeId","data-v-96cc0e53"]]),Ue={class:"group"},Pe=n("h2",null,"Options",-1),Ne={class:"content"},Ee={class:"group"},Me=n("div",{class:"flex space-between"},[n("h2",null,"Instruments")],-1),Be={class:"content"},Oe={class:"group"},Te={class:"flex end"},je=["onClick"],qe={class:"content"},De={class:"flex"},Le=k({__name:"Instrument",props:{song:{required:!0,type:Object}},setup(u){const _=u,f=E();S(()=>_.song,i=>{i&&(e.value=i)});const e=b(_.song),m=i=>{if(["l","r1","r2"].includes(i)&&!e.value.instruments[i]){e.value.instruments[i]={type:D[0],name:D[0],volume:100,page:1};return}};S(()=>e.value,i=>{i&&f.updateSong(i)});const y=b({});return window.addEventListener("click",i=>{let t=i.target;for(let o=0;o<5;o++){if(!t)return;if(t.classList.contains("group")||!t.parentElement)break;t=t.parentElement}if(!t)return;const[s,d]=t.id.split(".");for(let o=0;o<e.value.sections.length;o++){const a=e.value.sections[o];for(let l=0;l<a.progression.length;l++){if(o===Number(s)&&l===Number(d)){console.log("found");continue}const r=a.progression[l];delete r.selected}}}),window.addEventListener("chord-click",i=>{const{sectionIndex:t,chordIndex:s}=i.detail,d=`${t}.${s}`,o=()=>{var a;(a=document.getElementById(d))==null||a.scrollIntoView({behavior:"smooth",block:"center"})};if(!y.value.sections){y.value.sections=!0,setTimeout(o,10);return}o()}),(i,t)=>(v(),g(V,null,[n("div",Ue,[Pe,n("div",Ne,[(v(!0),g(V,null,P(e.value.options,(s,d)=>(v(),j(Ie,{modelValue:e.value.options[d],"onUpdate:modelValue":o=>e.value.options[d]=o,label:d},null,8,["modelValue","onUpdate:modelValue","label"]))),256))])]),n("div",Ee,[Me,n("div",Be,[(v(!0),g(V,null,P(Object.keys(e.value.instruments),s=>(v(),g("div",Oe,[n("h2",null,C(s),1),n("div",Te,[n("span",{onClick:d=>delete e.value.instruments[s],class:"material-symbols-rounded"}," - ",8,je)]),n("div",qe,[c(w,{modelValue:e.value.instruments[s].name,"onUpdate:modelValue":d=>e.value.instruments[s].name=d,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),c(N,{modelValue:e.value.instruments[s].volume,"onUpdate:modelValue":d=>e.value.instruments[s].volume=d,min:0,max:127,label:"volume"},null,8,["modelValue","onUpdate:modelValue"]),c(N,{modelValue:e.value.instruments[s].page,"onUpdate:modelValue":d=>e.value.instruments[s].page=d,label:"page"},null,8,["modelValue","onUpdate:modelValue"]),c(R,{modelValue:e.value.instruments[s].type,"onUpdate:modelValue":d=>e.value.instruments[s].type=d,options:T(D),label:"type"},null,8,["modelValue","onUpdate:modelValue","options"])])]))),256))]),n("div",De,[(v(),g(V,null,P(["l","r1","r2"],s=>le(c(x,{onClick:d=>m(s),icon:"add",label:"Add "+s},null,8,["onClick","label"]),[[ae,!e.value.instruments[s]]])),64))])])],64))}}),Re=k({__name:"Metadata",props:{song:{required:!0,type:Object}},setup(u){const _=u,f=E();S(()=>_.song,i=>{i&&(e.value=i)});const e=b(_.song);S(()=>e.value,i=>{i&&f.updateSong(i)});const m=async()=>{var o;if(!e.value.artist||!e.value.title)return;const i=`artist:${e.value.artist} track:${e.value.title}`,d=(o=(await(await fetch("http://localhost:1234/api/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:i,scope:["spotify"]})})).json()).spotifyTracks)==null?void 0:o[0];d&&(e.value.spotify=d.url,e.value.cover=d.cover,y())},y=async()=>{if(console.log("getMetadata"),!e.value.spotify)return;e.value.spotify.includes("?")&&(e.value.spotify=e.value.spotify.split("?")[0]);const t=await(await fetch("http://localhost:1234/api/spotify/meta",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({forceFetch:!0,spotifyId:e.value.spotify.split("/").pop()})})).json();e.value.bpm=Math.round(t.spotify.features.tempo),e.value.key=t.spotify.features.key+(t.spotify.features.mode==="Minor"?"m":"")};return(i,t)=>(v(),g(V,null,[c(w,{modelValue:e.value.title,"onUpdate:modelValue":t[0]||(t[0]=s=>e.value.title=s),label:"title",onChange:m},null,8,["modelValue"]),c(w,{modelValue:e.value.artist,"onUpdate:modelValue":t[1]||(t[1]=s=>e.value.artist=s),label:"artist",onChange:m},null,8,["modelValue"]),c(w,{modelValue:e.value.spotify,"onUpdate:modelValue":t[2]||(t[2]=s=>e.value.spotify=s),label:"Spotify Link",onChange:y,buttonIcon:"search",onButtonClick:m},null,8,["modelValue"]),c(w,{modelValue:e.value.key,"onUpdate:modelValue":t[3]||(t[3]=s=>e.value.key=s),label:"key"},null,8,["modelValue"]),c(N,{modelValue:e.value.bpm,"onUpdate:modelValue":t[4]||(t[4]=s=>e.value.bpm=s),min:0,label:"bpm"},null,8,["modelValue"]),c(N,{modelValue:e.value.transpose,"onUpdate:modelValue":t[5]||(t[5]=s=>e.value.transpose=s),min:-12,max:12,label:"transpose"},null,8,["modelValue"]),c(N,{modelValue:e.value.octave,"onUpdate:modelValue":t[6]||(t[6]=s=>e.value.octave=s),min:-1,max:1,label:"octave"},null,8,["modelValue"])],64))}}),A=u=>(Q("data-v-83d7eaa8"),u=u(),X(),u),We={class:"group"},Ae=A(()=>n("h2",null,"Structure",-1)),Fe={class:"content"},ze={class:"group"},Je={class:"flex space-between"},Ye=A(()=>n("h2",null,"Sections",-1)),Ge={class:"group section"},He={class:"flex space-between"},Ke={class:"flex"},Qe=["onClick"],Xe={class:"content"},Ze=["onClick","id"],et={class:"flex end"},tt=["onClick"],ot={class:"content flex-row"},nt={class:"group"},st=A(()=>n("h2",null,"Melodies",-1)),lt={class:"content"},at={class:"group"},it={class:"flex"},ut=k({__name:"Structure",props:{song:{required:!0,type:Object}},setup(u){const _=u,f=E();S(()=>_.song,o=>{o&&(e.value=o)});const e=b(_.song);S(()=>e.value,o=>{o&&f.updateSong(o)});const m=b({});window.addEventListener("click",o=>{let a=o.target;for(let p=0;p<5;p++){if(!a)return;if(a.classList.contains("group")||!a.parentElement)break;a=a.parentElement}if(!a)return;const[l,r]=a.id.split(".");for(let p=0;p<e.value.sections.length;p++){const I=e.value.sections[p];for(let h=0;h<I.progression.length;h++){if(p===Number(l)&&h===Number(r))continue;const U=I.progression[h];delete U.selected}}}),window.addEventListener("chord-click",o=>{const{sectionIndex:a,chordIndex:l}=o.detail,r=`${a}.${l}`,p=()=>{var I;(I=document.getElementById(r))==null||I.scrollIntoView({behavior:"smooth",block:"center"})};if(!m.value.sections){m.value.sections=!0,setTimeout(p,10);return}p()});const y=o=>{e.value.midi&&e.value.midi.splice(o,1)},i=async()=>new Promise((o,a)=>{const l=document.createElement("input");l.type="file",l.accept=".mid",l.onchange=async()=>{if(!l.files){a();return}const r=l.files[0],p=await ve(r);if(!p){a();return}o(p)},l.click()}),t=async o=>{const a=await i();a&&e.value.midi&&(e.value.midi[o]=a)},s=async()=>{e.value.midi||(e.value.midi=[]);const o=await i();o&&e.value.midi.push(o)},d=o=>{const a=H.value.includes("detected")?e.value.key:H.value;o.progression.push({chord:a,duration:4,id:Math.random().toString(36)})};return W(()=>{_e()}),(o,a)=>(v(),g(V,null,[n("div",We,[Ae,n("div",Fe,[(v(!0),g(V,null,P(e.value.structure,(l,r)=>(v(),j(R,{modelValue:e.value.structure[r],"onUpdate:modelValue":[p=>e.value.structure[r]=p,p=>{p==="(none)"&&e.value.structure.splice(r,1)}],options:[...e.value.sections.map(p=>String(p.type)),"(none)"],label:"section"},null,8,["modelValue","onUpdate:modelValue","options"]))),256))]),c(x,{onClick:a[0]||(a[0]=l=>e.value.structure.push("")),icon:"add",label:"add section"})]),n("div",ze,[n("div",Je,[Ye,n("span",{class:"material-symbols-rounded",onClick:a[1]||(a[1]=l=>m.value.sections=!m.value.sections)},C(m.value.sections?"expand_less":"expand_more"),1)]),m.value.sections?(v(),g(V,{key:0},[c(T(Y),{modelValue:e.value.sections,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.sections=l),class:"content","item-key":"id",onDragover:a[4]||(a[4]=G(()=>{},["stop"]))},{item:B(({element:l})=>[n("div",Ge,[n("div",He,[n("div",Ke,[c(R,{modelValue:l.type,"onUpdate:modelValue":r=>l.type=r,options:T(ie),label:"type"},null,8,["modelValue","onUpdate:modelValue","options"]),c(w,{modelValue:l.name,"onUpdate:modelValue":r=>l.name=r,label:"name"},null,8,["modelValue","onUpdate:modelValue"])]),n("span",{onClick:r=>e.value.sections.splice(e.value.sections.indexOf(l),1),class:"material-symbols-rounded"}," delete ",8,Qe)]),n("div",Xe,[c(T(Y),{modelValue:l.progression,"onUpdate:modelValue":r=>l.progression=r,class:"content","item-key":l.id,onDragover:a[2]||(a[2]=G(()=>{},["stop"]))},{item:B(({element:r})=>[n("div",{class:"group chord",onClick:p=>r.selected=!0,id:e.value.sections.indexOf(l)+"."+l.progression.indexOf(r)},[n("div",et,[n("span",{onClick:p=>l.progression.splice(l.progression.indexOf(r),1),class:"material-symbols-rounded"},"-",8,tt)]),n("div",ot,[c(w,{modelValue:r.chord,"onUpdate:modelValue":p=>r.chord=p,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),c(N,{modelValue:r.duration,"onUpdate:modelValue":p=>r.duration=p,min:1,label:"duration"},null,8,["modelValue","onUpdate:modelValue"])])],8,Ze)]),_:2},1032,["modelValue","onUpdate:modelValue","item-key"])]),c(x,{onClick:r=>d(l),icon:"add",label:"add chord"},null,8,["onClick"])])]),_:1},8,["modelValue"]),c(x,{onClick:a[5]||(a[5]=l=>e.value.sections.push({type:"chorus",progression:[],id:Math.random().toString(36)})),icon:"add",label:"add section"})],64)):$("",!0)]),n("div",nt,[st,n("div",lt,[(v(!0),g(V,null,P(u.song.midi,(l,r)=>(v(),g("div",at,[c(w,{modelValue:l.name,"onUpdate:modelValue":p=>l.name=p,label:"name"},null,8,["modelValue","onUpdate:modelValue"]),n("div",it,[c(x,{onClick:p=>y(r),icon:"delete",label:"delete"},null,8,["onClick"]),c(x,{onClick:p=>t(r),icon:"sync",label:"replace"},null,8,["onClick"])])]))),256))]),c(x,{onClick:s,icon:"add",label:"add"})])],64))}});const rt=M(ut,[["__scopeId","data-v-83d7eaa8"]]),dt={class:"settings"},ct={key:0,class:"spotify"},pt=["src"],mt={class:"tabs flex space-between"},vt=["onClick"],_t={class:"configuration"},ft=k({__name:"Editor",props:{song:{required:!0,type:Object}},setup(u){const _=u;E(),S(()=>_.song,y=>{y&&(f.value=y)});const f=b(_.song),e=[{name:"metadata",component:L(Re)},{name:"instrument",component:L(Le)},{name:"sections",component:L(rt)}],m=b(e[0]);return(y,i)=>(v(),g("div",dt,[f.value.spotify?(v(),g("div",ct,[n("iframe",{src:`https://open.spotify.com/embed/track/${f.value.spotify.split("/").pop()}`,width:"100%",height:"80",frameborder:"0",allow:"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture",loading:"lazy"},null,8,pt)])):$("",!0),n("div",mt,[(v(),g(V,null,P(e,t=>n("label",{key:t.name,class:ue({selected:m.value.name===t.name}),onClick:s=>m.value=t},C(t.name),11,vt)),64))]),n("div",_t,[(v(),j(re(m.value.component),{song:u.song},null,8,["song"]))])]))}});const gt={key:0,class:"min-width"},ht=k({__name:"MinWidth",props:{minWidth:{required:!0,type:Number},error:{required:!1,type:String,default:"Mobile devices are currently not supported."}},setup(u){const _=b(0);return W(()=>{_.value=window.innerWidth}),window.addEventListener("resize",()=>{_.value=window.innerWidth}),(f,e)=>_.value<u.minWidth?(v(),g("div",gt,[n("p",null,C(u.error),1)])):de(f.$slots,"default",{key:1},void 0,!0)}});const K=M(ht,[["__scopeId","data-v-40782251"]]),yt=u=>(Q("data-v-de74bfbf"),u=u(),X(),u),bt={key:0,class:"editor"},Vt=yt(()=>n("span",{class:"material-symbols-rounded"},"arrow_back",-1)),kt={class:"preview"},wt={key:0,class:"pages"},xt={class:""},$t={class:"config"},Ct=k({__name:"index",setup(u){const _=E(),f=ce(),e=pe();let m=f.params.id;if(!m){const d=_.addEmptySong();e.push({path:`/editor/${d}`,replace:!0}),m=String(d)}const y=_.song(m);y||e.push("/");const i=b(y),t=b(),s=()=>{if(!i.value)return;const d="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(i.value)),o=document.createElement("a");o.setAttribute("href",d),o.setAttribute("download",`${i.value.title}.chordsheets.json`),document.body.appendChild(o),o.click(),o.remove()};return(d,o)=>{const a=me("router-link");return v(),j(K,{minWidth:300},{default:B(()=>[i.value?(v(),g("div",bt,[c(a,{to:"/",class:"back-button"},{default:B(()=>[Vt]),_:1}),n("div",kt,[t.value?(v(),g("div",wt,[$("",!0),n("span",{class:"material-symbols-rounded",onClick:o[2]||(o[2]=(...l)=>t.value.print&&t.value.print(...l))}," print "),n("span",{class:"material-symbols-rounded",onClick:o[3]||(o[3]=(...l)=>t.value.download&&t.value.download(...l))}," picture_as_pdf "),n("span",{class:"material-symbols-rounded",onClick:s}," file_download ")])):$("",!0),n("div",xt,[c(be,{song:i.value,ref_key:"preview",ref:t},null,8,["song"])])]),c(K,{minWidth:1100,error:""},{default:B(()=>[n("div",$t,[c(ft,{song:i.value},null,8,["song"])])]),_:1})])):$("",!0)]),_:1})}}});const Mt=M(Ct,[["__scopeId","data-v-de74bfbf"]]);export{Mt as default};
